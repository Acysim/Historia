(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fb854dba","chunk-0943e7b6","chunk-7d9a27b3"],{"0173":function(e,t,i){"use strict";i.d(t,"e",(function(){return P})),i.d(t,"c",(function(){return T})),i.d(t,"f",(function(){return $})),i.d(t,"g",(function(){return R})),i.d(t,"d",(function(){return B})),i.d(t,"b",(function(){return L})),i.d(t,"a",(function(){return N}));i("4662");var n=i("28a2"),a=(i("b7ef"),i("88a7"),i("271a"),i("5494"),i("33d1"),i("ea98"),i("365c")),s=i("4360"),o=(i("163b"),i("d9e2"),i("14d9"),i("f8c9"),function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)});function r(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var l,c,d,u,f=function(){return(f=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function h(e,t,i,n){return new(i||(i=Promise))((function(a,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))}function m(e,t){var i,n,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function r(s){return function(r){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,r])}}}!function(e){e.refreshToken="api.getToken"}(l||(l={})),function(e){e.unknown="unknown",e.spreadsheet="s",e.writer="w",e.presentation="p",e.pdf="f",e.otl="o",e.dbt="d",e.ksheet="k"}(c||(c={})),function(e){e.nomal="nomal",e.simple="simple",e.embed="embed"}(d||(d={})),function(e){e[e.requestFullscreen=1]="requestFullscreen",e[e.exitFullscreen=0]="exitFullscreen"}(u||(u={}));var p=window.navigator.userAgent.toLowerCase(),g=/iPhone|iPod|iPad/i.test(p);function v(e){if(!e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}var _,b=function(){function e(e,t,i,n,a,s,o){var r=this;void 0===a&&(a=!0),void 0===s&&(s=!1),void 0===o&&(o={}),this.instance=e,this.instanceId=t,this.url=i,this.mount=n,this.isListenResize=a,this.addedStyles=s,this.customAttrs=o,this.handleResize=function(){var e=r.mount,t=r.mountResizeObserver,i=e.clientHeight,n=e.clientWidth;0!==i||0!==n||t?0===i&&0===n||!t||(t.disconnect(),t=null):window.ResizeObserver&&(t=new ResizeObserver((function(e){r.handleResize()}))).observe(e),r.iframe.style.cssText+="height: "+e.clientHeight+"px; width: "+e.clientWidth+"px"},this.iframe=this.initIframe()}return e.prototype.initIframe=function(){var e=this,t=this.mount,i=document.createElement("iframe");i.classList.add("web-office-iframe");var n=this.mergeAttrs({id:"office-iframe-"+this.instanceId,src:this.url,scrolling:"no",frameborder:"0",allowfullscreen:"allowfullscreen",webkitallowfullscreen:"true",mozallowfullscreen:"true",allow:"clipboard-read; clipboard-write"});for(var a in t?(n.style="width: "+t.clientWidth+"px; height: "+t.clientHeight+"px;",this.isListenResize&&window.addEventListener("resize",this.handleResize)):((t=document.createElement("div")).classList.add("web-office-default-container"),this.addedStyles||this.addStylesheetRules(".web-office-default-container {position: absolute; padding: 0;  margin: 0; width: 100vw; height: 100vh; left: 0; top: 0;}"),document.body.appendChild(t),n.style="width: 100vw; height: 100vh;"),g&&window.visualViewport&&this.isListenResize&&window.visualViewport.addEventListener("resize",(function(){var t=window.visualViewport,i=t.width,n=t.height,a=document.body.clientHeight-e.iframe.clientHeight;e.instance.sendMsgToWps({eventName:"visualViewportResize",data:{width:i,height:n-a}})})),n)i.setAttribute(a,n[a]);return t.appendChild(i),i.destroy=function(){window.removeEventListener("resize",e.handleResize),i.parentNode.removeChild(i),i=null,e.mountResizeObserver&&(e.mountResizeObserver.disconnect(),e.mountResizeObserver=null)},i},e.prototype.destroy=function(){this.iframe.parentNode.removeChild(this.iframe),window.removeEventListener("resize",this.handleResize)},e.prototype.addStylesheetRules=function(e){var t=document.createElement("style");document.head.appendChild(t);var i=t.sheet;i.insertRule(e,i.cssRules.length)},e.prototype.mergeAttrs=function(e){var t=this.customAttrs;if(t&&Object.keys(t).length&&t.allow){var i=t.allow instanceof Array?t.allow:t.allow.split(";");i.unshift("clipboard-write"),i.unshift("clipboard-read"),t.allow=i.join(";"),Object.assign(e,t)}return e},e}(),y=function(){function e(){this.HANDLE_LIST=[]}return e.prototype.add=function(e){this.HANDLE_LIST.push(e),window.addEventListener("message",e,!1)},e.prototype.remove=function(e){var t=this.HANDLE_LIST.indexOf(e);t>=0&&this.HANDLE_LIST.splice(t,1),window.removeEventListener("message",e,!1)},e.prototype.empty=function(){for(;this.HANDLE_LIST.length;){var e=this.HANDLE_LIST.shift();window.removeEventListener("message",e,!1)}},e.prototype.parse=function(e){try{return"object"==typeof e?e:e?JSON.parse(e):e}catch(r){return e}},e}(),k=function(){function e(e,t){var i=this;this.collectObjIdHandlers=new Set,this.polyfillApi=["ExportAsFixedFormat","GetOperatorsInfo","ImportDataIntoFields","ReplaceText","ReplaceBookmark","GetBookmarkText","GetComments"],this.getId=function(){return""},this.setterCallbacks={idMap:{}},this.sendMsgToWps=function(){},this.objId=0,this.origin="",this.apiChannel=function(e,t,n,a){return h(i,void 0,void 0,(function(){var i,s,o,r,l,c,d,u,f,p=this;return m(this,(function(g){switch(g.label){case 0:return i=this.getId(),r=new Promise((function(e,t){s=e,o=t})),l={},t.args?[4,this.reduceArgs(t.args)]:[3,2];case 1:c=g.sent(),d=c[0],u=c[1],t.args=d,l=u,g.label=2;case 2:return e!==this.prefix+"setter"?[3,4]:[4,this.handleApiSetter(t)];case 3:g.sent(),g.label=4;case 4:return f=function(){var t=function(r){return h(p,void 0,void 0,(function(){var c,d,u;return m(this,(function(f){switch(f.label){case 0:return this.instance.originWhiteList.includes(r.origin)||this.origin===r.origin?(c=this.message.parse(r.data)).eventName===this.prefix+"callback"&&c.callbackId&&l[c.callbackId]?[4,l[c.callbackId].apply(l,c.data.args)]:[3,2]:[2];case 1:d=f.sent(),this.sendMsgToWps({result:d,eventName:this.prefix+"callback.reply",callbackId:c.callbackId}),f.label=2;case 2:return c.eventName===e+".reply"&&c.msgId===i&&(c.error?((u=new Error("")).stack=c.error+"\n"+n,a&&a(),o(u)):s(c.result),this.message.remove(t)),[2]}}))}))};return p.message.add(t),r},this.handleSendApiChannel([{eventName:e,data:t,msgId:i},f]),[2,r]}}))}))},this.handleApiSetter=function(e){return h(i,void 0,void 0,(function(){var t,i,n,a,s,o,r,l,c,d,u=this;return m(this,(function(f){switch(f.label){case 0:return t=function(){return Object.keys(u.setterCallbacks.idMap).find((function(e){return u.setterCallbacks.idMap[e]===n+":"+i}))},i=e.prop,n=e.parentObjId,a=e.value,[4,this.reduceArgs([a])];case 1:return s=f.sent(),o=s[0],r=s[1],e.value=o[0],l=Object.keys(r)[0],c=this.setterCallbacks[n],null===a&&c&&c[i]&&((d=t())&&delete this.setterCallbacks.idMap[d],delete c[i],Object.keys(c).length||delete this.setterCallbacks[n],Object.keys(this.setterCallbacks.idMap).length||this.message.remove(this.setterCallbackSubscribe.bind(this))),l&&(Object.keys(this.setterCallbacks.idMap).length||this.message.add(this.setterCallbackSubscribe.bind(this)),this.setterCallbacks[n]||(this.setterCallbacks[n]={}),this.setterCallbacks[n][i]={callbackId:l,callback:r[l]},(d=t())&&delete this.setterCallbacks.idMap[d],this.setterCallbacks.idMap[l]=n+":"+i),[2]}}))}))},this.prefix=t,this.origin=e.origin,this.sendMsgToWps=e.sendMsgToWps.bind(e),this.getId=e.getId.bind(e),this.message=e.message,this.sdkInstanceId=e.instanceId,this.instance=e}return e.prototype.destroyApplication=function(){this.collectObjIdHandlers=new Set,this.objId=0},e.prototype.subEventHandle=function(e,t){var i=this,n={};this.message.add((function(e){return h(i,void 0,void 0,(function(){var t,i,a,s,o,r;return m(this,(function(l){switch(l.label){case 0:return this.instance.originWhiteList.includes(e.origin)||this.origin===e.origin?(t=this.message.parse(e.data),i=t.sdkInstanceId,t.eventName===this.prefix+"event"&&Number(i)===this.sdkInstanceId&&t.data?(a=t.data,s=a.eventName,o=a.data,(r=n[s])?[4,r(o)]:[3,2]):[3,2]):[2];case 1:l.sent(),l.label=2;case 2:return[2]}}))}))}));var a=function(a){var s=t[a];Object.defineProperty(e,s,{set:function(e){n[s]=e,i.sendMsgToWps({eventName:i.prefix+"event.register",data:{eventName:s,register:!!e,objId:i.objId+=1},sdkInstanceId:i.sdkInstanceId})}})};for(var s in t)a(s)},e.prototype.mixinProto=function(e,t){Object.assign(e,t)},e.prototype.makeCollectObjIdHandle=function(e){var t=this;return function(){var i=[],n=function(e){i.push(e)};return t.collectObjIdHandlers.add(n),{End:function(){e(i),t.collectObjIdHandlers.delete(n)}}}},e.prototype.assign=function(e,t,i){for(var n=this,a=t.slice(0),s=function(){var t=a.shift();!t.alias&&~o.polyfillApi.indexOf(t.prop)&&a.push(f(f({},t),{alias:t.prop+"Async"})),Object.defineProperty(e,t.alias||t.prop,{get:function(){var a=1===t.cache,s=a&&e["__"+t.prop+"CacheValue"];if(!s){var o=n.getError(),r=n.createObjId(a),l=function(){for(var a,s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];return void 0!==t.caller?(a={objId:n.createObjId()},n.assign(a,i[t.caller],i)):a={},n.wrapper(l,a,n.prefix+"caller",{obj:l,args:s,parentObjId:e.objId,objId:a.objId,prop:t.prop},o),a};return l.objId=-1,void 0!==t.getter&&(l.objId=r,n.assign(l,i[t.getter],i)),n.wrapper(e,l,n.prefix+"getter",{parentObjId:e.objId,objId:l.objId,prop:t.prop},o,(function(){delete e["__"+t.prop+"CacheValue"]})),a&&(e["__"+t.prop+"CacheValue"]=l),l}return s},set:function(i){var a=n.getError();return n.wrapper(e,{},n.prefix+"setter",{value:i,parentObjId:e.objId,objId:-1,prop:t.prop},a)}})},o=this;a.length;)s()},e.prototype.wrapper=function(e,t,i,n,a,s){var o,r=this,l=(e.done?e.done():Promise.resolve()).then((function(){return o||(o=r.apiChannel(i,n,a,s)),o}));t.done=function(){return l},t.then=function(e,i){return n.objId>=0?(t.then=null,t.catch=null,l.then((function(){e(t)})).catch((function(e){return i(e)}))):l.then(e,i)},t.catch=function(e){return l.catch(e)},t.Destroy=function(){return this.apiChannel(this.prefix+"free",{objId:t.objId},"")}},e.prototype.handleSendApiChannel=function(e){var t=e[0],i=e[1];"function"==typeof(t=f({},t)).data&&(t.data=t.data()),i(),this.sendMsgToWps(t)},e.prototype.setterCallbackSubscribe=function(e){return h(this,void 0,void 0,(function(){var t,i,n,a,s,o,r,l,c,d;return m(this,(function(u){switch(u.label){case 0:return this.instance.originWhiteList.includes(e.origin)||this.origin===e.origin?(t=this.message.parse(e.data),i=t.eventName,n=t.callbackId,a=t.data,n&&(s=this.setterCallbacks.idMap[n])?(o=s.split(":"),r=o[0],l=o[1],i===this.prefix+"callback"&&this.setterCallbacks[r]&&this.setterCallbacks[r][l]?[4,(d=this.setterCallbacks[r][l]).callback.apply(d,a.args)]:[3,2]):[3,2]):[2];case 1:c=u.sent(),this.sendMsgToWps({result:c,callbackId:n,eventName:this.prefix+"callback.reply"}),u.label=2;case 2:return[2]}}))}))},e.prototype.reduceArgs=function(e){return h(this,void 0,void 0,(function(){var t,i,n,a,s,o,r,l,c,d,u;return m(this,(function(f){switch(f.label){case 0:t={},i=[],n=e.slice(0),f.label=1;case 1:return n.length?(a=void 0,[4,n.shift()]):[3,13];case 2:return(s=f.sent())&&s.done?[4,s.done()]:[3,4];case 3:f.sent(),f.label=4;case 4:if(!v(a))return[3,11];for(r in a={},o=[],s)o.push(r);l=0,f.label=5;case 5:return l<o.length?(c=o[l],d=s[c],/^[A-Z]/.test(c)?d&&d.done?[4,d.done()]:[3,7]:[3,8]):[3,10];case 6:f.sent(),f.label=7;case 7:d&&d.objId?d={objId:d.objId}:"function"==typeof d&&(u=this.getId(),t[u]=d,d={callbackId:u}),f.label=8;case 8:a[c]=d,f.label=9;case 9:return l++,[3,5];case 10:return[3,12];case 11:s&&s.objId?a={objId:s.objId}:"function"==typeof s&&void 0===s.objId?(u=this.getId(),t[u]=s,a={callbackId:u}):a=s,f.label=12;case 12:return i.push(a),[3,1];case 13:return[2,[i,t]]}}))}))},e.prototype.createObjId=function(e){return this.objId+=1,!e&&this.collectObjId(),this.objId},e.prototype.collectObjId=function(){var e=this;this.collectObjIdHandlers.forEach((function(t){return t(e.objId)}))},e.prototype.getError=function(){var e=new Error("");return(e.stack||e.message||"").split("\n").slice(2).join("\n")},e}(),I=function(e){function t(t,i,n){var a=e.call(this,t,n)||this,s={},o=t.officeType,r=i.Events,l=i.Enum,d=i.Props,u=d[0],f=d[1],h={objId:a.objId};switch(a.assign(h,u,f),h.Events=r,h.Enum=l,h.Sub={},s.Enum=h.Enum,s.Events=h.Events,s.Props=d,o){case c.writer:s.WordApplication=t.WpsApplication=function(){return h};break;case c.spreadsheet:s.ExcelApplication=t.EtApplication=function(){return h};break;case c.presentation:s.PPTApplication=t.WppApplication=function(){return h};break;case c.pdf:s.PDFApplication=function(){return h}}return s.Application=h,s.Free=function(e){return a.apiChannel(a.prefix+"free",{objId:e},"")},s.Stack=h.Stack=a.makeCollectObjIdHandle((function(e){a.apiChannel(a.prefix+"free",{objId:e},"")})),s.destroyApplication=function(){a.destroyApplication()},a.subEventHandle(h.Sub,r),a.mixinProto(t,s),a}return r(t,e),t}(k),w=function(e){function t(t,i,n){var a=e.call(this,t,n)||this,s={},o=i.Events,r=i.Enum,l=i.Props,c=l[0],d=l[1],u={objId:a.objId};return a.assign(u,c,d),u.Events=o,u.Enum=r,u.Sub={},s.CommonEnum=u.Enum,s.CommonEvents=u.Events,s.CommonProps=l,s.CommonApi=u,s.CommonFree=function(e){return a.apiChannel(a.prefix+"free",{objId:e},"")},s.CommonStack=u.Stack=a.makeCollectObjIdHandle((function(e){a.apiChannel(a.prefix+"free",{objId:e},"")})),s.destroyCommonApp=function(){a.destroyApplication()},a.subEventHandle(u.Sub,o),a.mixinProto(t,s),a}return r(t,e),t}(k),C=function(){function e(t){var i,n=this;this.id=0,this.origin="",this.originWhiteList=[],this.realOrigin="",this.iframeWH=null,this.cbConfigsSub={},this.readyEventNames=[{event:"ready",callback:function(){n.handleBaseReady()},after:!0},{event:"open.result"},{event:"api.ready",callback:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[0];return new I(n,i,"api."),n.Application}},{event:"commonApi.ready",callback:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[0];return new w(n,i,"commonApi."),n.CommonApi}}],this.cbConfigs=["refreshToken"],this.onEventNames={"open.result":"fileOpen","tab.switch":"tabSwitch","file.saved":"fileStatus",error:"error",stage:"stage"},this.polyfillConfigName=[["wpsOptions","wordOptions"],["etOptions","excelOptions"],["wppOptions","pptOptions"]],this.flag={advancedApiReadySended:!1,advancedApiReadySendedJust:!1,commonApiReadySended:!1,commonApiReadySendedJust:!1},this.baseReadyPromise=Promise.resolve(),this.fileOpenPromise=Promise.resolve(),this.advancedReadyPromise=Promise.resolve(),this.commonApiPromise=Promise.resolve(),this.iframeInstance=null,this.officeType="",this.url="",this.version="2.0.7",this.iframeReady=!1,this.forceIframeResize=function(){n.iframeInstance&&n.iframeInstance.handleResize()},this.isOtherEvent=function(e){return void 0!==e&&e!==n.instanceId},this.handleBaseReady=function(){n.sendMsgToWps({eventName:"setConfig",data:f(f({},n.sdkConfig),{version:n.version})}),n.tokenData&&n.setToken(f(f({},n.tokenData),{hasRefreshTokenConfig:!!n.sdkConfig.refreshToken})),n.flag.advancedApiReadySended&&n.sendMsgToWps({eventName:"api.ready"}),n.flag.commonApiReadySended&&n.sendMsgToWps({eventName:"commonApi.ready"}),n.iframeReady=!0},this.handleFullscreenChange=function(){var e={status:u.requestFullscreen};document.fullscreenElement?e.status=u.requestFullscreen:e.status=u.exitFullscreen,n.sendMsgToWps({data:e,eventName:"fullscreenchange"})},this.instanceId=e.instanceId,e.instanceId+=1,this.message=new y,this.mittInstance=(i=i||Object.create(null),{on:function(e,t){(i[e]||(i[e]=[])).push(t)},off:function(e,t){i[e]&&i[e].splice(i[e].indexOf(t)>>>0,1)},emit:function(e,t){(i[e]||[]).slice().map((function(e){e(t)})),(i["*"]||[]).slice().map((function(i){i(e,t)}))}}),this.handleConfig(t)}return e.config=function(t){return void 0===t&&(t={}),e.singleInstance||(e.singleInstance=new e(t)),e.singleInstance},e.prototype.setToken=function(e){return h(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this.basicReady()];case 1:return t.sent(),this.tokenData=e,this.sendMsgToWps({eventName:"setToken",data:e}),[2]}}))}))},e.prototype.advancedApiReady=function(){return h(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return this.flag.advancedApiReadySendedJust?[3,2]:(this.flag.advancedApiReadySendedJust=!0,[4,this.fileOpenPromise]);case 1:e.sent(),this.flag.advancedApiReadySended||(this.flag.advancedApiReadySended=!0,this.sendMsgToWps({eventName:"api.ready"})),e.label=2;case 2:return[4,this.advancedReadyPromise];case 3:return[2,e.sent()]}}))}))},e.prototype.commonApiReady=function(){return h(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return this.flag.commonApiReadySendedJust?[3,2]:(this.flag.commonApiReadySendedJust=!0,[4,this.basicReady()]);case 1:e.sent(),this.flag.commonApiReadySended||(this.flag.commonApiReadySended=!0,this.sendMsgToWps({eventName:"commonApi.ready"})),e.label=2;case 2:return[4,this.commonApiPromise];case 3:return[2,e.sent()]}}))}))},e.prototype.destroy=function(){this.iframeInstance.destroy(),this.message.empty(),this.destroyApplication&&this.destroyApplication(),this.destroyCommonApp&&this.destroyCommonApp(),this.removeFullscreenEventListener()},e.prototype.on=function(e,t){return h(this,void 0,void 0,(function(){var i;return m(this,(function(n){switch(n.label){case 0:return[4,this.basicReady()];case 1:return n.sent(),i=e,"fullscreenChange"===e&&(i="fullscreenchange"),this.handleBasicEvent(i,"on"),this.mittInstance.on(e,t),[2]}}))}))},e.prototype.off=function(e,t){return h(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,this.basicReady()];case 1:return i.sent(),this.handleBasicEvent(e,"off"),this.mittInstance.off(e,t),[2]}}))}))},e.prototype.handleConfig=function(e){var t,i=this;void 0===e&&(e={});try{var n=this.userConfHandler(e),a=n.subscriptions,s=void 0===a?{}:a,o=n.mount,r=void 0===o?null:o,l=n.url,c=n.originWhiteList;this.origin=(l.match(/https*:\/\/[^\/]+/g)||[])[0],this.originWhiteList=c||[];var d=this.readyEventNames.map((function(e){return i.makeReady(e)})),u=d[0],f=d[1],h=d[2],m=d[3];this.baseReadyPromise=u,this.fileOpenPromise=f,this.advancedReadyPromise=h,this.commonApiPromise=m,this.iframeWH=r?{width:r.clientWidth+"px",height:r.clientHeight+"px"}:{width:"100vw",height:"100vh"},delete n.mount,l&&delete n.url,this.url=l,delete n.subscriptions,this.sdkConfig=n,this.iframeInstance=new b(this,this.instanceId,l,r,null===(t=n.isListenResize)||void 0===t||t,!1,{allow:n.attrAllow}),this.iframe=this.iframeInstance.iframe,this.listener(s)}catch(e){return console.error(e),null}},e.prototype.listener=function(e){var t=this;this.message.add((function(i){return h(t,void 0,void 0,(function(){var t,n,a,s,o,r,l,c,d;return m(this,(function(u){return t=this.message.parse(i.data),n=t.eventName,a=void 0===n?"":n,s=t.data,o=void 0===s?null:s,r=t.url,l=void 0===r?null:r,c=t.sdkInstanceId,this.isOtherEvent(c)||-1!==["wps.jssdk.api"].indexOf(a)||((d=this.handleListenEvent(a,o))?d():Object.keys(this.onEventNames).includes(a)&&("open.result"===a&&(this.officeType=o.fileInfo.officeType),this.mittInstance.emit(this.onEventNames[a],o)),"function"==typeof e[a]&&e[a](this,l||o)),[2]}))}))}))},e.prototype.handleListenEvent=function(e,t){var i,n=this;return((i={"api.scroll":function(){return window.scrollTo(t.x,t.y)},"event.callback":function(){return h(n,void 0,void 0,(function(){var e,i,n,a,s,o,r;return m(this,(function(l){return e=t.eventName,i=t.data,n=e,"fullScreenChange"===e&&(n="fullscreenChange"),((null===(o=this.sdkConfig.commonOptions)||void 0===o?void 0:o.isBrowserViewFullscreen)||(null===(r=this.sdkConfig.commonOptions)||void 0===r?void 0:r.isParentFullscreen))&&"fullscreenchange"===n&&(a=i.status,s=i.isDispatchEvent,this.sdkConfig.commonOptions.isBrowserViewFullscreen?this.iframeWH&&function(e,t,i,n){0===e?t.style="position: static; width: "+i.width+"; height: "+i.height:1===e&&(t.style="position: absolute; width: 100%; height: 100%"),n&&function(e){["fullscreen","fullscreenElement"].forEach((function(t){Object.defineProperty(document,t,{get:function(){return!!e.status},configurable:!0})}));var t=new CustomEvent("fullscreenchange");document.dispatchEvent(t)}({status:e})}(a,this.iframe,this.iframeWH,s):this.sdkConfig.commonOptions.isParentFullscreen&&function(e,t){if(0===e){var i=document,n=i.exitFullscreen||i.mozCancelFullScreen||i.msExitFullscreen||i.webkitCancelFullScreen||i.webkitExitFullscreen;n.call(document)}else if(1===e){var a=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen;a.call(t)}}(a,this.iframe)),this.mittInstance.emit(n,i),[2]}))}))}})[l.refreshToken]=function(){return h(n,void 0,void 0,(function(){var t,i;return m(this,(function(n){switch(n.label){case 0:t={token:!1},n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.cbConfigsSub.refreshToken()];case 2:return t=n.sent(),[3,4];case 3:return i=n.sent(),console.error("refreshToken: "+(i||"fail to get")),[3,4];case 4:return this.sendMsgToWps({eventName:e+".reply",data:t}),[2]}}))}))},i)[e]},e.prototype.basicReady=function(){return this.baseReadyPromise},e.prototype.userConfHandler=function(e,t){var i=this;void 0===t&&(t=!0);var n=f({},e),a=n.headers,s=void 0===a?{}:a,o=n.subscriptions,r=void 0===o?{}:o,c=n.commonOptions,u=n.url,h=void 0===u?"":u,m=n.wpsUrl,p=void 0===m?"":m,g=n.mode,v=void 0===g?d.nomal:g,_=n.debug,b=n.disablePlugins,y=n.hideGuide,k=n.readOnly;return Object.assign(n,this.handleHeadersAndSubscriptionsConfig(s,r,t)),n.url=this.handleUrlConfig(c,v,_,h,p,b,y,k),c&&(c.isParentFullscreen||c.isBrowserViewFullscreen)&&document.addEventListener("fullscreenchange",this.handleFullscreenChange),this.polyfillConfigName.map((function(e){var t=e[0],i=e[1];n[i]&&(n[t]=n[i])})),this.cbConfigs.map((function(e){var t,a,s=n[e];s&&(t=s,a="Function",{}.toString.call(t)==="[object "+a+"]")&&(i.cbConfigsSub[e]=s,n[e]={eventName:l[e]})})),n.commandBars&&this.handleCommandBarsConfig(n.commandBars,!1),f({},n)},e.prototype.handleBasicEvent=function(e,t){if(!["error","fileOpen"].includes(e)){var i={eventName:"basic.event",data:{eventName:e,action:t}};this.sendMsgToWps(i)}},e.prototype.removeFullscreenEventListener=function(){document.removeEventListener("fullscreenchange",this.handleFullscreenChange)},e.prototype.handleHeadersAndSubscriptionsConfig=function(e,t,i){var n=e.backBtn,a=void 0===n?{}:n,s=e.shareBtn,o=void 0===s?{}:s,r=e.otherMenuBtn,l=void 0===r?{}:r,c=[["wpsconfig_back_btn",a],["wpsconfig_share_btn",o],["wpsconfig_other_menu_btn",l]],d=[];return l.items&&Array.isArray(l.items)&&l.items.forEach((function(e,t){void 0===e&&(e={}),"custom"===e.type&&d.push(["wpsconfig_other_menu_btn_"+t,e])})),c.concat(d).forEach((function(e){var n,a;n=e[1],a=e[0],n.subscribe&&"function"==typeof n.subscribe&&(n.callback=a,t[a]=n.subscribe,i&&delete n.subscribe)})),{}},e.prototype.handleUrlConfig=function(e,t,i,n,a,s,o,r){var l=[];l.push("sdkId="+this.instanceId),t===d.simple||e&&!1===e.isShowTopArea?l.push("simple","hidecmb"):t===d.embed&&l.push("simple=1","hidecmb=1","embed=1"),s&&l.push("disablePlugins"),o&&l.push("hideguide"),r&&l.push("readonly"),i&&l.push("debugger");var c=n||a;return c&&l.length&&(c=c+(c.indexOf("?")>=0?"&":"?")+l.join("&")),c},e.prototype.handleCommandBarsConfig=function(e,t){void 0===t&&(t=!0);var i=e.map((function(e){var t=e.attributes;if(!Array.isArray(t)){var i=[];for(var n in t)if(t.hasOwnProperty(n)){var a={name:n,value:t[n]};i.push(a)}e.attributes=i}return e}));return t&&this.sendMsgToWps({data:i,eventName:"setCommandBars"}),i},e.prototype.sendMsgToWps=function(e){var t,i,n=f(f({},e),{sdkInstanceId:this.instanceId});null===(i=null===(t=this.iframe)||void 0===t?void 0:t.contentWindow)||void 0===i||i.postMessage(JSON.stringify(n),this.realOrigin)},e.prototype.makeReady=function(e){var t=this,i=e.event,n=e.callback,a=e.after;return new Promise((function(e){var s=function(o){if(t.realOrigin=o.origin,t.originWhiteList.includes(o.origin)||t.origin===o.origin){var r=t.message.parse(o.data),l=r.eventName,c=r.data,d=r.sdkInstanceId;if(!t.isOtherEvent(d)&&l===i){var u=void 0;!a&&n&&(u=n(c)),e(u),a&&n&&n(c),"ready"!==i&&t.message.remove(s)}}};t.message.add(s)}))},e.prototype.getId=function(){return this.id+=1,this.instanceId+"-"+this.id},e.instanceId=1,e}(),S={executeCommandBar:"ExecuteCommandBar",off:"Off",save:"Save",setCommandBars:"SetCommandBars",setCooperUserColor:"SetCooperUserColor",tabs:"Tabs",Stack:"Stack",WhenStacksEmpty:"WhenStacksEmpty"};function O(e,t){var i=this;return void 0===t&&(t={}),new Proxy(e,f(f({},{get:function(e,t){if(Object.keys(S).includes(t)){var n=S[t];return"Tabs"===n?function(e){var t=this;return{switchTab:function(i){return h(t,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,e.commonApiReady()];case 1:return t.sent(),[4,e.CommonApi.Tabs.SwitchTab(i.tabKey)];case 2:return[2,t.sent()]}}))}))},getTabs:function(){return h(t,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,e.commonApiReady()];case 1:return t.sent(),[4,e.CommonApi.Tabs.GetTabs()];case 2:return[2,t.sent()]}}))}))}}}(e):e.CommonApi?Reflect.get(e.CommonApi,n):function(){return h(i,void 0,void 0,(function(){var t;return m(this,(function(i){switch(i.label){case 0:return[4,e.commonApiReady()];case 1:return i.sent(),[4,e.commonApiPromise];case 2:return i.sent(),"function"!=typeof e.CommonApi[n]?[3,4]:[4,e.CommonApi[n]()];case 3:return t=i.sent(),[3,5];case 4:t=e.CommonApi[n],i.label=5;case 5:return[2,t]}}))}))}}return Reflect.get(e,t)},set:function(e,t,i){return!!Reflect.has(e,t)&&Reflect.set(e,t,i)}}),t))}!function(e){e.Spreadsheet="s",e.Writer="w",e.Presentation="p",e.Pdf="f",e.Otl="o",e.Dbt="d",e.KSheet="k"}(_||(_={}));var E=function(e){function t(t){var i=e.call(this,t)||this;return t.token&&(v(t.token)?i.setToken(f({},t.token)):i.setToken({token:t.token})),i.ApiEvent={AddApiEventListener:function(e,t){i.on(e,t)},RemoveApiEventListener:function(e,t){i.off(e,t)}},i}return r(t,e),t.init=function(e){var i=f({},e);if(i.endpoint=i.endpoint||"https://o.wpsgo.com","string"==typeof i.mount){var n=document.querySelector(i.mount);n?i.mount=n:(console.warn("[WebOfficeSDK.init] mount挂载节点未找到"),delete i.mount)}if(i.url)throw Error("[WebOfficeSDK.init] 不支持传递url，请使用appId、fileId、officeType、token等参数初始化！");if(!i.appId||!i.fileId||!i.officeType)throw Error("[WebOfficeSDK.init] appId、fileId、officeType为必选项！");if("string"!=typeof i.endpoint)throw Error("[WebOfficeSDK.init] endpoint期望为字符串");if(i.endpoint&&!i.endpoint.startsWith("http"))throw Error("[WebOfficeSDK.init] endpoint仅支持http、https的地址");var a=new t(function(e){var t=f({},e);t.token=t.token||t.fileToken;var i=t.appId,n=t.fileId,a=t.officeType,s=t.token,o=t.endpoint,r=t.customArgs,l=void 0===r?"":r;if(!Object.values(_).includes(a))throw Error("[WebOfficeSDK.init] officeType属性值错误，可选值参考WebOfficeSDK.OfficeType: "+JSON.stringify(_));var c=s?1:0,d={token:""};if("string"==typeof s?d.token=s:v(s)&&(d=f({tokenData:d},s)),c&&!d.token)return console.error("[WebOfficeSDK.init] token设置无效"),t;if(t.url=o+"/office/"+a+"/"+n+"?_w_appid="+i+"&_w_tokentype="+c,v(l)){var u=Object.entries(l).map((function(e){var t=e[0],i=e[1];return t+"="+encodeURIComponent(i)})).join("&");t.url=t.url+"&"+u}return f({},t)}(i));return function(e,t){h(this,void 0,void 0,(function(){var i,n,a,s;return m(this,(function(o){switch(o.label){case 0:return[4,e.commonApiReady()];case 1:for(n in o.sent(),i=[],t)i.push(n);a=0,o.label=2;case 2:if(!(a<i.length))return[3,11];switch(s=i[a]){case"onHyperLinkOpen":return[3,3];case"onToast":return[3,5];case"getClipboardData":return[3,7]}return[3,9];case 3:return[4,e.CommonApi.Hooks.Add("hyperLink")];case 4:return o.sent().OnAction=t[s],[3,10];case 5:return[4,e.CommonApi.Hooks.Add("toast")];case 6:return o.sent().OnAction=t[s],[3,10];case 7:return[4,e.CommonApi.Hooks.Add("getClipboardData")];case 8:return o.sent().OnAction=t[s],[3,10];case 9:return[3,10];case 10:return a++,[3,2];case 11:return[2]}}))}))}(a,e),O(a)},Object.defineProperty(t,"version",{get:function(){return"2.0.7"},enumerable:!1,configurable:!0}),t.prototype.ready=function(){return h(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,this.advancedApiReady()];case 1:return[2,e.sent()]}}))}))},t.OfficeType=Object.freeze({Spreadsheet:"s",Writer:"w",Presentation:"p",Pdf:"f",Otl:"o",KSheet:"k",Dbt:"d"}),t}(C);window.WPS=E;var x=E,D=i("e1b8");function A(e){return encodeURIComponent(btoa(unescape(e)))}const P=()=>{const e={url:"",enable:!1,fixedAction:!1,fixedActionName:"ImagePreview"};return{...e,...window.projectConfig.fileViewServer}};function T(e){if(!e)return"";const{access_token:t}=D["a"].getToken();if(e.includes("access_token"))return e;{let i="?";return e.includes("?")&&(i="&"),`${e}${i}access_token=${t}`}}const j=(e,t=!0)=>{e=T(e);const{enable:i,url:n}=P();if(i){const i=t?A(e):e;let a="";e.includes(".xlsx")&&(a+="&officePreviewType=html"),a+="&forceUpdatedCache=true",window.open(`${n}/onlinePreview?url=${i}${a}`)}else(void 0).$notify("未配置外部预览服务")},M=["jpeg","jpg","gif","png"],$=e=>M.some(t=>null===e||void 0===e?void 0:e.includes(t)),R=e=>{var t;e=T(e);const i=new URL(e).pathname.replace(/\/form\//,"");console.log("user",s["a"].getters.userInfo);const n=s["a"].getters.userInfo,a=i.split("/").at(-1).split(".").at(0),o={officeType:x.OfficeType.Writer,appId:null===(t=window.projectConfig.officeSettings)||void 0===t?void 0:t.wps.appId,fileId:a,token:JSON.stringify({id:n.Id,userAccount:n.UserAccount,userName:encodeURIComponent(n.UserName),avatar:encodeURIComponent(n.Avatar)}),customArgs:{filePath:i}};console.log("config",o);const r=x.init(o);r.on("fileOpen",(async function(e){console.log("fileOpen",e),await r.ready(),console.log("api ready"),console.log("打开成功")}))},B=(e,...t)=>{"Download"===e&&window.open(`${t[0]}&download=1&rename=${t[1]}`),"NewTab"===e&&window.open(...t),"ImagePreview"===e&&Object(n["a"])([...t]),"FileViewer"===e&&j(...t),"WPSOnline"===e&&R(...t)},L=e=>T(N(e)),N=e=>{const{fileHost:t,enable:i,url:n}=P(),s=$(e.uri||e.url),o=`${a["d"].getUploadPath()}/${e.uri}`||e.url;return i&&n?t&&!s?`${t}${e.uri}`:o:t?`${t}${e.uri}`:o}},"036d":function(e,t,i){},"062c":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"iform-control-ocSelector"},[i("OCSelector",e._b({},"OCSelector",e.$attrs,!1))],1)},a=[],s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"iform-control-ocSelector"},[i("div",{on:{click:e.openSelector}},[e.isSelected?e._e():i("span",{staticClass:"oc-selector_placeholder"},[e._v(" "+e._s(e.options.placeholder)+" ")]),i("SelectedItem",{attrs:{readonly:e.readonly,selected:e.selectedList},on:{"close-item":e.handleCloseItem}})],1),i("van-popup",{style:{height:"100%"},attrs:{position:"bottom",duration:"0.4"},model:{value:e.showSelector,callback:function(t){e.showSelector=t},expression:"showSelector"}},[e.showSelector?i("Selector",{attrs:{options:e.options,selected:e.selectedList},on:{confirm:e.handleConfirm,close:e.handleClose}}):e._e()],1)],1)},o=[],r=i("9837"),l=i("c128"),c=i("da33"),d=i("6ad6"),u={name:"OC-Selector",components:{SelectedItem:l["a"],Selector:c["a"]},props:{data:{type:Object,default:()=>({})},configuration:{type:Object,default:()=>({})},formData:Object},data(){return{showSelector:!1,selectedList:[],scopesUnWatcher:null,options:{ocType:[],allowMulti:!1,scopes:[],placeholder:"",metadata:[]},commonConf:{}}},computed:{value:{get(){return this.data[this.configuration.code]}},isSelected(){var e;return(null===(e=this.selectedList)||void 0===e?void 0:e.length)>0},readonly(){return!!this.configuration&&this.configuration.isReadable}},mounted(){this.$watch(()=>this.data[this.commonConf.code],e=>{try{this.selectedList=JSON.parse(e).map(({id:e,name:t})=>({id:e,title:t}))}catch(t){console.log("赋值给 oc 选择器，格式错误",t)}}),this.initOptions(),Object(r["b"])(this.commonConf.code,this)},methods:{openSelector(){this.readonly||(this.showSelector=!0)},getMetadata(e){return e&&e.length||(e=d["d"]),e.map(e=>d["c"][e])},observerScopes(e){const t=e=>{let t=e;try{t=JSON.parse(e)}catch(i){console.error("observerScopes: not a string of JSON")}Array.isArray(t)?this.options.scopes=t.map(e=>e.id).join():this.options.scopes=t};e&&!this.scopesUnWatcher&&(this.scopesUnWatcher=this.$watch(()=>this.data[e],t)),e&&!this.scopesUnWatcher&&(this.scopesUnWatcher=this.$watch(()=>this.formData[e],t))},analysisValue(e){Array.isArray(e)||(e=[e]);const t=e=>{const t=(e.basicDataType+"").substring(0,1);return"USER"===e.basicDataType?{id:e.$basicData.UserAccount||e.id,name:e.title||e.name,type:t}:{id:e.id,name:e.title||e.name,type:t}};return e.map(t)},isJSON(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return!1}return!1},setValue(e){const t=this.isJSON(e);let i;i=t?this.analysisValue(t):this.analysisValue(e),this.$emit("script:change",i),0===i.length?this.data[this.commonConf.code]="":this.data[this.commonConf.code]=JSON.stringify(i);const n=this.configuration.extension.changeEvent;if(n)try{const e=new Function("value",n);e(i)}catch(a){}},handleCloseItem(e,t){this.selectedList.splice(t,1),this.setValue(this.selectedList)},handleConfirm(e){this.selectedList=e.map(e=>e),this.setValue(this.selectedList)},handleClose(){this.showSelector=!1},getScopes(){const e=Object(r["d"])(this.commonConf.scopes||"")[0];if(!e)return this.commonConf.scopes;const t=this.$store.getters.getSystem(e),i=this.formData[e],n=this.data[e],a=this.commonConf.scopes;return this.observerScopes(e),n||i||t||(e?"":a)},initOptions(){var e,t,i,n;this.commonConf={code:this.configuration.code,readonly:this.configuration.isReadable,allowMulti:null===(e=this.configuration.extension)||void 0===e?void 0:e.allowMulti,placeholder:null===(t=this.configuration.extension)||void 0===t?void 0:t.placeholder,scopes:null===(i=this.configuration.extension)||void 0===i?void 0:i.scopes,ocType:null===(n=this.configuration.extension)||void 0===n?void 0:n.ocType};const{ocType:a,allowMulti:s,placeholder:o}=this.commonConf,r=(null===a||void 0===a?void 0:a.split(","))||[];r.includes("oc")?this.commonConf.ocType=d["d"]:this.commonConf.ocType=(null===a||void 0===a?void 0:a.split(","))||[];const l=this.getMetadata(this.commonConf.ocType);this.options.metadata=l,this.options.ocType=l.map(e=>e.typeKey).filter(Boolean),this.options.allowMulti=!!s,this.options.scopes=this.getScopes(),this.options.placeholder=o||d["a"]+l.map(e=>e.name).filter(Boolean).join("/")}}},f=u,h=(i("cea9"),i("2877")),m=Object(h["a"])(f,s,o,!1,null,"0806cf17",null),p=m.exports,g={name:"oc-box",components:{OCSelector:p}},v=g,_=Object(h["a"])(v,n,a,!1,null,null,null);t["default"]=_.exports},"073c":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("3bce"),a=i("4a9d"),s=i("79fa"),o=i("5a0c"),r=i.n(o);function l(e,t={}){const i=t.serverDateTime,o=t.prefix;let l=this;if(e){var c=(Array.isArray(e.Jobs)?e.Jobs[0]:e.Jobs)||{};let t=i?r()(i).format("YYYY-MM-DD HH:mm:ss"):r()().format("YYYY-MM-DD HH:mm:ss");l.data={Sys_UserId:e.UserId,Sys_UserName:e.UserName,Sys_UserAccount:e.UserAccount,Sys_CompanyId:c.CompanyId,Sys_CompanyName:c.CompanyName,Sys_DepartmentId:c.DepartmentId,Sys_DepartmentName:c.DepartmentName,Sys_UserEmail:e.Email,Sys_UserPhone:e.PhoneNumber,Sys_JobId:c.JobId,Sys_JobName:c.JobName,Sys_ApplyDate:t,Sys_OrgPath:c.OrgPath,Sys_ApplyNo:Object(n["c"])(o),Sys_UserAvatar:e.Avatar,Sys_Language:s["a"].getCurrentLang()},a["a"].$emit("form.setUser",l.data),l.find=function(e){return l.data[e]}}return l}},"079e":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"iform-approval"},[e.isProcess&&!e.isView&&e.instanceId?i("van-row",[i("van-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[i("div",{staticClass:"van-doc-demo-block"},[i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:e.visibleApproval&&!e.isProcessOverview,expression:"visibleApproval && !isProcessOverview"}],attrs:{title:"审批记录",name:"审批记录"}},[e.signListReFreshFlag?i("div",{directives:[{name:"show",rawName:"v-show",value:!e.hideSign,expression:"!hideSign"}],staticClass:"iform-approval-sign"},[i("iform-sign-list",{attrs:{instanceId:e.instanceId,instanceStatus:e.instanceStatus,config:e.config}})],1):e._e()]),e.commentConfig.enable?i("van-collapse-item",{attrs:{title:"评论",name:"评论"}},[i("IFormDiscuss",{attrs:{commentConfig:e.commentConfig}})],1):e._e(),i("div",{staticClass:"iform-approval-operate"},[e.disabled&&!e.isPlusTask||!e.visibleApproval?e._e():i("van-form",{ref:"iform-approval-form",staticClass:"iform-approval-form",attrs:{model:e.sign,rules:e.rules,"label-width":"100px"}},[i("van-field",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"iform-item",attrs:{label:"用户",prop:"user"},scopedSlots:e._u([{key:"input",fn:function(){return[i("iform-control-ocbox",{staticStyle:{flex:"1"},attrs:{data:e.sign,configuration:e.configuration}})]},proxy:!0}],null,!1,2200525413)}),i("van-field",{directives:[{name:"show",rawName:"v-show",value:e.returnStepVisable,expression:"returnStepVisable"}],staticClass:"iform-item",attrs:{label:"退回节点",prop:"returnStepId"},scopedSlots:e._u([{key:"input",fn:function(){return[i("input",{directives:[{name:"model",rawName:"v-model",value:e.label,expression:"label"}],staticClass:"van-field__control",attrs:{placeholder:e.$t("请选择"),readonly:""},domProps:{value:e.label},on:{click:function(t){e.showPicker=!0},input:function(t){t.target.composing||(e.label=t.target.value)}}}),i("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showPicker,callback:function(t){e.showPicker=t},expression:"showPicker"}},[i("van-picker",{attrs:{title:"退回节点","show-toolbar":"",columns:e.options,"value-key":"label"},on:{confirm:e.handleConfirm,cancel:e.handleCancel}})],1)]},proxy:!0}],null,!1,3834386153)}),i("van-field",{staticClass:"iform-item",attrs:{label:"意见",prop:"remark"},scopedSlots:e._u([{key:"input",fn:function(){return[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.sign.remark,expression:"sign.remark"}],staticClass:"van-field__control",attrs:{rows:"3",type:"textarea",placeholder:"请输入意见"},domProps:{value:e.sign.remark},on:{input:function(t){t.target.composing||e.$set(e.sign,"remark",t.target.value)}}})]},proxy:!0}],null,!1,4105389260)}),e.showApproveSign?i("van-field",{staticClass:"iform-item",attrs:{label:"签名",prop:"signature"},scopedSlots:e._u([{key:"input",fn:function(){return[i("ApproveSign",{staticStyle:{height:"100px",width:"100%"},model:{value:e.sign.signature,callback:function(t){e.$set(e.sign,"signature",t)},expression:"sign.signature"}})]},proxy:!0}],null,!1,1034854594)}):e._e()],1),i("van-row",{directives:[{name:"show",rawName:"v-show",value:!e.disabled||e.isPlusTask,expression:"!disabled || isPlusTask"}],staticClass:"iform-button"},[e._l(e.buttons,(function(t,n){return i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"btn.visible"}],key:n,ref:"iform-button-"+t.code,refInFor:!0,attrs:{size:t.size,type:t.type},on:{click:function(i){return e.handleEvent(t)}}},[e._v(e._s(e.$t(t.title)))])})),e.saveSnapshotEnable?i("van-button",{on:{click:e.handleSaveSnapshot}},[e._v(" 保存 ")]):e._e()],2)],1)],1)])],1):i("div",[e.commentConfig.enable?i("van-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[i("van-collapse-item",{attrs:{title:"评论",name:"评论"}},[i("IFormDiscuss",{attrs:{commentConfig:e.commentConfig}})],1)],1):e._e(),i("van-row",{staticClass:"iform-button"},[e._l(e.buttons,(function(t,n){return i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.visible&&!e.isView,expression:"btn.visible && !isView"}],key:n,ref:"iform-button-"+t.code,refInFor:!0,attrs:{size:t.size,type:t.type},on:{click:function(i){return e.handleEvent(t)}}},[e._v(e._s(e.$t(t.title)))])})),e.printsBtnVisible?i("van-button",{staticStyle:{width:"30%"},on:{click:function(t){e.showPrintsList=!0}}},[e._v(" 打印 ")]):e._e()],2)],1),i("van-action-sheet",{attrs:{"cancel-text":"取消"},model:{value:e.showPrintsList,callback:function(t){e.showPrintsList=t},expression:"showPrintsList"}},[e.printsRef.value.undersign.enable?i("van-button",{attrs:{command:"sign",size:"large"},on:{click:function(t){return e.handlePrints("sign")}}},[e._v(" "+e._s(e.printsRef.value.undersign.text)+" ")]):e._e()],1),i("van-overlay",{attrs:{show:e.printLoading}},[i("div",{staticClass:"wrapper"},[i("van-loading",{attrs:{type:"spinner"}})],1)])],1)},a=[],s=(i("14d9"),i("88a7"),i("271a"),i("5494"),i("062c")),o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"IFormDiscuss"},[i("van-row",{staticClass:"IFormDiscuss-toolbar",attrs:{type:"flex",align:"center"}},[i("van-col",{attrs:{span:"12"}},[i("van-icon",{attrs:{name:"arrow-left",size:"20"},on:{click:e.prev}}),i("van-icon",{attrs:{name:"arrow",size:"20"},on:{click:e.next}})],1),i("van-col",{staticStyle:{"text-align":"end"},attrs:{span:"12"}},[i("IFormDiscussCreator",{attrs:{commentConfig:e.commentConfig},on:{created:e.onCreated}})],1)],1),i("van-steps",{attrs:{direction:"vertical"}},[e._l(e.discussList,(function(t){return[i("van-step",{key:t.id,scopedSlots:e._u([{key:"active-icon",fn:function(){return[i("IFormDiscussAvatar",{attrs:{avatar:t.userAvatar}})]},proxy:!0},{key:"inactive-icon",fn:function(){return[i("IFormDiscussAvatar",{attrs:{avatar:t.userAvatar}})]},proxy:!0},{key:"finish-icon",fn:function(){return[i("IFormDiscussAvatar",{attrs:{avatar:t.userAvatar}})]},proxy:!0}],null,!0)},[i("IFormDiscussContent",{attrs:{discuss:t},on:{canceled:e.onCancel}})],1)]}))],2)],1)},r=[],l=i("d3be"),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"IFormDiscussContent"},[i("van-row",{attrs:{type:"flex"}},[i("van-col",{attrs:{span:"12"}},[i("van-tag",{attrs:{plain:"",type:"primary"}},[e.isSelf?i("span",[e._v("我")]):i("span",[e._v(" "+e._s(e.discuss.nickName)+" ")])]),e._v(" 添加了评论 ")],1),i("van-col",{staticStyle:{"text-align":"end"},attrs:{span:"12"}},[e._v(" "+e._s(e.timeFormat())+" ")])],1),0===e.discuss.status?[i("div",{staticClass:"IFormDiscussContent_text"},[i("van-row",{attrs:{type:"flex"}},[i("van-col",{staticClass:"IFormDiscussContent_text--box",attrs:{span:e.checkCancelable()?20:24}},[e._v(" "+e._s(e.discuss.content)+" ")]),e.checkCancelable()?i("van-col",{staticStyle:{"text-align":"end"},style:{color:"#1989fa"},attrs:{span:"4"},on:{click:e.onCancel}},[e._v(" 撤回 ")]):e._e()],1)],1),e._l(e.discuss.fileList,(function(t,n){return[i("div",{key:t,staticClass:"IFormDiscussContent_file"},[i("van-image",{staticStyle:{"border-radius":"5px",overflow:"hidden"},attrs:{width:"40",height:"40",src:t},on:{click:function(i){return e.onPreview(t,n)}}})],1)]}))]:i("div",{staticClass:"IFormDiscussContent_text"},[e._v(" 已于 "+e._s(e.discuss.updateTime)+" 撤回评论 ")])],2)},d=[],u=(i("e17f"),i("2241")),f=(i("4662"),i("28a2")),h=i("5a0c"),m=i.n(h),p={name:"IFormDiscussContent",props:{discuss:Object},data(){return{cancelableLimitMinutes:30}},computed:{isSelf(){return this.$store.getters.userInfo.Id===this.discuss.userId}},methods:{timeFormat(){return m()(this.discuss.createTime).format("MM.DD HH:mm:ss")},onPreview(e,t){Object(f["a"])({images:this.discuss.fileList,closeable:!0,startPosition:t})},checkCancelable(){const e=Date.now()-60*this.cancelableLimitMinutes*1e3<m()(this.discuss.createTime).valueOf();return e&&this.isSelf},async onCancel(){this.checkCancelable()?(await u["a"].confirm({message:"确认撤回评论？"}),await Object(l["d"])({id:this.discuss.id}),this.$emit("canceled")):u["a"].alert({message:"已超出可撤回时间！"})}}},g=p,v=(i("096c"),i("2877")),_=Object(v["a"])(g,c,d,!1,null,"17a9157d",null),b=_.exports,y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"IFormDiscussCreator"},[i("van-button",{attrs:{icon:"plus",type:"info",size:"mini"},on:{click:e.onShow}},[e._v(" 评论 ")]),i("van-action-sheet",{attrs:{title:"评论"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[i("div",{staticClass:"content",style:{height:"72vh"}},[i("van-field",{attrs:{autosize:{maxHeight:400,minHeight:100},type:"textarea",required:"",maxlength:"500",placeholder:"请输入评论","show-word-limit":"",clearable:"",autofocus:""},model:{value:e.formData.content,callback:function(t){e.$set(e.formData,"content",t)},expression:"formData.content"}}),i("van-row",{staticStyle:{padding:"8px"},attrs:{type:"flex"}},[e._l(e.historyMessage.list,(function(t){return[i("van-tag",{key:t,staticStyle:{margin:"6px"},attrs:{type:"primary",plain:"",size:"large"},on:{click:function(i){e.formData.content+=t}}},[e._v(" "+e._s(t)+" ")])]})),e._l(e.recommendMessage.list,(function(t){return[i("van-tag",{key:t,staticStyle:{margin:"6px"},attrs:{type:"primary",color:"#ebebeb","text-color":"#34495e",size:"large"},on:{click:function(i){e.formData.content+=t}}},[e._v(" "+e._s(t)+" ")])]}))],2),i("van-row",{staticStyle:{padding:"8px"},attrs:{type:"flex"}},[i("van-uploader",{attrs:{"after-read":e.afterRead,"lazy-load":"","max-size":1024*e.fileMaxSize*1024,"max-count":"10"},on:{oversize:e.onOversize},model:{value:e.fileList,callback:function(t){e.fileList=t},expression:"fileList"}})],1),i("van-row",{staticStyle:{padding:"8px"},attrs:{type:"flex"}},[i("van-checkbox",{model:{value:e.formData.isNotify,callback:function(t){e.$set(e.formData,"isNotify",t)},expression:"formData.isNotify"}},[e._v("通知相关人员")])],1),i("van-row",{staticStyle:{padding:"8px"},attrs:{type:"flex",justify:"center"}},[i("van-button",{staticStyle:{width:"90%","border-radius":"8px"},attrs:{type:"info",size:"normal"},on:{click:function(t){return e.onSend()}}},[e._v(" 发送 ")])],1)],1)])],1)},k=[],I=(i("9a83"),i("f564")),w=(i("e7e5"),i("d399")),C=(i("d9e2"),i("5ae0")),S=i("0173"),O=i("cee4"),E=i("365c"),x=i("f253"),D=i("85b1"),A={name:"IFormDiscussCreator",props:{commentConfig:Object},data(){const{resourceId:e,resourceType:t}=this.commentConfig;return{fileMaxSize:10,fileList:[],formData:{resourceId:e,resourceType:t,content:"",fileList:[],isNotify:!0},show:!1,recommendMessage:{list:["已复核","合格","收到","已阅","情况属实","知晓","确认","已核对"]},historyMessage:{storeKey:"discuss-history-message",list:[],limit:5,wordLimit:5}}},created(){this.eachHistoryMessage()},methods:{onOversize(e){Object(w["a"])(`文件大小不能超过 ${this.fileMaxSize} M`)},async afterRead(e,t){let i=e.file;if(setTimeout(()=>{"done"!==e.status&&Object(w["a"])(`文件 [${e.file.name}] 上传时间过长`)},5e3),e.file.type.includes("image/")||Object(S["f"])(file.name)){const t=await Object(C["a"])(e.file,Number(this.compressor)||.6,{convertSize:1e5});t instanceof File&&(i=t),t instanceof Blob&&(i=new File([t],t.name))}const n=new FormData;n.append("File",i),n.append("DirName",this.$route.params.id),n.append("IsReName","true"),n.append("UploadType","File"),e.status="uploading",e.message="上传中...",O["a"].post(E["d"].getUploadFileUrl(),n,{NotAuth:!0}).then(({data:t})=>{if(1!==t.code)throw new Error("上传失败！");this.formData.fileList.push(`${x["d"]}/${t.data.fileAccessPath}`),e.status="done",e.message="上传完成"}).catch(t=>{this.$notify({type:"danger",message:"附件上传失败,请联系管理员!",duration:5e3}),e.status="failed",e.message="上传失败"})},onShow(){this.show=!0},eachHistoryMessage(){try{this.historyMessage.list=JSON.parse(localStorage.getItem(this.historyMessage.storeKey))||[]}catch(e){}},recordHistoryMessage(e){if(e.length<=this.historyMessage.wordLimit&&!this.recommendMessage.list.includes(e)){const t=this.historyMessage.list.filter(t=>t!==e).slice(0,this.historyMessage.limit-1);t.unshift(e),localStorage.setItem(this.historyMessage.storeKey,JSON.stringify(t)),this.historyMessage.list=t}},notifyUrlGen(){const{formMobileSite:e,formWebSite:t}=window.projectConfig.sites,{resourceId:i,resourceType:n}=this.commentConfig;if(2===n){const n=this.$route.params.id;return{appUrl:`${e}/iform/${n}?bizId=${i}`,webUrl:`${t}/iform/${n}?bizId=${i}`}}{const i=this.$route.params.id;return{appUrl:`${e}/itask/${i}`,webUrl:`${t}/itask/${i}`}}},onSend:Object(D["a"])((async function(){if(!this.formData.content)return void Object(I["a"])("评论必填");const e={...this.formData,...this.notifyUrlGen()};w["a"].loading({message:"评论中...",forbidClick:!0,overlay:!0}),await Object(l["a"])(e),this.$emit("created"),this.recordHistoryMessage(e.content),this.formData.content="",this.formData.fileList=[],this.fileList=[],this.show=!1,w["a"].clear()}),600)}},P=A,T=Object(v["a"])(P,y,k,!1,null,"5a87d652",null),j=T.exports,M=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("van-image",{staticStyle:{"border-radius":"5px",overflow:"hidden"},attrs:{width:"28",height:"28",src:e.avatar}})},$=[],R={name:"IFormDiscussAvatar",props:{avatar:String}},B=R,L=Object(v["a"])(B,M,$,!1,null,null,null),N=L.exports,U={name:"IFormDiscuss",components:{IFormDiscussContent:b,IFormDiscussCreator:j,IFormDiscussAvatar:N},props:{commentConfig:Object},data(){return{search:{resourceId:this.commentConfig.resourceId,pageIndex:1,pageSize:4,sortField:"CreateTime",sortType:"DESC"},discussList:[]}},created(){this.getCommentList()},methods:{prev(){1!==this.search.pageIndex&&(this.search.pageIndex--,this.getCommentList())},next(){const{totalCount:e,pageSize:t,pageIndex:i}=this.search,n=e/t,a=i>=n;a||(this.search.pageIndex++,this.getCommentList())},onCreated(){this.backToFirst()},onCancel(){this.backToFirst()},backToFirst(){this.search.pageIndex=1,this.getCommentList()},getCommentList(){Object(l["e"])(this.search).then(({data:e})=>{this.discussList=e.data,this.search.totalCount=e.count})}}},F=U,W=(i("2917"),Object(v["a"])(F,o,r,!1,null,"539e78b4",null)),z=W.exports,V=i("3bce"),K=i("4a9d"),H=i("09dd"),q=i("6e16"),J=i("1c24"),G=i("bf26"),Y=i("b408"),X=i("9837"),Q=i("163b");const Z=e=>window.URL.createObjectURL(e),ee=()=>"download"in document.createElement("a"),te=e=>"string"===typeof e&&e.includes("blob:"+location.origin),ie=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ne=(e,t,i="auto")=>{if("auto"===i&&(Object(Q["h"])()?ne(e,t,"dd"):ee()&&te(e)?ne(e,t,"aLinkDownload"):ie()?ne(e,t,"currentTab"):ne(e,t,"newTab")),"dd"!==i){if("aLinkDownload"===i){const i=document.createElement("a");i.href=e,i.download=decodeURI(t),document.body.appendChild(i),i.style.display="none",i.click(),i.parentNode.removeChild(i),window.URL.revokeObjectURL(e)}"newTab"===i&&window.open(e),"currentTab"===i&&(location.href=e)}else alert("暂时不支持 Ios 钉钉下载")};var ae=i("2a7f"),se={name:"iform-approval",props:{begin:{type:Boolean,default(){return!0}},returnStep:{type:String,default(){return null}},isProcess:{type:Boolean,default(){return!1}},task:{type:Object,default(){return null}},isPlusTask:{type:Boolean,default(){return!0}},config:{type:Object,default(){return null}},data:{type:Object,default(){return null}},formSnapshotData:{type:Object,default(){return null}},loadSnapshot:{type:Boolean,default(){return!1}}},data(){return{signListReFreshFlag:!0,activeNames:["审批记录","评论"],buttons:[],btnVisible:{},showPicker:!1,activeTask:[],sign:{user:"",remark:"",plusUsers:[],returnStepId:"",signature:"",status:{code:"Submit",name:"提交"}},signTable:{Submit:"提交",Abort:"终止",back:"退回",signature:"加签",Return:"退回"},rules:{},visible:!1,validate:!1,returnStepVisable:!1,plus:!1,additional:!1,addNotify:!1,signs:[],back:!1,configuration:{extension:{allowMulti:!0},code:"user"},isWaiting:!1,visibleApproval:!0,beginStep:null,returnPolicy:"0",currentStep:null,showPrintsList:!1,printsRef:q["c"],stepInfos:[],printLoading:!1}},watch:{begin:{deep:!0,immediate:!0,handler(e){this.initButton()}},task:{deep:!0,immediate:!0,handler(e){this.isProcess&&(this.initButton(),this.currentStep=e.stepInfo,this.beginStep=e.beginStepInfo,this.initStepInfos())}},loadSnapshot:{handler(e){if(e){const e=JSON.parse(this.formSnapshotData.content);this.sign.remark=e.remark,this.sign.signature=e.signature}}}},computed:{saveSnapshotEnable(){var e;return!1!==(null===(e=window.projectConfig)||void 0===e||null===(e=e.featureFlag)||void 0===e?void 0:e.saveSnapshot)},commentConfig(){if(this.isProcess){var e,t;const{CanComment:i,CommentType:n}=(null===(e=this.config)||void 0===e?void 0:e.attributes)||{},{instanceId:a,taskId:s}=(null===(t=this.config)||void 0===t?void 0:t.taskInfo)||{},o=!/^Process\d+$/.test(this.$route.params.id),r=o&&"True"===(null===i||void 0===i?void 0:i.value),l=Number(null===n||void 0===n?void 0:n.value)||0,c=0==l?a:s;return{enable:r,resourceId:c,resourceType:l}}{var i;const e=(null===(i=this.config)||void 0===i||null===(i=i.formConfiguration)||void 0===i||null===(i=i.extension)||void 0===i?void 0:i.canComment)&&this.$route.query.bizId;return{enable:e,resourceId:this.$route.query.bizId,resourceType:2}}},printsBtnVisible(){const e=q["c"].value.undersign.enable;return e},iform(){return this.$refs["iform-approval-form"]},instanceId(){return this.task?this.task.instanceId:""},isView(){let e=this.$route.query.Action||this.$route.query.action||"";return"view"===e.toLowerCase()&&e.length>0},disabled(){return this.$store.getters.disabled},hideSign(){return this.$store.getters.hideSign},isSignTask(){return 101===this.task.subStatus},auditItems(){let e=[];this.config&&this.config.stepInfo&&(e=this.config.stepInfo.auditItems||[]);const t=e.some(e=>"Abort"===e.code);if(!t){const{approvalAddAbortButton:t}=window.projectConfig,{enable:i,buttonText:n}=t||{};!this.begin&&i&&e.push({code:"Abort",text:n||"拒绝"})}return e},label:{get(){let e=this,t=[],i=e.sign.returnStepId;return e.options.forEach(e=>{i===e.value&&t.push(e.label)}),t.join(",")},set(e){}},returnPolicyDefault(){return!this.currentStep||!this.currentStep.attributes||"1"!==this.currentStep.attributes.returnPolicy&&"2"!==this.currentStep.attributes.returnPolicy},options(){const e=this.currentStep||{},t=e.attributes;if(!t)return[];const{returnPolicy:i,returnSteps:n}=t;if("1"===i)try{const e=JSON.parse(n);return e.map(e=>{const t=(e+"").split("#"),[i,n]=t;return{label:i,value:n}})}catch(o){return[]}if("2"===i){const e=[],t=this;let i=null;for(var a=0;a<t.stepInfos.length;a++)if(t.stepInfos[a].stepId===t.currentStep.stepId&&a>0&&(i=t.stepInfos[a-1]),i){let t=!1;for(var s=0;s<e.length;s++){let n=e[s];n.value===i.stepId&&(t=!0)}t||e.push({value:i.stepId,label:i.stepName})}return e}return[]},isProcessOverview(){var e;const{processInitiatorName:t,taskUserName:i}=this.config.taskInfo;return"2"==(null===(e=this.config.attributes)||void 0===e||null===(e=e.ProcessViewType)||void 0===e?void 0:e.value)&&t==this.userName},userName(){return this.$store.getters.userInfo.UserName},instanceStatus(){var e;const t=(null===(e=this.config)||void 0===e?void 0:e.taskInfo)||{};return t.instanceStatus},enableApproveSign(){var e,t;const i=null===(e=this.currentStep)||void 0===e||null===(e=e.attributes)||void 0===e?void 0:e.EnableApproveSign;return["True","False"].includes(i)?"True"===i:!1!==(null===(t=window.projectConfig)||void 0===t||null===(t=t.featureFlag)||void 0===t?void 0:t.enableApproveSign)},globalEnableApproveSign(){var e;return!1!==(null===(e=window.projectConfig)||void 0===e||null===(e=e.featureFlag)||void 0===e?void 0:e.enableApproveSign)},showApproveSign(){var e;const{forceEnableApproveSign:t}=null===(e=window.projectConfig)||void 0===e?void 0:e.featureFlag;return!!t||this.globalEnableApproveSign&&this.enableApproveSign}},methods:{initStepInfos(){let e=this;1!==e.task.status||e.options.length||E["d"].getProcessStepByVersion(e.task.processName,e.task.version).then(t=>{1===t.code&&(console.log("getPrrocessStepByVersion",t.data),t.data.forEach(t=>{e.task.stepId===t.stepId&&(e.currentStep=t),"20"===t.stepSubType&&(e.beginStep=t)}),e.stepInfos=t.data)})},init(){let e=this;e.initButton(),e.handleRule()},handleConfirm(e){this.sign.returnStepId=e.value,this.showPicker=!1},handleCancel(){this.sign.returnStepId="",this.showPicker=!1},existButton(e){for(let t=0;t<this.auditItems.length;t++)if(this.auditItems[t].code.toLowerCase()===e.toLowerCase())return this.auditItems[t];return!1},initButton(){let e=this,t=[];if(e.auditItems.length){let i=e.existButton("Submit")||e.existButton("Approve");i&&t.push(new J["n"](!e.begin,t=>{e.handleSubmit(t)},!0,{type:"info",size:"medium"},i.code,i.text))}else t.push(new J["n"](!e.begin,t=>{e.handleSubmit(t)},!0,{type:"primary",size:"medium"}));if(e.isProcess)if(e.begin)if(e.task&&e.task.instanceId)if(e.visibleApproval=!0,e.auditItems.length){let i=e.existButton("Stall");i&&t.push(new J["m"](t=>{e.handleStall(t)},!0,{size:"medium"},i.code,i.text))}else t.push(new J["m"](t=>{e.handleStall(t)},!0,{size:"medium"}));else if(e.task&&0===e.task.taskId.indexOf("TMP"))if(e.auditItems.length){let i=e.existButton("Draft");i&&t.push(new J["j"](t=>{e.handleDraft(t)},!0,{size:"medium"},i.code,i.text))}else t.push(new J["j"](t=>{e.handleDraft(t)},!0,{size:"medium"}));else e.visibleApproval=!1;else if(e.visibleApproval=!0,e.isSignTask)t.push(new J["n"](!e.begin,t=>{e.handleDisagree(t)},!0,{size:"medium"},null,"不同意"));else{if(e.auditItems.length){let i=e.existButton("Return");i&&(t.push(new J["g"](t=>{e.handleBack(t)},!0,{type:"danger",size:"medium"},"ReturnSure",i.text)),t.push(new J["h"](t=>{e.handleBacknature(t)},!1,{size:"medium"},i.code,i.text)))}else t.push(new J["g"](t=>{e.handleBack(t)},!0,{type:"danger",size:"medium"})),t.push(new J["h"](t=>{e.handleBacknature(t)},!1,{size:"medium"}));if(e.auditItems.length){let i=e.existButton("Abort");i&&t.push(new J["a"](t=>{e.handleStall(t)},!0,{size:"medium"},i.code,i.text))}else t.push(new J["a"](t=>{e.handleStall(t)},!0,{size:"medium"}));if(e.auditItems.length){let i=e.existButton("Plus");i&&(t.push(new J["l"](t=>{e.handleSignature(t)},!1,{size:"medium"},i.code,i.text)),t.push(new J["k"](t=>{e.handlePlus(t)},!0,{size:"medium"},"PlusSure",i.text)));let n=e.existButton("Additional");n&&(t.push(new J["e"](t=>{e.handleAdditionalSubmit(t)},!1,{size:"medium"},n.code,n.text)),t.push(new J["d"](t=>{e.handleAdditional(t)},!0,{size:"medium"},"AdditionalSure",n.text)));let a=e.existButton("AddNotify");a&&(t.push(new J["c"](t=>{e.handleAddNotifySubmit(t)},!1,{size:"medium"},a.code,a.text)),t.push(new J["b"](t=>{e.handleAddNotify(t)},!0,{size:"medium"},"AddNotifySure",a.text)))}else t.push(new J["l"](t=>{e.handleSignature(t)},!1,{size:"medium"})),t.push(new J["k"](t=>{e.handlePlus(t)},!0,{size:"medium"})),t.push(new J["e"](t=>{e.handleAdditionalSubmit(t)},!1,{size:"medium"})),t.push(new J["d"](t=>{e.handleAdditional(t)},!0,{size:"medium"})),t.push(new J["c"](t=>{e.handleAddNotifySubmit(t)},!1,{size:"medium"})),t.push(new J["b"](t=>{e.handleAddNotify(t)},!0,{size:"medium"}))}else if("iform"===e.$route.name&&!e.$route.query.bizid&&!e.$route.query.bizId&&e.auditItems.length){e.existButton("Draft")}function i(e){for(let i=0;i<t.length;i++)if(t[i].code.toLowerCase()===e.toLowerCase())return!0;return!1}(i("Return")||i("Plus"))&&t.push(new J["i"](t=>{e.handleCannel(t)},!1,{size:"medium"})),e.buttons=t},handleEvent:Object(D["a"])(e=>{e.click&&e.click.call()},500),handleRule(){let e=this,t=new G["b"]("remark","意见必填","blur",new G["a"](t=>!(e.validate&&!t)||"请输入意见")),i=new G["b"]("user","请选择用户","change",new G["a"](t=>!(e.plus&&!t)||"请选择用户")),n=new G["b"]("returnStepId","请选择退回节点","change",new G["a"](t=>!(e.back&&!t&&!e.returnPolicyDefault)||"请选择退回节点")),a=new G["b"]("signature","签名必填","change",new G["a"](e=>{var t;return!(this.showApproveSign&&"True"===(null===(t=this.currentStep)||void 0===t||null===(t=t.attributes)||void 0===t?void 0:t.ApproveSignRequired)&&!e)||this.$t("签名必填")})),s={user:[i],remark:[t],returnStepId:[n],signature:[a]};e.rules=s},handleHide(e,t){this.buttons.forEach(i=>{e instanceof Array?e.forEach(e=>{i.code===e&&(i.visible=t)}):i.code===e&&(i.visible=t)})},handleSwitchPlus(){let e=this;e.plus?(e.handleHide([e.begin?"Submit":"Approve","PlusSure","Abort","ReturnSure","AdditionalSure","AddNotifySure"],!1),e.handleHide(["Plus","Cannel","Draft"],!0)):(e.handleHide([e.begin?"Submit":"Approve","PlusSure","Abort","ReturnSure","AdditionalSure","AddNotifySure"],!0),e.handleHide(["Cannel","Plus","Draft"],!1))},handleSwitchAdditional(){let e=this;e.additional?(e.handleHide([e.begin?"Submit":"Approve","PlusSure","AdditionalSure","AddNotifySure","Abort","ReturnSure"],!1),e.handleHide(["Additional","Cannel","Draft"],!0)):(e.handleHide([e.begin?"Submit":"Approve","PlusSure","AdditionalSure","AddNotifySure","Abort","ReturnSure"],!0),e.handleHide(["Cannel","Additional","Draft"],!1))},handleSwitchAddNotify(){let e=this;e.addNotify?(e.handleHide([e.begin?"Submit":"Approve","PlusSure","AdditionalSure","AddNotifySure","Abort","ReturnSure"]),e.handleHide(["AddNotify","Cannel","Draft"],!0)):(e.handleHide([e.begin?"Submit":"Approve","PlusSure","AdditionalSure","AddNotifySure","Abort","ReturnSure"]),e.handleHide(["Cannel","AddNotify","Draft"],!1))},handleSubmit(e){let t=this;t.isProcess?(t.validate=!1,t.handleValidate(e,()=>{const i=this.buttons.find(t=>t.code===e);let n;n=t.begin?"提交":i.title||"同意",t.handleSignData(e,n),K["a"].$emit("iform.task.submit",t.sign)})):K["a"].$emit("iform.task.submit")},handlePlusReturn(e){let t=this;t.isProcess?(t.validate=!1,t.handleValidate(e,()=>{t.handleSignData(e,"加签退回"),K["a"].$emit("iform.task.submit",t.sign)})):K["a"].$emit("iform.task.submit")},handleDisagree(e){let t=this;t.validate=!0,t.handleValidate(e,()=>{t.handleSignData(e,"不同意"),t.sign.returnStepId=t.beginStep.stepId,K["a"].$emit("iform.task.disagree",t.sign)})},handleStall(e){let t=this;t.validate=!0,t.handleValidate(e,()=>{t.handleSignData(e),K["a"].$emit("iform.task.stall",t.sign)})},handleSignature(e){let t=this;t.validate=!0,t.handleValidate(e,()=>{t.handleSignData(e,"加签",!0),K["a"].$emit("iform.task.signature",t.sign)})},handlePlus(){let e=this;e.plus=!0,e.validate=!0,e.visible=!0,e.handleSwitchPlus()},handleAdditionalSubmit(e){let t=this;t.validate=!0,t.handleValidate(e,()=>{t.handleSignData(e,"追加审批",!0),K["a"].$emit("iform.task.additional",t.sign)})},handleAdditional(){let e=this;e.additional=!0,e.validate=!0,e.visible=!0,e.handleSwitchAdditional()},handleAddNotifySubmit(e){let t=this;t.validate=!0,t.handleValidate(e,()=>{t.handleSignData(e,"转发",!0),K["a"].$emit("iform.task.addNotify",t.sign)})},handleAddNotify(){let e=this;e.addNotify=!0,e.validate=!0,e.visible=!0,e.handleSwitchAddNotify()},handleCannel(){let e=this,t=e.plus;e.plus=!1,e.additional=!1,e.addNotify=!1,e.back=!1,e.validate=!1,e.visible=!1,t?e.handleSwitchPlus():e.additional?e.handleSwitchAdditional():e.addNotify?e.handleSwitchAddNotify():e.handleSwitchBack(),e.handleValidate()},handleDraft(e){let t=this;t.validate=!1,t.handleSignData(e),t.handleValidate(e,()=>{K["a"].$emit("iform.task.draft",t.sign)})},handleBack(){let e=this;e.back=!0,e.validate=!0,e.returnPolicyDefault?(e.sign.returnStepId=null,e.handleBacknature("Return")):e.handleSwitchBack()},handleBacknature(e){let t=this;t.validate=!0,t.handleValidate(e,i=>{t.handleSignData(e),K["a"].$emit("ifrom.task.back",t.sign)})},handleSwitchBack(){let e=this;e.back?(e.returnStepVisable=!0,e.handleHide([e.begin?"Submit":"Approve","Plus","PlusSure","Abort","ReturnSure","Additional","AdditionalSure","AddNotify","AddNotifySure"],!1),e.handleHide(["Return","Cannel","Draft"],!0)):(e.returnStepVisable=!1,e.handleHide(["Return","Plus","Additional","AddNotify","Cannel","Draft"],!1),e.handleHide([e.begin?"Submit":"Approve","ReturnSure","Abort","PlusSure","AdditionalSure","AddNotifySure"],!0))},handleValidate(e,t){const i=this.buttons.find(t=>t.code===e).title||"加签";let n=this;if("Plus"===e){if(!n.sign.user||!n.sign.user.length)return void n.$notify({message:`请选择${i}人员!`,type:"danger"})}else{var a;if(n.validate&&!n.sign.remark)return void n.$notify({message:"请填写意见!",type:"danger"});if(!this.task.isBeginStep&&"True"===(null===(a=this.currentStep)||void 0===a||null===(a=a.attributes)||void 0===a?void 0:a.ApproveSignRequired)&&!n.sign.signature)return void n.$notify({message:"请填写签名!",type:"danger"})}iduo.form.valid(e=>{t instanceof Function&&t.call()})},handleSignData(e,t,i){const n=this.buttons.find(t=>t.code===e);this.sign.status.code=e,n.__statusName?this.sign.status.name=n.__statusName:this.sign.status.name=t||n.title||this.signTable[e],i?"Additional"===e||"AddNotify"===e?this.sign.additionalUsers=JSON.parse(this.sign.user):this.sign.plusUsers=JSON.parse(this.sign.user):this.sign.plusUsers=[]},convertDate(e){return Object(V["d"])(e)},handlePrints(e){switch(this.showPrintsList=!1,e){case"sign":this.downloadDocumentSigning();break;case"wordTemp":this.handleDownload("word");break;case"pdfTemp":this.handleDownload("pdf");break;default:break}},async handleDownload(e){this.printLoading=!0;const t="word"===e?"doc":"pdf",i=(e,t)=>{const i=document.createElement("a"),n=window.URL.createObjectURL(t);i.href=n,i.download=decodeURI(e),i.style.display="none",document.body.appendChild(i),i.click(),i.parentNode.removeChild(i),window.URL.revokeObjectURL(n)},n=async(e,t)=>{const{data:i}=await Object(l["h"])(e);return!(1!==i.code||!i.data)||(this.printLoading=!1,this.$notify({type:"warning",message:`该${t}没有上传打印模版，请到${t}设计中心配置模版！`}),!1)};if(this.isProcess){var a,s;if(null===(a=this.config)||void 0===a||!a.taskInfo)return this.$notify({type:"warning",message:"当前步骤无法执行本操作！"}),void(this.printLoading=!1);const{instanceId:o,processDefKey:r,processName:c,processInitiatorName:d,instanceStartTime:u}=null===(s=this.config)||void 0===s?void 0:s.taskInfo,f=await n(r,"流程");if(!f)return;Object(l["i"])(o,r,m()().format("YYYY-MM-DD"),e).then(({data:e})=>{this.printLoading=!1;const{code:n,message:a}=e;9!==n?i(`${d}申请的${c}表单${u}.${t}`,e):this.$message.error(a)})}else{if(!this.bizId)return this.$notify({type:"warning",message:"表单提交阶段，无法使用模版打印"}),void(this.printLoading=!1);const a=await n(this.formId,"表单");if(!a)return;Object(l["j"])(this.formId,this.bizId,this.formId,e).then(({data:e})=>{this.printLoading=!1;const{code:n,message:a}=e;9!==n?i(`${this.configuration.name}表单${this.configuration.serverDateTime}.${t}`,e):this.$message.error(a)})}},downloadDocumentSigning(){const e=()=>{if(this.isProcess)return Object(H["a"])(this.instanceId,this.config.name+".pdf").then(({data:e})=>{if(0!=e.code)return Object(H["c"])(x["d"]+e);this.$notify({type:"danger",message:e.message})});{var e;const{version:t,posPage:i,posX:n,posY:a,width:s,sealSn:o}=null===(e=this.config.formConfiguration)||void 0===e?void 0:e.extension;return Object(H["b"])({version:t,formId:this.formId,bizId:this.bizId,tmplName:this.formId,posPage:i,posX:n,posY:a,width:s,sealSn:o})}};e().then(e=>{const t=e.data;e.data.text().then(e=>{if(e.includes('"code":0'))this.$notify({type:"danger",message:JSON.parse(e).message});else{const e=Z(t),i=this.config.name+".pdf";ne(e,i)}})})},async handleSaveSnapshot(){const e={};this.config.formConfiguration.formItems.filter(t=>{t.isReadable||!t.extension.isHideControl||t.extension.isLogicHide||(e[t.code]=this.data[t.code])}),e.remark=this.sign.remark,e.signature=this.sign.signature;const{data:t}=await(this.formSnapshotData?Object(l["p"])({id:this.formSnapshotData.id,content:JSON.stringify(e)}):Object(l["c"])({taskId:this.config.taskInfo.taskId,content:JSON.stringify(e)}));1===t.code?this.$notify({type:"success",message:this.formSnapshotData?"更新成功":"保存成功"}):this.$notify({type:"danger",message:t.message})}},mounted(){K["a"].$on("itask.refreshSignList",()=>{this.signListReFreshFlag=!1,setTimeout(()=>{this.signListReFreshFlag=!0})}),Object(X["b"])("iform-approval",this),this.init(),Object(q["a"])(this),!this.task.isBeginStep&&this.showApproveSign&&Object(l["l"])().then(({data:e})=>{var t;1===e.code&&(this.sign.signature=null===(t=e.data)||void 0===t?void 0:t.path)})},components:{"iform-control-ocbox":s["default"],"iform-sign-list":Y["a"],IFormDiscuss:z,ApproveSign:ae["a"]}},oe=se,re=(i("ae4e"),Object(v["a"])(oe,n,a,!1,null,"ecab2076",null));t["a"]=re.exports},"0905":function(e,t,i){"use strict";i("9038")},"096c":function(e,t,i){"use strict";i("32e1")},"11ce":function(e,t,i){"use strict";i("5e72")},"16ad":function(e,t,i){"use strict";i("c38b")},"18cc":function(e,t,i){},1996:function(e,t,i){"use strict";i("35cb")},"19e4":function(e,t,i){"use strict";i("1d53")},"1bbf":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"iform-plus-pannel"},[i("van-dialog",{attrs:{title:"加签任务列表",visible:e.flag,width:"50%","before-close":e.handleClose},on:{"update:visible":function(t){e.flag=t}}},[i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("van-button",{attrs:{type:"primary",disabled:e.disabled},on:{click:e.handleBackPlus}},[e._v("收回加签")])],1)])],1)},a=[],s=(i("14d9"),i("365c")),o=i("4a9d"),r={name:"iform-plus-pannel",data(){return{flag:!1,data:[],selections:[],disabled:!1}},props:{id:{type:String,default(){return null}},visable:{type:Boolean,default(){return!1}}},watch:{visable:{deep:!0,immdiate:!0,handler(e){this.flag=this.visable,this.handleLoad()}}},methods:{init(){this.handleLoad()},handleLoad(){let e=this;e.id&&s["d"].getSigntureTaskListByTaskId(e.id).then(t=>{console.log("getSigntureTaskListByTaskId",t),e.data=t.data,e.disabled=!1}).catch(e=>{console.log("getSigntureTaskListByTaskId.error",e)})},handleSelection(e){this.selections=e},handleBackPlus(){let e=this,t=[],i=[];e.disabled=!0,e.selections.length&&(e.selections.forEach(e=>{t.push(e.signatureTaskId),i.push(e.assigneeName)}),s["d"].takeBackSignatureTask(t).then(t=>{1===t.code?(e.handleClose(),e.$message({message:t.message,type:"success"}),i.forEach(e=>{o["a"].$emit("iform.sign.create","backsign","收回加签","收回"+e+"的加签任务",3)})):e.$message.error(t.message)}).catch(e=>{console.log("takeBackSignatureTask.error",e)}))},handleClose(){this.$emit("update:visable",!1)}},mounted(){}},l=r,c=i("2877"),d=Object(c["a"])(l,n,a,!1,null,null,null);t["a"]=d.exports},"1c24":function(e,t,i){"use strict";i.d(t,"n",(function(){return s})),i.d(t,"m",(function(){return o})),i.d(t,"a",(function(){return r})),i.d(t,"g",(function(){return l})),i.d(t,"l",(function(){return c})),i.d(t,"k",(function(){return d})),i.d(t,"i",(function(){return u})),i.d(t,"h",(function(){return f})),i.d(t,"j",(function(){return h})),i.d(t,"f",(function(){return m})),i.d(t,"e",(function(){return p})),i.d(t,"d",(function(){return g})),i.d(t,"c",(function(){return v})),i.d(t,"b",(function(){return _}));var n=i("4a9d");function a(e,t,i,a,s){return this.code=e,this.visible=!0,this.title=t,this.size="mini",this.visible=void 0===a||a,"function"===typeof i&&(this.click=()=>{n["a"].$emit("approval.button.click",this),i()}),Object.assign(this,s||{})}function s(e,t,i,n,s,o){let r=s||(e?"Approve":"Submit");return a.call(this,r,o||(e?"同意":"提交"),()=>{"function"===typeof t&&t(r)},i,Object.assign({type:"primary"},n))}function o(e,t,i,n,s){let o=n||"Stall";return a.call(this,o,s||"终止",()=>{e instanceof Function&&e(o)},t,i)}function r(e,t,i,n,s){let o=n||"Abort";return a.call(this,o,s||"不同意",()=>{e instanceof Function&&e(o)},t,i)}function l(e,t,i,n,s){let o=n||"ReturnSure";return a.call(this,o,s||"退回",()=>{e instanceof Function&&e(o)},t,i)}function c(e,t,i,n,s){let o=n||"Plus";return a.call(this,o,s||"提交",()=>{e instanceof Function&&e(o)},t,Object.assign({type:"primary"},i))}function d(e,t,i,n,s){let o=n||"PlusSure";return a.call(this,o,s||"加签",()=>{e instanceof Function&&e(o)},t,i)}function u(e,t,i,n,s){let o=n||"Cannel";return a.call(this,o,s||"取消",()=>{e instanceof Function&&e(o)},t,i)}function f(e,t,i,n,s){let o=n||"Return";return a.call(this,o,s||"退回",()=>{e instanceof Function&&e(o)},t,i)}function h(e,t,i,n,s){let o=n||"Draft";return a.call(this,o,s||"存稿",()=>{e instanceof Function&&e(o)},t,Object.assign({},i))}function m(e,t,i,n){let s=void 0!==n&&null!==n&&""!==n?n:"添加";return a.call(this,"append",s,()=>{e instanceof Function&&e("append")},t,i)}function p(e,t,i,n,s){let o=n||"Additional";return a.call(this,o,s||"追加审批提交",()=>{e instanceof Function&&e(o)},t,Object.assign({type:"primary"},i))}function g(e,t,i,n,s){let o=n||"AdditionalSure";return a.call(this,o,s||"追加审批",()=>{e instanceof Function&&e(o)},t,i)}function v(e,t,i,n,s){let o=n||"AddNotify";return a.call(this,o,s||"转发提交",()=>{e instanceof Function&&e(o)},t,Object.assign({type:"primary"},i))}function _(e,t,i,n,s){let o=n||"AddNotifySure";return a.call(this,o,s||"转发",()=>{e instanceof Function&&e(o)},t,i)}},"1d53":function(e,t,i){},2917:function(e,t,i){"use strict";i("036d")},"2a7f":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"signature-container"},[e.onlyPreview?[e.modelValue?i("van-image",{staticClass:"sign__pad__preview",attrs:{src:e.src,alt:"signature",fit:"contain"},on:{click:function(t){e.imagePreviewVisible=!0}}}):e._e()]:i("div",{staticClass:"sign__pad",on:{click:e.handleBeginToSign}},[e.modelValue?i("van-image",{staticClass:"sign__pad__preview",attrs:{src:e.src,alt:"signature",fit:"contain"}}):e._e(),e.onlyPreview||e.modelValue?e._e():i("div",{staticClass:"sign__pad__text"},[e._v(" "+e._s(e.$t("点我签名"))+" ")])],1),i("van-icon",{staticClass:"sign__pad__delete",attrs:{name:"cross"},on:{click:function(t){return e.$emit("update:modelValue","")}}}),i("van-popup",{model:{value:e.imagePreviewVisible,callback:function(t){e.imagePreviewVisible=t},expression:"imagePreviewVisible"}},[i("van-image",{attrs:{src:e.modelValue,alt:"signature",fit:"contain"}})],1),i("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:e.drawerVisible,callback:function(t){e.drawerVisible=t},expression:"drawerVisible"}},[i("van-nav-bar",{attrs:{title:e.$t("审批签名")},scopedSlots:e._u([{key:"right",fn:function(){return[i("van-icon",{attrs:{name:"cross",size:"18"},on:{click:function(t){e.drawerVisible=!1}}})]},proxy:!0}])}),e.drawerVisible?i("FullScreenSignaturePad",{on:{confirm:e.handleSignConfirm}}):e._e()],1)],2)},a=[],s=i("8e3d"),o=i("e1b8"),r={name:"ApproveSign",components:{FullScreenSignaturePad:s["a"]},model:{prop:"modelValue",event:"update:modelValue"},props:{modelValue:{type:String||Object||Array},onlyPreview:{type:Boolean,default:!1}},data(){return{imagePreviewVisible:!1,drawerVisible:!1}},computed:{token(){return o["a"].getToken().access_token},src(){return this.modelValue.includes("?")?this.modelValue+"&access_token="+this.token:this.modelValue+"?access_token="+this.token}},methods:{handleBeginToSign(){this.onlyPreview||(this.drawerVisible=!0)},handleSignConfirm(e){this.$emit("update:modelValue",e),this.drawerVisible=!1}},mounted(){}},l=r,c=(i("8a1e"),i("2877")),d=Object(c["a"])(l,n,a,!1,null,"5e3f21a5",null);t["a"]=d.exports},"2d22":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:e.configuration.code+"-formatter",staticClass:"iform-control-format"},[e.formatter?[i("div",{domProps:{innerHTML:e._s(e.formatterHtml)}})]:[e.renderAsQC?[i("qrcode",{attrs:{url:e.value,width:120,height:120}})]:e.is(e.configuration,["filebox","taohong"])?i("div",[i("FileBoxFormatter",{attrs:{data:e.data,configuration:e.configuration}})],1):e.is(e.configuration,"_link")?i("iform-control-link",{attrs:{data:e.data,configuration:e.configuration}}):e.is(e.configuration,"span")?i("iform-control-span",{attrs:{data:e.data,configuration:e.configuration}}):e.is(e.configuration,"signature")?i("SignaturePad",{attrs:{data:e.data,configuration:e.configuration,preview:""}}):e.is(e.configuration,"htmledit")?i("div",{domProps:{innerHTML:e._s(e.formatterValue)}}):e.isPhone?i("div",[i("a",{attrs:{href:"tel:"+e.formatterValue}},[e._v(e._s(e.formatterValue))])]):i("div",{staticStyle:{"white-space":"pre-wrap"}},[e._v(" "+e._s(e.formatterValue||e.fallbackValue)+" "),e.appendContent?i("span",[e._v(e._s(e.appendContent))]):e._e()])]],2)},a=[],s=i("9837"),o=i("3bce"),r=i("ebce"),l=i("8188"),c=i("dee4"),d=i("9cb5"),u=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"file-box-formatter"},[e._l(e.fileList,(function(t,n){return[i("van-image",{key:n,staticClass:"van-uploader__preview van-multi-ellipsis--l3",attrs:{width:"100",height:"100",src:t.url},on:{click:function(i){return e.onClickPreview(t)}},scopedSlots:e._u([{key:"error",fn:function(){return[e._v(" "+e._s(t.name)+" ")]},proxy:!0}],null,!0)})]})),i("filePreview",{attrs:{url:e.fileViewer.url,uri:e.fileViewer.uri,name:e.fileViewer.name},model:{value:e.fileViewer.visible,callback:function(t){e.$set(e.fileViewer,"visible",t)},expression:"fileViewer.visible"}})],2)},f=[],h=(i("4662"),i("28a2")),m=(i("365c"),i("ac6a")),p=i("0173"),g={components:{FilePreview:m["a"]},name:"file-box-formatter",props:{data:Object,configuration:Object},data(){return{fileViewer:{name:"",url:"",visible:!1}}},computed:{fileList(){const e=this.data[this.configuration.code];try{const t=JSON.parse(e)||[];return t.map(e=>({...e,url:Object(p["b"])(e)}))}catch(t){return[]}}},methods:{onClickPreview(e){const{enable:t,fixedAction:i,fixedActionName:n}=Object(p["e"])(),a=Object(p["b"])(e);t?i?Object(p["d"])(n,a,e.name):(this.fileViewer.url=a,this.fileViewer.uri=e.uri,this.fileViewer.name=e.name,this.fileViewer.visible=!0):Object(p["f"])(a)?Object(h["a"])([a]):window.open(a)}}},v=g,_=i("2877"),b=Object(_["a"])(v,u,f,!1,null,null,null),y=b.exports,k=i("c987"),I={name:"iform-control-format",components:{"iform-control-link":r["default"],"iform-control-span":l["default"],FileBoxFormatter:y,SignaturePad:d["default"]},props:{data:Object,formData:Object,isGrid:Boolean,configuration:Object,editIndex:Number},data(){return{formatterHtml:this.data[this.configuration.code]}},computed:{fallbackValue(){return this.configuration.__oldValue},renderAsQC(){var e;return!0===(null===(e=this.configuration)||void 0===e?void 0:e.extension.renderAsQC)},formula(){return this.configuration.extension.formula},value(){return null==this.data[this.configuration.code]?"":this.data[this.configuration.code]},formatter(){var e;return(null===(e=this.configuration)||void 0===e||null===(e=e.extension)||void 0===e?void 0:e.formatter)||""},formatterValue(){const e=Object(o["e"])(this.configuration,this.value);return null==e?"":e||this.value},isPhone(){return/^1[3456789]\d{9}$/.test(this.formatterValue)},appendContent(){return this.configuration?this.configuration.extension.appendContent:""}},watch:{data(){this.runFormatterHtml()}},mounted(){Object(s["b"])(this.configuration.code,this),this.initFormula(),this.runFormatterHtml()},methods:{is(e,t){return Object(o["r"])(e,t)},initFormula(){const{initWatcher:e,initGlobalStateWatcher:t,hasFormula:i}=Object(k["b"])(this.formula,this,()=>({...this.formData||{},...this.data}),e=>{this.data[this.configuration.code]=e});i&&(e(this.data),e(this.formData),t())},async runFormatterHtml(){if(!this.formatter)return;const e=Object(c["b"])(this.formatter);this.$nextTick(async()=>{this.formatterHtml=await e(this.value,this.editIndex,this.data)})}}},w=I,C=(i("a2c2"),Object(_["a"])(w,n,a,!1,null,"0f25c8fa",null));t["default"]=C.exports},"2dfa":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"form-head",style:{height:e.formHeadConfig.headHeight}},[i("img",{attrs:{src:e.headBackgroundImage}}),i("p",{staticClass:"title"},[e._v(e._s(e.name))])])},a=[],s=i("e1b8"),o={name:"FormHead",components:{},props:{name:{type:String,default:""},formHeadConfig:{type:Object,default:()=>{}}},computed:{token(){return s["a"].getToken().access_token},headBackgroundImage(){return this.formHeadConfig.headBackgroundImage+"?access_token="+this.token}}},r=o,l=(i("64e4"),i("2877")),c=Object(l["a"])(r,n,a,!1,null,"0b0e179c",null);t["a"]=c.exports},"2e84":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return s})),i.d(t,"c",(function(){return o}));i("9a83");var n=i("f564");i("d9e2");const a=[],s=()=>{a.length=0},o=async()=>{const e=await Promise.all(a.map(async e=>e.checkCode())),t=e.every(e=>e.status);if(!t){const t=e.filter(e=>!e.status).map(e=>e.message).join(",");throw Object(n["a"])({type:"danger",message:t}),Error(t)}}},"2fc5":function(e,t,i){},3142:function(e,t,i){"use strict";i("a7d6")},"32e1":function(e,t,i){},"35cb":function(e,t,i){},"36b8":function(e,t,i){},"3ce3":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("14d9"),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),_api__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("365c"),_utils_Event__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("4a60"),_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("3bce"),_components_iform_js_Base__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("9837"),_components_iform_pannel_IFormTop__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("3fd6"),_components_iform_pannel_IFormBody__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("beca"),_components_iform_pannel_IFormApproval__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("079e"),_components_iform_pannel_IPlusPannel__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("1bbf"),_components_iform_pannel_js_SystemDictionary__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("073c"),_components_iform_controls_prop_RemoteResource__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("c449"),_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("4a9d"),dayjs__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("5a0c"),dayjs__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(dayjs__WEBPACK_IMPORTED_MODULE_12__),_api_url__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("99b1"),_utils_help__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("163b"),_utils_i18n__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("79fa"),_api_task_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("b199"),_api_iform__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("d3be"),_source_id__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("f50e"),_dictionary__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("9569"),_FormHead_vue__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("2dfa"),_components_iform_controls_visual_verification_code__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("2e84");__webpack_exports__["a"]={data(){return{iFormBodyKey:Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["v"])(6),loaded:!1,processDefKey:"",loadSuccess:!1,firstSubmit:!0,iformApprovalVisible:!0,begin:!0,data:null,topData:null,configuration:null,formAutoNumber:[],bizId:"",task:null,hideSign:!0,isPlusTask:!1,plusVisable:!1,uploadPath:_api__WEBPACK_IMPORTED_MODULE_1__["d"].getUploadPath(),process:"",autoSaveDraftId:"",existScripts:!1,visible:!1,inputDraftName:"",extendBpmData:{},title:"",approvalBtn:null,events:{"iform.task.submit":this.submit,"iform.task.disagree":this.disagree,"iform.task.stall":this.stall,"iform.task.signature":this.signature,"iform.task.additional":this.additional,"iform.task.addNotify":this.addNotify,"iform.task.draft":this.draft,"ifrom.task.back":this.back,"iform.sign.create":this.createSignInfo,"iform.save":this.save,"iform.top.save":this.saveTop,"iform.task.setVariable":this.setVariable,"iform.task.setVariableByKey":this.setVariableByKey,"iform.task.setSummary":this.setSummary,"approval.button.click":this.handleApprovalBtnClick},element:null,formSnapshotData:null,loadSnapshot:!1}},provide(){return{parent:this}},watch:{$route:"fetchData"},computed:{userId(){let e=this.$store.getters.userInfo;return null!=e?e.UserAccount:null},id(){return this.$route.params.id||""},store(){return this.$store},form(){return this.$refs["iform-body"]},grids(){return this.$store.getters.grids},user(){return this.$store.getters.userInfo},resource(){var e;return this.configuration?null===(e=this.configuration.formConfiguration)||void 0===e||null===(e=e.extension)||void 0===e?void 0:e.resource:null},draftId(){return this.$route.params.draftId||""},bizTaskId(){return this.$route.query.bizTaskId||""},scriptUrl(){return this.processDefKey?Object(_utils_help__WEBPACK_IMPORTED_MODULE_14__["s"])(this.processDefKey,1):""},closeValidationPrompt(){var e;return null===(e=this.configuration.formConfiguration)||void 0===e||null===(e=e.extension)||void 0===e?void 0:e.closeValidationPrompt},enableHttpLoading(){var e;return null===(e=projectConfig.enableHttpLoading)||void 0===e||e},formHeadConfig(){const e=this.configuration.formConfiguration.extension;return e&&e.formHeadConfig?JSON.parse(e.formHeadConfig):{}}},methods:{handleReadNotifyTask(e){const t=41;t===e.taskSubStatus&&_api_task_js__WEBPACK_IMPORTED_MODULE_16__["a"].readNotifyTask(this.user.UserAccount,this.configuration.taskInfo.taskId)},fetchData(){this.init(),this.firstSubmit=!0,location.reload()},topScriptUrlGen(){var e;const t=null===(e=this.configuration)||void 0===e||null===(e=e.attributes)||void 0===e||null===(e=e.masterPage)||void 0===e?void 0:e.value;return t?Object(_utils_help__WEBPACK_IMPORTED_MODULE_14__["s"])(t,2):""},getQueryDto(e="",t="StartTime"){return{pageIndex:1,pageSize:2,sortType:"descending",totalCount:0,sortField:t,keyWord:e}},getParamsforTistList(){const e={userId:this.userId};return e},handleApprovalBtnClick(e){this.approvalBtn=e},init(){let e=this;Object(_components_iform_js_Base__WEBPACK_IMPORTED_MODULE_4__["b"])("form-target",e),e.id&&(e.store.dispatch("clearGrid"),_api__WEBPACK_IMPORTED_MODULE_1__["d"].getProcessFormInfo(e.id).then(t=>{1===t.code?(Object(_utils_help__WEBPACK_IMPORTED_MODULE_14__["q"])(t.data.name),this.title=t.data.taskInfo.processName,Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["i"])(t.data),e.configuration=t.data,this.setFormTheme(),e.handleTableStruct(t.data),e.handleFormAutoNumber(t.data),e.hanldeTaskInfo(t.data),e.getAiMessage(),this.handleReadNotifyTask(t.data.taskInfo),e.store.dispatch("setFormConfiguration",e.configuration),e.initFormSnapshot(),e.loadSuccess=!0,e.$nextTick(async()=>{if(e.draftId)await _api__WEBPACK_IMPORTED_MODULE_1__["d"].getDraftById(e.draftId).then(t=>{let i=t.data;if(i){let t=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["g"])(JSON.parse(i.bizData));_source_id__WEBPACK_IMPORTED_MODULE_18__["a"].value=t.sourceId,e.data=t,_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iform.attachments.init",t),_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iform.list.init",t)}}).catch(e=>{console.log("getDraftById.error",e)});else if(t.data.formData){e.store.dispatch("setHideSign",!1);let i=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["g"])(t.data.formData);e.data=i,e.bizId=t.data.formData.GUID,_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iform.attachments.init",i),_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iform.list.init",i)}e.bizTaskId&&_api__WEBPACK_IMPORTED_MODULE_1__["d"].getProcessFormData(e.bizTaskId).then(t=>{1===t.code&&(e.data={...e.data,...t.data},_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iduo.form.relation"))}).catch(e=>{console.log("getProcessFormData.error",e)}),await Object(_components_iform_js_Base__WEBPACK_IMPORTED_MODULE_4__["c"])(this.topScriptUrlGen()),await Object(_components_iform_js_Base__WEBPACK_IMPORTED_MODULE_4__["h"])(this.scriptUrl,()=>this.loaded=!0),Object(_components_iform_js_Base__WEBPACK_IMPORTED_MODULE_4__["i"])(e=>{this.loaded&&(_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("form.onLoad",this.configuration),e())},500),_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("form.setTask",e.task)})):e.$notify({message:t.message,type:"danger"}),e.store.dispatch("setSystem",new _components_iform_pannel_js_SystemDictionary__WEBPACK_IMPORTED_MODULE_9__["a"](e.user,e.configuration))}).catch(e=>{console.log("getProcessFormInfo.error",e)}))},hanldeTaskInfo(e){var t;this.processDefKey=e.taskInfo.processDefKey||"",Object(_utils_i18n__WEBPACK_IMPORTED_MODULE_15__["f"])(this.processDefKey,_utils_i18n__WEBPACK_IMPORTED_MODULE_15__["d"].process);let i=this;i.process=e.taskInfo.processName,i.task={...e.taskInfo,taskId:e.taskInfo.taskId,stepId:e.taskInfo.stepId,stepName:e.taskInfo.stepLabel,stepInfo:e.stepInfo,beginStepInfo:e.beginStepInfo,processDefId:e.taskInfo.processDefKey,processName:e.taskInfo.processName,instanceId:e.taskInfo.instanceId,variables:e.taskInfo.variables||{},summary:e.taskInfo.summary||"",bizKey:e.taskInfo.bizKey,version:e.taskInfo.processVersion,status:e.taskInfo.taskStatus,subStatus:e.taskInfo.taskSubStatus,isBeginStep:e.taskInfo.isBeginStep,taskStartTime:e.taskInfo.startTime,processPrefix:null===(t=i.configuration.formConfiguration.extension)||void 0===t?void 0:t.prefix,processInitiatorId:e.taskInfo.processInitiatorId,isAllowSubmit:e.taskInfo.isAllowSubmit},i.$store.dispatch("setTaskInfo",Object.assign({},i.task)),i.$store.dispatch("setDirName",e.taskInfo.processDefKey);let n=i.user.UserAccount?i.user.UserAccount.toUpperCase():void 0;var a=e.taskInfo.taskUserId||"";let s=100===e.taskInfo.taskSubStatus&&a.toUpperCase()===n,o=a.toUpperCase()===n&&""!==a;i.isPlusTask=101===e.taskInfo.taskSubStatus&&a.toUpperCase()===n,i.task.isPlusTask=i.isPlusTask,0===e.taskInfo.taskId.indexOf("TMP")&&(o=!0,s=!1,i.isPlusTask=!1);let r=!1;1!==e.taskInfo.taskStatus||(o||s||i.isPlusTask)&&(r=!0),i.setTableDisabled(!r),i.begin=e.taskInfo.isBeginStep},setTableDisabled(e){this.store.dispatch("setDisabled",e)},handleFormAutoNumber(e){let t=this;function i(e){e.forEach(e=>{"autonumber"===e.controlType&&e.extension.formAutoNumber?t.formAutoNumber.push(e):e.items&&i(e.items)})}e.templateConfiguration&&i(e.templateConfiguration.formItems),i(e.formConfiguration.formItems)},handleTableStruct(e){let t=null,i=[],n=[],a=e.formConfiguration.dataModels;if(a.length){t=a[0];for(var s=1;s<a.length;s++){let e=a[s];e.isCollection?n.push(e):i.push(e)}}this.store.dispatch("setModel",{main:t,assist:i,sub:n})},getBpmData(){function getBPMFormItem(e,t){e.forEach(e=>{"detail"!==e.controlType&&(e.saveToBpm&&t.push(e),e.items&&getBPMFormItem(e.items,t))})}let self=this,data={},array=[],topFormItems=[];return getBPMFormItem(self.configuration.formConfiguration.formItems,array),getBPMFormItem(self.configuration.templateConfiguration.formItems,topFormItems),array.length&&array.forEach(item=>{let value=self.data[item.code];try{eval(value)instanceof Array&&(value=eval(value))}catch(e){console.log(e)}const code=item.code?item.code.replace(/-/g,"_").replace(/\./g,"_"):"";data[code]=value}),topFormItems.forEach(e=>{const t=this.topData[e.code],i=e.code?e.code.replace(/-/g,"_").replace(/\./g,"_"):"";data[i]=t}),null===self.task.instanceId&&self.task.isBeginStep&&(data["SysBizId"]=self.bizId),data},setVariable(e){this.extendBpmData=Object.assign(this.extendBpmData,e||{})},setVariableByKey(e,t){this.extendBpmData[e]=t},setSummary(e){this.extendBpmData=Object.assign(this.extendBpmData,{ProcessSummary:e})},getVariable(e){return this.task?this.task.variables[e]||this.extendBpmData[e]:null},createSignInfo(e,t,i,n){let a=this,s={UserId:a.user.UserAccount,UserName:a.user.UserName,StepId:a.task.stepId,StepName:a.task.stepName,Process:a.task.processName,InstanceId:a.task.instanceId,CreatedTime:dayjs__WEBPACK_IMPORTED_MODULE_12___default()().format("YYYY-MM-DD HH:mm:ss"),SignCode:e,SignText:t,Remark:i,SignFlag:n||0,TaskStartTime:a.task.startTime||dayjs__WEBPACK_IMPORTED_MODULE_12___default()().format("YYYY-MM-DD HH:mm:ss")};_api__WEBPACK_IMPORTED_MODULE_1__["d"].createSysSininInfo([s])},submit(e){const t=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["h"])(this.data,this.configuration,this.grids,this.begin),i={...this.topData,...t},n=this.store.getters.data(this.bizId,i,this.task,e);null===n.task.bizKey&&(n.task.bizKey=this.store.getters.getSystem("Sys_ApplyNo"));const a=this.getBpmData();n.task.variables=Object.assign(n.task.variables,a,this.extendBpmData),this.isPlusTask&&(e.status.code="plus.submit"),this.submitForm(n,!0)},disagree(e){const t=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["h"])(this.data,this.configuration,this.grids,this.begin),i={...this.topData,...t},n=this.store.getters.data(this.bizId,i,this.task,e),a=this.getBpmData();n.task.variables=Object.assign(n.task.variables,a,this.extendBpmData),this.isPlusTask&&(e.status.code="plus.disagree"),this.submitForm(n)},signature(e){const t=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["h"])(this.data,this.configuration,this.grids,this.begin),i={...this.topData,...t};let n="";e.plusUsers.forEach(e=>{n+=e.name+","});const a=this.store.getters.data(this.bizId,i,this.task,e);-1===a.sign.remark.indexOf("加签用户:")&&(a.sign.remark+=" 加签用户:"+n.substring(0,n.length-1));const s=this.getBpmData();a.task.variables=Object.assign(a.task.variables,s,this.extendBpmData),this.submitForm(a)},additional(e){const t=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["h"])(this.data,this.configuration,this.grids,this.begin),i={...this.topData,...t};let n="";e.additionalUsers.forEach(e=>{n+=e.name+","});const a=this.store.getters.data(this.bizId,i,this.task,e);-1===a.sign.remark.indexOf("追加审批用户:")&&(a.sign.remark+=" 追加审批用户:"+n.substring(0,n.length-1));const s=this.getBpmData();a.task.variables=Object.assign(a.task.variables,s,this.extendBpmData),this.submitForm(a)},addNotify(e){const t=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["h"])(this.data,this.configuration,this.grids,this.begin),i={...this.topData,...t};let n="";e.additionalUsers.forEach(e=>{n+=e.name+","});const a=this.store.getters.data(this.bizId,i,this.task,e);-1===a.sign.remark.indexOf("转发用户:")&&(a.sign.remark+=" 转发用户:"+n.substring(0,n.length-1));const s=this.getBpmData();a.task.variables=Object.assign(a.task.variables,s,this.extendBpmData),this.submitForm(a)},draft(e){this.visible=!0},handleSaveDraft(){let e=this,t=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["h"])(e.data,e.configuration,e.grids,e.begin);t.sourceId=_source_id__WEBPACK_IMPORTED_MODULE_18__["a"].value;let i=[{ProcessDefId:e.task.processDefId,ProcessName:e.task.processName,BizData:JSON.stringify(t),Type:0,IsEnabled:0,UpdateTime:null,Title:e.inputDraftName||"存稿-"+parseInt(1e7*Math.random(1,1e7)),UserId:e.user.UserAccount,UserName:e.user.UserName,FormUrl:`/iTask/${e.id}/`}];_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iduo.form.loading"),_api__WEBPACK_IMPORTED_MODULE_1__["d"].createDraft(i).then(t=>{e.firstSubmit=!1,1===t.code?e.$notify({message:"存稿成功",type:"success"}):e.$notify.error({message:t.message,duration:0})}).catch(e=>{console.log(e)}).finally(()=>{_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iduo.form.endLoading")}),e.setTableDisabled(!0),e.visible=!1},back(e){const t=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["h"])(this.data,this.configuration,this.grids,this.begin),i={...this.topData,...t},n=this.store.getters.data(this.bizId,i,this.task,e),a=this.getBpmData();n.task.variables=Object.assign(n.task.variables,a,this.extendBpmData),this.submitForm(n)},stall(e){const t=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["h"])(this.data,this.configuration,this.grids,this.begin),i={...this.topData,...t},n=this.store.getters.data(this.bizId,i,this.task,e),a=this.getBpmData();n.task.variables=Object.assign(n.task.variables,a,this.extendBpmData),this.submitForm(n)},save(e){this.data=e},saveTop(e){this.topData=e},autoSaveDraft(){let e=this,t=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["h"])(e.data,e.configuration,e.grids,e.begin),i=0===e.autoSaveDraftId.length;e.autoSaveDraftId=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["t"])();let n=[Object.assign({ID:e.autoSaveDraftId?e.autoSaveDraftId:null},{ProcessName:e.task.processName,BizData:JSON.stringify(t),Type:1,CreateTime:dayjs__WEBPACK_IMPORTED_MODULE_12___default()().format("YYYY-MM-DD HH:mm:ss"),IsEnabled:0,UpdateTime:i?null:dayjs__WEBPACK_IMPORTED_MODULE_12___default()().format("YYYY-MM-DD HH:mm:ss"),Title:"自动存稿",UserId:e.user.UserId,UserName:e.user.UserName,FormUrl:`${_api_url__WEBPACK_IMPORTED_MODULE_13__["a"].iform.webView}/iTask/${e.id}/`})];_api__WEBPACK_IMPORTED_MODULE_1__["d"][i?"createDraft":"updateDraft"](n).then(t=>{e.$notify({message:"自动存稿成功",type:"success"})}).catch(t=>{e.$notify({type:"danger",message:t.message,duration:0})})},validateFliedMess(e,t=!1){if(this.closeValidationPrompt){var i;if(!t)return;null===(i=this.element)||void 0===i||i.scrollIntoView({behavior:"smooth",block:"center"})}else this.$dialog.alert({message:this.$t(e)||this.$t("请您检查表单，有未填写内容!")}).then(e=>{var i;"confirm"===e&&t&&(null===(i=this.element)||void 0===i||i.scrollIntoView({behavior:"smooth",block:"center"}))})},submitForm(e,t){(this.disabled||this.firstSubmit)&&(e.approvalBtn=this.approvalBtn,_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("form.onValidateBefore",e,(...i)=>{let{validate:n=!0,errorMsg:a,onlyValid:s}=Object(_utils_help__WEBPACK_IMPORTED_MODULE_14__["f"])(i);if(!n)return void this.validateFliedMess(a);if(t){if(this.form.handleSave((e,t)=>{if(n=e,e)return;console.log("this.closeValidationPrompt",this.closeValidationPrompt);const i=t.filter((e,t)=>t<5).map(e=>`<p>${e.name} ${e.message}</p>`).join("");this.element=document.querySelector(".iform-item-"+t[0].code),this.validateFliedMess(i,!0)}),!n)return;const e=this.grids;if(n=e.every(e=>{var t;return!Array.isArray(e.list)||0!==e.list.length||!(null!==(t=e.configuration)&&void 0!==t&&t.extension.allowSubmitOnEmpty)}),!n)return void this.validateFliedMess("明细不能为空");if(n=e.every(e=>!!e.grid.save()),!n)return this.$nextTick(()=>{this.element=Object.values(document.querySelectorAll(".van-field__error-message")).find(e=>"none"!==e.style.display)}),void this.validateFliedMess(null,!0)}let o=()=>{};const r={bizData:e,submit:this.submitBiz(e)},l=new Promise(async e=>{await Object(_components_iform_controls_visual_verification_code__WEBPACK_IMPORTED_MODULE_21__["c"])();const t={...r};t.onAsyncVerified=e=>{e()},e(t)});return l.then(()=>{_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("form.onValidateAfter",this.configuration,()=>{}),o(),s||this.toSubmit(e)}),s?(r.onAsyncVerified=e=>{o=e},Object.assign(r,l)):void 0}))},submitBiz(e){return(...t)=>{const{submitable:i=!0,errorMsg:n,successMsg:a,prompt:s=!0}=Object(_utils_help__WEBPACK_IMPORTED_MODULE_14__["f"])(t);if(!i)return _utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iduo.form.endLoading"),void this.$dialog.alert({message:n||"表单提交阻止!"});e.task.variables=Object.assign(e.task.variables,this.extendBpmData);const{taskSubStatus:o,taskStatus:r}=this.configuration.taskInfo,l=()=>{_api__WEBPACK_IMPORTED_MODULE_1__["d"].submitProcessForm(e).then(async t=>{1===t.code?(_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("itask.refreshSignList"),Object(_api_iform__WEBPACK_IMPORTED_MODULE_17__["o"])(_source_id__WEBPACK_IMPORTED_MODULE_18__["a"].value,t.data),this.firstSubmit=!1,this.submitLogic(t,a,s),this.setTableDisabled(!0),1===t.code&&await this.handleAiMessage({instanceId:t.data,bizKey:e.task.bizKey})):this.$dialog.alert({message:t.message})}).catch(e=>{console.log("submitProcessForm.err",e),this.$dialog.alert({message:e.message||"保存失败"})}).finally(()=>{_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iduo.form.endLoading")})};1===r&&100===o?Object(_api_task_js__WEBPACK_IMPORTED_MODULE_16__["d"])(e.task.taskId).then(e=>{if(1!==e.data.code)return _utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iduo.form.endLoading"),void this.$dialog.alert({message:"有任务正在加签中，无法提交!"});l()}):l()}},toSubmit(e){const t="AddNotify"===e.approvalBtn.code?"确认转发吗":"确认提交吗";this.$dialog.confirm({title:this.$t("提醒"),message:this.$t(t)}).then(()=>{_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("iduo.form.loading"),_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("form.onSubmitBefore",e,this.submitBiz(e))})},async getFirstAgent(e){const t=this.getQueryDto();t.pageIndex=e;const i=this.getParamsforTistList(),n=await _api_task_js__WEBPACK_IMPORTED_MODULE_16__["a"].getMyInboxList(t,i);if(n.data.length<=0)return this.$notify({message:"没有下一条待办了",type:"warning"}),void(path&&this.$router.replace(`${path}/BPM/inbox?pn=${this.processDefKey}&layout=0`));const{status:a,subStatus:s}=n.data[0];if(1!==a||100!==s)return n;await this.getFirstAgent(e+1)},async submitLogic(e,t,i){if(1===e.code){i&&await this.$dialog.alert({message:this.$t(t||"提交成功")});const n=this.task.isBeginStep;if(n){const t=this.$route.params.appId?"processmap_in_app":"processmap";this.$router.push({name:t,params:{taskid:e.data}})}if(!n){const{appId:e,pageId:t,pageName:i}=this.$route.params,n=e?`/app/${e}/${t}/${i}`:"",a=await this.getFirstAgent(1);this.$dialog.confirm({title:"提醒",message:this.$t("提交成功,是否继续下一条待办？")}).then(()=>{n?this.$router.replace(`${n}/itask/${a.data[0].id}`):this.$router.replace("/itask/"+a.data[0].id)}).catch(()=>{n?this.$router.replace(`${n}/BPM/inbox?pn=${this.processDefKey}&layout=0`):this.$router.replace("/work")})}this.draftId&&_api__WEBPACK_IMPORTED_MODULE_1__["d"].deleteDraft(this.draftId).then(e=>console.log(e)).catch(e=>console.log(e)),this.deleteSnapshots(),_utils_EventBus__WEBPACK_IMPORTED_MODULE_11__["a"].$emit("form.onSubmitAfter",e)}else this.$dialog.alert({message:e.message})},async handleAiMessage(e){var t,i;const n=null===(t=this.$route.query)||void 0===t?void 0:t.conversationId,a=null===(i=this.$route.query)||void 0===i?void 0:i.messageId;if(!n||!a)return;const s=await _api__WEBPACK_IMPORTED_MODULE_1__["a"].getOrUpdateMessage({conversationId:n,messageId:a,...e});return s},async getAiMessage(){this.handleAiMessage().then(e=>{if(!e)return;const{code:t,data:i}=e;if(1===t&&i.formItems.length){const e=this.data||{};i.formItems.forEach(t=>{e[t.code]=t.value}),this.data=e}})},refresh(){this.iFormBodyKey=Object(_components_iform_js_IFormUtil__WEBPACK_IMPORTED_MODULE_3__["v"])(6)},setFormTheme(){var e;const t=(null===(e=this.configuration.formConfiguration.extension)||void 0===e?void 0:e.formTheme)||"basic";this.$store.state.formTheme=t,document.body.classList.add("iForm-theme-"+t)},initFormSnapshot(){Object(_api_iform__WEBPACK_IMPORTED_MODULE_17__["n"])(this.task.taskId).then(e=>{1===e.data.code&&e.data.data&&(this.formSnapshotData=e.data.data,this.$dialog.confirm({title:"提示",message:"查询到有保存的信息，是否加载"}).then(()=>{this.loadSnapshot=!0;const e=JSON.parse(this.formSnapshotData.content);delete e.remark,delete e.signature;for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const i=e[t];this.data[t]=i}}))})},async deleteSnapshots(){Object(_api_iform__WEBPACK_IMPORTED_MODULE_17__["g"])(this.formSnapshotData.id)}},mounted(){Object(_components_iform_controls_visual_verification_code__WEBPACK_IMPORTED_MODULE_21__["a"])(),Object(_dictionary__WEBPACK_IMPORTED_MODULE_19__["b"])(),Object(_source_id__WEBPACK_IMPORTED_MODULE_18__["b"])();let e=this;e.init(),Object(_utils_Event__WEBPACK_IMPORTED_MODULE_2__["b"])(e.events),Object(_utils_i18n__WEBPACK_IMPORTED_MODULE_15__["f"])(this.id,_utils_i18n__WEBPACK_IMPORTED_MODULE_15__["d"].process)},destroyed(){Object(_source_id__WEBPACK_IMPORTED_MODULE_18__["c"])(),Object(_utils_Event__WEBPACK_IMPORTED_MODULE_2__["a"])(this.events),Object(_components_iform_js_Base__WEBPACK_IMPORTED_MODULE_4__["j"])()},components:{"iform-top":_components_iform_pannel_IFormTop__WEBPACK_IMPORTED_MODULE_5__["a"],"iform-body":_components_iform_pannel_IFormBody__WEBPACK_IMPORTED_MODULE_6__["a"],"iform-approval":_components_iform_pannel_IFormApproval__WEBPACK_IMPORTED_MODULE_7__["a"],"iplus-pannel":_components_iform_pannel_IPlusPannel__WEBPACK_IMPORTED_MODULE_8__["a"],"remote-resource":_components_iform_controls_prop_RemoteResource__WEBPACK_IMPORTED_MODULE_10__["a"],Loading:()=>__webpack_require__.e("chunk-13271ee2").then(__webpack_require__.bind(null,"3a5e")),FormHead:_FormHead_vue__WEBPACK_IMPORTED_MODULE_20__["a"]}}},"3e5d":function(e,t,i){"use strict";i("ea7d")},"3fd6":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"iform-top"},[i("remote-resource",{attrs:{json:e.resource}}),e.templateConfiguration&&e.templateData?[i("van-form",{attrs:{model:e.templateData}},e._l(e.templateConfiguration.formItems,(function(t){return i("iform-item",{key:e.key(t),ref:e.key(t),refInFor:!0,attrs:{active:!1,data:e.templateData,isTop:!0,configuration:t,colspan:e.colspan,formConfig:e.configuration}})})),1)]:e._e()],2)},a=[],s=i("f485"),o=i("c449"),r=i("4a9d"),l=i("3bce"),c=i("9837"),d={name:"iform-top",components:{IformItem:s["a"],"remote-resource":o["a"]},provide:{isTop:!0},props:{configuration:Object,formAutoNumber:Array,isBeginStep:Boolean},data(){return{templateData:null}},computed:{templateConfiguration(){var e;return null===(e=this.configuration)||void 0===e?void 0:e.templateConfiguration},colspan(){var e;return null!==this.templateConfiguration?null===(e=this.templateConfiguration.extension)||void 0===e?void 0:e.totalColspan:4},resource(){var e;return this.templateConfiguration?null===(e=this.templateConfiguration.extension)||void 0===e?void 0:e.resource:null}},watch:{templateData:{deep:!0,immediate:!0,handler(e){r["a"].$emit("iform.top.save",e)}}},mounted(){this.templateData={...this.structData(),...this.handleStructTemplateData()},Object(c["b"])("iform-top-form",this)},methods:{is(e,t){return Object(l["r"])(e,t)},structData(){if(!this.templateConfiguration)return{};const e={},t=this.templateConfiguration.formItems;return t.forEach(t=>{this.struct(e,t)}),e},struct(e,t){const{code:i,items:n}=t,a=this.data?this.data[i]:"";if(this.is(t,["detail"]))e[i]=a||[];else if(this.is(t,["component","group"]))n&&Array.isArray(n)&&n.forEach(t=>{this.struct(e,t)});else{if(!i)return;e[i.replace(/\./g,"-")]=a}},defaultValue(e){let t;switch(e.controlType){case"numberbox":case"numberspinner":t="";break;default:t="";break}return t},handleStructTemplateData(){if(!this.templateConfiguration)return;const e=this.$store.getters.system.data||{},t=this.configuration.formData||{};return Object.entries(e).forEach(([t,i])=>e[t.toUpperCase()]=i),this.configuration.formData?{...t}:{...e}},key(e){return e.code?"iform-item-"+e.code:"iform-item-"+parseInt(1e4*Math.random())}}},u=d,f=(i("ddaf"),i("2877")),h=Object(f["a"])(u,n,a,!1,null,"14b2d0fa",null);t["a"]=h.exports},"4a6f":function(e,t,i){},"4ac1":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return null!==e.grid?i("div",{ref:"iduo-iform-list",class:{"iform-control-datagrid":!0,"iform-ilist":e.isList}},[e.isList?i("iform-datagrid-top",{ref:"iform-datagrid-top",attrs:{configuration:e.configuration}}):e._e(),i("van-form",{ref:"iform-edit-data",attrs:{model:e.data[e.editIndex],size:"mini"}},[e.isList?i("div",{directives:[{name:"show",rawName:"v-show",value:!(e.isView||e.disabled),expression:"!(isView || disabled)"}],staticClass:"toolbar-fixed"},[e._l(e.grid.toolbar,(function(t){return[i("van-button",{key:t.code,staticStyle:{width:"48px",height:"48px","margin-bottom":"10px"},attrs:{type:"info",icon:"plus",round:""},on:{click:function(i){return e.handleEvent(t)}}})]})),e.roleSave?i("van-button",{staticStyle:{width:"48px",height:"48px","margin-bottom":"10px"},attrs:{type:"primary",icon:"success",round:""},on:{click:e.handleSave}}):e._e()],2):e._e(),e.isTableList?[i("div",{class:e.isDingTalk?"table-list-wrapping-dingtalk":"table-list-wrapping"},[i("el-table",{ref:"multipleTable",staticStyle:{"font-size":"12px"},attrs:{data:e.grid.data,stripe:"",height:"100%","cell-style":{padding:"5px 0"},"cell-class-name":"list-datagrid-table-cell","header-row-class-name":"list-datagrid-table-cell","show-summary":e.grid.summary,"summary-method":e.getSummaries}},[i("el-table-column",{attrs:{fixed:"",type:"index",width:"30"}}),e._l(e.grid.columns,(function(t,n){return[!0!==t.isHide&&!0!==t.visible?i("el-table-column",{key:t.code,attrs:{prop:t.code,label:t.name,width:t.extension.width||100},scopedSlots:e._u([{key:"default",fn:function(a){return[i("div",{on:{click:function(i){return e.handleMobileClick(a.row,t)}}},[n===e.editIndex&&!e.disabled&&e.editable?[i("iform-datagrid-edit",{attrs:{"form-data":e.formData,data:e.data[e.editIndex],parentCode:e.configuration.code,editIndex:e.editIndex,configuration:t,formConfig:e.formConfig}})]:[i("iform-control-formatter",{attrs:{"form-data":e.formData,data:a.row,editIndex:e.editIndex,isGrid:!0,formConfig:e.formConfig,configuration:t}})]],2)]}}],null,!0)}):e._e()]}))],2)],1),e.isPager?i("van-row",{staticClass:"pagination-wrapping",attrs:{type:"flex",justify:"center"}},[i("van-pagination",{attrs:{"items-per-page":e.list.size,"total-items":e.list.total},on:{change:e.currentChange},model:{value:e.list.index,callback:function(t){e.$set(e.list,"index",t)},expression:"list.index"}})],1):e._e()]:e._l(e.data,(function(t,n){return i("div",{key:"item-"+n+"-"+t.GUID,staticClass:"data-list"},[e.isTemp&&t.__templateMode?[i("van-swipe-cell",{attrs:{disabled:!0!==e.grid.roleRemove&&!0!==e.grid.roleEdit},scopedSlots:e._u([{key:"right",fn:function(){return[e.grid.roleRemove?i("van-button",{staticStyle:{height:"100%"},attrs:{square:"",type:"danger",text:"删除"},on:{click:function(i){return e.handleRemove(t,n)}}}):e._e(),e.grid.roleEdit?i("van-button",{staticStyle:{height:"100%"},attrs:{square:"",type:"primary",text:"修改"},on:{click:function(i){e.handleMobileClick(t,null),t.__templateMode=!1}}}):e._e()]},proxy:!0}],null,!0)},[i("div",[i("dynamic-component",{attrs:{data:e.formatData(t),options:e.tempOptions}})],1)])]:[i("div",{staticClass:"van-hairline--bottom",staticStyle:{padding:"10px 16px"},on:{click:function(e){t.__templateMode=!0}}},[i("span",{staticStyle:{"font-size":"12px"}},[e._v(e._s(e.$t(e.configuration.name)+"-"+(n+1)))]),e.grid.roleRemove?i("span",{directives:[{name:"show",rawName:"v-show",value:!(e.isView||e.disabled),expression:"!(isView || disabled)"}],staticStyle:{"font-size":"12px",float:"right",color:"#f4333c"},on:{click:function(t){return e.removePuls(n)}}},[e._v(e._s(e.$t("删除")))]):e._e()]),e._l(e.grid.columns,(function(a,s){return i("van-field",{key:a.code+"-"+s,class:[e.required(a),e.labelHidden(a),e.labelTop(a)],staticStyle:{padding:"10px 24px"},attrs:{label:e.$t(a.name)},on:{click:function(i){return e.handleMobileClick(t,a)}},scopedSlots:e._u([{key:"input",fn:function(){return[n===e.editIndex&&!e.disabled&&e.editable?[i("iform-datagrid-edit",{attrs:{"form-data":e.formData,data:e.data[e.editIndex],parentCode:e.configuration.code,editIndex:e.editIndex,configuration:a,formConfig:e.formConfig}})]:[i("iform-control-formatter",{attrs:{"form-data":e.formData,data:t,editIndex:e.editIndex,isGrid:!0,configuration:a,formConfig:e.formConfig}})]]},proxy:!0}],null,!0)})}))]],2)})),!e.empty||e.data&&0!==e.data.length?e._e():i("van-empty",{attrs:{description:e.$t("无数据")}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.sums.length>0,expression:"sums.length > 0"}],staticClass:"iform-datagrid-summary"},[i("div",{staticClass:"van-hairline--bottom"},[i("span",{staticStyle:{"font-size":"12px"}},[e._v("合计汇总")])]),e._l(e.sums,(function(t,n){return i("van-field",{key:t.code+"-"+n,staticStyle:{padding:"10px 24px"},attrs:{label:t.name},scopedSlots:e._u([{key:"input",fn:function(){return[i("span",{staticStyle:{color:"red"}},[e._v(e._s(t.summary))])]},proxy:!0}],null,!0)})}))],2)],2),e.isList?e._e():i("van-row",{directives:[{name:"show",rawName:"v-show",value:!(e.isView||e.disabled),expression:"!(isView || disabled)"}],staticClass:"datagrid-toolbar"},e._l(e.grid.toolbar,(function(t){return i("van-button",{key:t.code,attrs:{block:""},on:{click:function(i){return e.handleEvent(t)}}},[e._v(e._s(e.$t(t.title)+" "+e.$t(e.configuration.name)))])})),1),i("iform-datagrid-dialog",{attrs:{visible:e.visible,data:e.data,edit:e.edit,editIndex:e.editIndex,configuration:e.configuration,formConfig:e.formConfig},on:{"update:visible":function(t){e.visible=t},remove:e.remove,"continue-add":e.continueAdd}})],1):e._e()},a=[],s=(i("672e"),i("450d"),i("101e")),o=i.n(s),r=(i("5466"),i("ecdf")),l=i.n(r),c=(i("38a0"),i("ad41")),d=i.n(c),u=(i("13d5"),i("14d9"),i("365c")),f=i("bf26"),h=i("9837"),m=i("3bce"),p=(i("c73d"),i("1c24"));function g(e,t,i){let n=this;if(e){i&&(n.refs=i.$refs,n.vueInstance=i),n.data=JSON.parse(JSON.stringify(t||[])),n.list=t,n.isList=i.isList,n.configuration=e,n.code=e.code,n.tableCode=e.items[0].code.indexOf("-")>-1?e.items[0].code.split("-")[0]:"",n.modelId=e.modelId,n.defaultAddRow=e.defaultAddRow,n.summary=!1,n.sort={prop:e.extension.sortColumn||"__ROWINDEX",order:"asc"===e.extension.sortBy?"asc":"desc"};let s=[];for(var a=0;a<e.items.length;a++){let t=e.items[a],i=t.extension;i.isLogicHide||(e.extension.sortColumn&&(t.sortable=!0),s.push(t)),(i.isSum||i.isAvg||i.isMax||i.isMin)&&(n.summary=!0)}n.columns=s,n.addAfterEvent=e.extension.addAfterEvent,n.addBeforeEvent=e.extension.addBeforeEvent,n.clickCellEvent=e.extension.clickCellEvent,n.clickRowEvent=e.extension.clickRowEvent,n.copyAfterEvent=e.extension.copyAfterEvent,n.copyBeforeEvent=e.extension.copyBeforeEvent,n.removeAfterEvent=e.extension.removeAfterEvent,n.removeBeforeEvent=e.extension.removeBeforeEvent,n.removeAllAfterEvent=e.extension.removeAllAfterEvent,n.removeAllBeforeEvent=e.extension.removeAllBeforeEvent,n.renderRowAfterEvent=e.extension.renderRowAfterEvent,n.saveAfterEvent=e.extension.saveAfterEvent,n.saveBeforeEvent=e.extension.saveBeforeEvent,n.roleAdd=e.extension.roleAdd,n.roleCopy=e.extension.roleCopy,n.roleEdit=e.extension.roleEdit,n.roleExport=e.extension.roleExport;let o=e.items;if(n.isList){let t=[],i=[];for(let e=0;e<o.length;e++)if(o[e].code&&o[e].code.indexOf("-")>-1){let n=o[e].code.split("-")[0];-1===t.indexOf(n)&&t.push(n),-1===i.indexOf(n)&&i.push(n)}(t.length>0&&1===i.length||t.length>0&&i.length>1)&&(e.extension.roleImport=!1,e.extension.roleRemoveAll=!1)}n.roleImport=e.extension.roleImport,n.roleRemove=e.extension.roleRemove,n.roleRemoveAll=e.extension.roleRemoveAll,n.roleLoadData=e.extension.roleLoadData,n.enabledSubGrid=e.extension.enabledSubGrid,n.isPager=e.extension.isPager,n.operationMode=n.isList?"out-grid":e.extension.operationMode||"in_grid",n.opterModel=e.extension.opterModel,n.pageSize=e.extension.pageSize||15,n.viewForeignField=e.extension.viewForeignField,n.viewMode=e.extension.viewMode,n.viewName=e.extension.viewName,n.toolbar=T.call(n,e),n.handleAppend=y,n.handleCopy=k,n.handleExport=S,n.handleRemove=I,n.handleRemoveAll=w,n.handleImport=C,n.handleCreateData=j,n.handleChanges=O,n.handleData=E,n.handleCellClick=b,n.handleRowClick=_,n.Sum=x,n.Avg=D,n.Max=A,n.Min=P,n.grid={get target(){return n.refs?n.refs["iduo-iform-list"]?n.refs["iduo-iform-list"].__vue__:null:""},get append(){return i.append},get copy(){return i.copy},get remove(){return i.remove},get removeAll(){return i.removeAll},get import(){return i.import},get export(){return i.export},get save(){return i.save},get index(){return i.editIndex}}}return n}function v(e,t,i){let n=`var index=${t.index};var data=${JSON.stringify(i)};`;window.eval(n+e)}function _(e,t){let i=this,n=i.grid,a=i.grid.grid.index;if(null!==a&&n.clickRowEvent){let i=`var row=${JSON.stringify(e)};var column=${JSON.stringify(t)};var index=${a};`;window.eval(i+n.clickRowEvent)}}function b(e,t){let i=this,n=i.grid,a=i.grid.grid.index;if(null!==a&&n.clickCellEvent){let i=`var row=${JSON.stringify(e)};var column=${JSON.stringify(t)};var index=${a};`;window.eval(i+n.clickCellEvent)}}function y(e){let t=this,i=t.grid;(null===i.index||void 0===i.index||i.save())&&(t.addBeforeEvent&&v(t.addBeforeEvent,i,t.data),i.append(e)&&t.addAfterEvent&&v(t.addAfterEvent,i,t.data))}function k(){let e=this,t=e.grid;(null===t.index||t.save())&&(e.copyBeforeEvent&&v(e.copyBeforeEvent,t,e.data),t.copy()&&e.copyAfterEvent&&v(e.copyAfterEvent,t,e.data))}function I(){const e=this.grid;if(this.removeBeforeEvent){const t=new Function("data","index",this.removeBeforeEvent),i=t(e.target.selection);if(!1===i)return}e.remove()&&self.removeAfterEvent&&v(self.removeAfterEvent,e,self.data)}function w(){let e=this,t=e.grid;e.removeAllBeforeEvent&&v(e.removeAllBeforeEvent,t,e.data),t.removeAll()&&e.removeAllAfterEvent&&v(e.removeAllAfterEvent,t,e.data)}function C(){let e=this,t=e.grid;(null===t.index||t.save())&&t.import()}function S(){let e=this,t=e.grid;(null===t.index||t.save())&&t.export()}function O(){const{grid:e,data:t,code:i}=this,{index:n,save:a,target:s}=e,o=iduo.refs["grid-"+i];if(!s&&!o)return[];let r=(null===s||void 0===s?void 0:s.data)||o.data||[];if("list"===o.configuration.extension.viewType&&(r=o.dataList),n&&a(),!r||0===r.length)return t.map(e=>({...e,__action:"delete"}));const l=this.isList?"GUID":(this.code||this.tableCode)+"-GUID",c=r.filter(e=>{const i=e[l],n=t.some(e=>i===e[l]);return!n}).map(e=>({...e,__action:"insert"})),d=r.filter(e=>{const i=e[l];let n;const a=t.some((e,t)=>{const a=i===e[l];return a&&(n=t),a});if(a){const i=Object.keys(e).filter(e=>!["RowIndex","__ROWINDEX"].includes(e)),a=t[n];i.every(t=>e[t]===a[t])||(e.__modified=!0)}return a}).map(e=>({...e,__action:"update"})),u=t.filter(e=>{const t=e[l],i=r.some(e=>t===e[l]);return!i}).map(e=>({...e,__action:"delete"}));return[...c,...d,...u]}function E(e){let t=this;t.data=[].concat(e)}function x(e,t){let i=0;return t.forEach(t=>{i+=Number(t[e])}),i}function D(e,t){let i=0,n=t.length;return t.forEach(t=>{i+=Number(t[e])}),(i/n).toFixed(0)}function A(e,t){let i;return t.forEach((t,n)=>{let a=Number(t[e]);(0===n||!isNaN(a)&&a>i)&&(i=a)}),i}function P(e,t){let i;return t.forEach((t,n)=>{let a=Number(t[e]);(0===n||!isNaN(a)&&a<i)&&(i=a)}),i}function T(e){let t=this,i=[];if(e){let n=e.extension||{};n.roleAdd&&i.push(new p["f"](()=>{t.handleAppend()}))}return i}function j(e){let t=e||this.configuration,i={};if(t){let e=t.items;for(var n=0;n<e.length;n++){let t=e[n],s=null;if(t.defaultExpression&&t.defaultExpression.indexOf("{")>-1){let e=Object(h["d"])(t.defaultExpression);try{s=Object(h["g"])(e[0]),!s&&this.grid.vueInstance.$store&&(s=this.grid.vueInstance.$store.getters.getSystem(e[0]))}catch(a){continue}}i[t.code]=s||t.defaultExpression||M(t)}}return i}function M(e){let t;switch(e.controlType){case"numberbox":case"numberspinner":t=0;break;default:t="";break}return t}var $=i("4a9d"),R={load(e,t,i,n){let a=this;return new Promise((s,o)=>{var r,l,c=iduo.user||{};let d={filters:Object.assign({},t||{},a.$route.query,c),search:{KeyWord:e||"",PageIndex:a.list.index,PageSize:a.list.size,SortField:a.grid.sort.prop,SortType:a.grid.sort.order},orderFields:[{Code:a.grid.sort.prop,OrderType:a.grid.sort.order}]};const f=null===(r=a.configuration)||void 0===r?void 0:r.extension.dataRequestAddress,h=null===(l=a.configuration)||void 0===l?void 0:l.extension.roleLoadData,p=()=>f?u["d"].getListBizDataOrConfigAddress(a.formId,d,f):u["d"].getListBizData(a.formId,d);p().then(e=>{if(1===e.code){if(1===i){const i=Object.values(t||{}),n=d.search.KeyWord;h||Boolean(i.find(e=>e))||Boolean(n)?a.data=Object(m["g"])({data:e.data})["data"]:a.data=[],a.grid.data=JSON.parse(JSON.stringify(a.data))}else{const i=Object(m["g"])({data:e.data})["data"];let s=[];s=n?i:e.data.length?a.data.concat(i):a.data;for(let e=0;e<s.length;e++)s[e]["__ROWINDEX"]=e;const o=Object.values(t||{}),r=d.search.KeyWord;h||Boolean(o.find(e=>e))||Boolean(r)?a.data=s:a.data=[],a.grid.data=JSON.parse(JSON.stringify(a.data))}a.list.total=e.count,s(e),$["a"].$emit("iform.list.load")}}).catch(e=>{console.log("handleLoad.error",e)})})},summary(e){let t=[],i=this;return e&&e.length>0?(i.grid&&i.grid.columns.forEach(e=>{let n=Object.assign({},{code:e.code,name:e.name}),a=e;if(a){let e=!1,s=a.extension;s.isSum&&(n["summary"]=i.grid.Sum(a.code,i.data),e=!0),s.isAvg&&(n["summary"]=i.grid.Avg(a.code,i.data),e=!0),s.isMax&&(n["summary"]=i.grid.Max(a.code,i.data),e=!0),s.isMin&&(n["summary"]=i.grid.Min(a.code,i.data),e=!0),e&&t.push(n)}}),t):t},append(e){let t=this;if(t.selections=[],!t.save())return!1;if("in_grid"!==t.operationMode&&t.opterModel&&(null==e||0===e.length)){const e={id:t.opterModel};return void this.$router.push({name:"iform",params:e})}if(t.edit=!1,Array.isArray(t.data)||(t.data=[]),void 0!==e)return e[(t.grid.tableCode||t.grid.code)+"-GUID"]||(e[(t.grid.tableCode||t.grid.code)+"-GUID"]=t.newBizId()),e["__ROWINDEX"]=t.newIndex,e["__templateMode"]=!1,t.data.forEach(e=>{e.__templateMode=!0}),t.data.push(e),!0;t.editIndex=t.data.length;let i=t.createData();return i[(t.grid.tableCode||t.grid.code)+"-GUID"]=t.newBizId(),i["__ROWINDEX"]=t.newIndex,t.data.forEach(e=>{e.__templateMode=!0}),i["__templateMode"]=!1,t.data.push(i),$["a"].$emit("iform.attachments.init",i),"in_grid"!==t.operationMode&&(t.visible=!0),t.selections.push(i),!0},remove(e){let t=this;if(void 0!==e)return t.editIndex=null,t.data.splice(e,1),t.selections=[],t.orderby(),t.save(),!0;if(0!==t.selections.length){for(var i=0;i<t.selections.length;i++){let e=t.selections[i],n=t.position(e);t.data.splice(n,1)}return t.selections=[],t.orderby(),t.save(),!0}t.$message({message:"请勾选删除行",type:"warning"})},removeAll(){return this.data=[],this.save()},copy(){let e=this;if(e.selections.length)for(var t=0;t<e.selections.length;t++){let i=e.selections[t],n=Object.assign({},i),a="GUID";(e.grid.tableCode||e.grid.code)&&(a=(e.grid.tableCode||e.grid.code)+"-GUID"),n[a]=e.newBizId(),n["__ROWINDEX"]=e.data.length+1,e.data.push(n),$["a"].$emit("iform.attachments.init",n)}return e.target.clearSelection(),e.save()},imported(e){let t=this;if(t.save()){let i=e.data,n=e.header,a=[];n.forEach(e=>{t.configuration.items.forEach(t=>{t.name===e&&a.push(t.code)})});let s=[];for(let e=1;e<i.length;e++){let n={},o=i[e],r=Object.keys(o),l=t.createData();a.forEach((e,t)=>{n[e]=o[r[t]]}),s.push(Object.assign(l,n))}t.data=t.data.concat(s),t.orderby()}else t.$message({message:"请先保存明细",type:"warning"})},export(){let e=this;if(e.save()){let i=[],n=[],a=[],s=e.configuration.name,o=[];e.selections.forEach(e=>{o.push(Object.assign({},e))}),e.configuration.items.forEach(e=>{e.isPrint&&(i.push(e.name),n.push(e.code),a.push({wps:1*e.extension.width||100}))});for(var t=0;t<o.length;t++){let i=o[t];e.configuration.items.forEach(e=>{e.isPrint&&(i[e.code]=Object(m["e"])(e,i[e.code]))})}o.length?Object(m["b"])(i,n,o,s,a,s):e.$message({message:"请勾选明细行",type:"warning"})}else e.$message({message:"请先保存明细",type:"warning"})},save(){let e=!0,t=this;if(t.grid){if(t.grid.saveBeforeEvent){let e=`var index=${t.grid.grid.index};var data=${JSON.stringify(t.grid.data)};`;window.eval(e+t.grid.saveBeforeEvent)}if("in_grid"===t.operationMode&&null!==t.editIndex){let i=[];t.grid.columns.forEach(e=>{i.push(e.code)}),t.$store.getters.validFieds(i,t=>{e=0===t.length})}if(e&&(t.editIndex=null,t.formData[this.configuration.code]=this.data,t.grid.saveAfterEvent)){let e=`var index=${t.grid.grid.index};var data=${JSON.stringify(t.grid.data)};`;window.eval(e+t.grid.saveAfterEvent)}}return e},orderby(){let e=this;for(var t=0;t<e.data.length;t++)e.data[t]["__ROWINDEX"]=t},position(e){let t=this,i=null;for(var n=0;n<t.data.length;n++)t.data[n]["__ROWINDEX"]===e["__ROWINDEX"]&&(i=n);return i},getExtension(e){let t=this;for(var i=0;i<t.grid.columns.length;i++)if(t.grid.columns[i].code===e)return t.grid.columns[i];return null}},B=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"iform-datagrid-top"},[i("van-row",[i("van-col",{staticClass:"iform-datagrid-opts",attrs:{span:24}},[i("van-sticky",[i("van-search",{attrs:{"show-action":"",disabled:!e.filters||0===e.filters.length,placeholder:e.$t(e.placeholder)},on:{search:e.handleSearch},scopedSlots:e._u([{key:"action",fn:function(){return[e.filters.length?i("van-button",{attrs:{size:"small"},on:{click:function(t){e.senior=!0}}},[e._v("过 滤")]):e._e()]},proxy:!0}]),model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1)],1)],1),i("van-popup",{attrs:{position:"bottom"},model:{value:e.senior,callback:function(t){e.senior=t},expression:"senior"}},[i("van-row",{directives:[{name:"show",rawName:"v-show",value:e.senior,expression:"senior"}],staticStyle:{padding:"20px 0"}},[null!==e.configuration?i("van-form",{ref:"iform-form",attrs:{model:e.filterData}},[e._l(e.filters,(function(t){return i("van-field",{key:"filter-"+t.code,style:e.itemStyle,attrs:{label:t.name,prop:t.code,value:e.filterData[t.code],readonly:t.isReadable,disabled:t.isReadable},scopedSlots:e._u([!0!==t.isReadable?{key:"input",fn:function(){return[i("datagrid-senior-item",{attrs:{data:e.filterData,configuration:t}})]},proxy:!0}:null],null,!0)})})),i("van-field",{scopedSlots:e._u([{key:"input",fn:function(){return[i("div",{staticClass:"btn-tool-bar"},[i("van-button",{staticStyle:{width:"30%"},on:{click:function(t){e.senior=!1}}},[e._v(" 关闭 ")]),i("van-button",{staticStyle:{width:"30%"},attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v(" 搜 索 ")])],1)]},proxy:!0}],null,!1,1305068498)})],2):e._e()],1)],1)],1)},L=[],N=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"datagrid-senior-item",staticStyle:{width:"100%"}},[i(e.type,{tag:"component",attrs:{data:e.data,configuration:e.conf,filter:!0},on:{blur:function(t){return e.handleTrigger("blur")},change:function(t){return e.handleTrigger("change")}}})],1)},U=[],F=i("9ef9"),W=i("5c8a"),z={name:"datagrid-senior-item",data(){return{type:"input",inputArray:["label","textarea","ocbox","htmledit","filebox"]}},props:{data:{type:Object,default(){return null}},configuration:{type:Object,default(){return null}}},computed:{conf(){const e=Object(W["a"])(this.configuration);return e.isReadable=!1,e}},methods:{handleTrigger(){},init(){let e=this,t=e.configuration.controlType;"radiobox"!==t&&"checkbox"!==t||(t="combobox","checkbox"===e.configuration.controlType&&(e.configuration.extension.allowMulti=!0)),e.inputArray.indexOf(t)>-1&&(t="textbox"),e.type="iform-control-"+t||!1}},mounted(){this.init()},components:{...F["b"]}},V=z,K=(i("bfd3"),i("2877")),H=Object(K["a"])(V,N,U,!1,null,null,null),q=H.exports,J={name:"iform-datagrid-top",data(){return{form:{position:"right",size:"mini",width:"120px"},senior:!1,show:!1,keyword:"",filterData:null,filters:[]}},props:{configuration:{type:Object,default(){return null}}},computed:{filtersEmpty(){return!this.filters||0===this.filters.length},placeholder(){const e="请输入搜索关键词";return this.filtersEmpty?"搜索已经被禁用":e},formId(){return this.$route.params.id||this.$route.params.ID||""},isAdministrator(){return this.$store.getters.isAdministrator},roleSave(){let e=this.configuration.extension;return e.roleAdd||e.roleCopy||e.roleEdit||e.roleRemove||e.roleRemoveAll},grids(){return this.$store.getters.grids},style(){let e=this,t=[];return e.isAdministrator&&t.push("cursor: pointer"),t.join(";")},itemStyle(){let e=[];return e.join(";")},structFilterData(){return this.filterData?this.handleStructFilterData(this.filterData):{}}},methods:{init(){let e=this;e.handleStructFilter(),window.document.onkeydown=t=>{var i=window.event.keyCode;13===i&&e.handleKeyUp()}},handleSearch(){let e=this;e.senior=!1,$["a"].$emit("iform.list.search",e.keyword,e.structFilterData)},handleSave(){console.log("handleSave"),$["a"].$emit("iform.list.save")},handleKeyUp(){this.handleSearch()},handleStructFilter(){let e=this,t=[],i={};e.configuration.items.forEach(e=>{e.extension.isFilter&&(i[e.code]="",t.push(e))}),e.filters=t,e.filterData=i},handleStructFilterData(e){let t={},i=Object.keys(e);return i.forEach(i=>{t[i.replace(/-/g,".")]=e[i]}),t}},mounted(){this.init(),Object(h["b"])("grid-top-"+this.configuration.code,this)},components:{"datagrid-senior-item":q}},G=J,Y=(i("11ce"),Object(K["a"])(G,B,L,!1,null,"e3830936",null)),X=Y.exports,Q=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"iform-datagrid-edit",staticStyle:{width:"100%"}},[e.labelling?[i("iform-control-formatter",{attrs:{data:e.data,configuration:e.configuration,formConfig:e.formConfig}})]:[e.disabled?i("iform-control-formatter",{attrs:{data:e.data,configuration:e.configuration,formConfig:e.formConfig}}):[i(e.type,{tag:"component",attrs:{"form-data":e.formData,data:e.data,parentCode:e.parentCode,editIndex:e.editIndex,formConfig:e.formConfig,configuration:e.configuration,isTable:!0},on:{blur:function(t){return e.handleTrigger("blur")},change:function(t){return e.handleTrigger("change")}}}),e.configuration?i("form-check",{ref:"form-check-"+e.configuration.code,attrs:{code:e.configuration.code,rules:e.rules,value:e.value}}):e._e(),e.configuration.extension.tipsText?i("tips-text",{attrs:{content:e.configuration.extension.tipsText}}):e._e()]]],2)},Z=[],ee=(i("353e"),i("c987")),te={name:"iform-datagrid-edit",data(){return{type:"input",rules:[]}},props:{formConfig:Object,formData:{type:Object},data:{type:Object,default(){return null}},configuration:{type:Object,default(){return null}},editIndex:{type:Number,default(){return null}},parentCode:{type:String,default(){return null}}},computed:{formula(){return this.configuration.extension.formula},value(){return this.configuration?this.data[this.configuration.code]:null},code(){const e=this.configuration.code||"";return e.replace(".","-")},labelling(){let e=this.$store.getters.taskInfo;return(!e||!e.isBeginStep)&&(null!==this.configuration&&this.configuration.isReadable&&this.configuration.extension.isHideControl)},disabled(){return this.$store.getters.disabled},checkTarget(){return this.$refs["form-check-"+this.configuration.code]}},methods:{initFormula(){const{initWatcher:e,initGlobalStateWatcher:t,hasFormula:i}=Object(ee["b"])(this.formula,this,()=>({...this.formData,...this.data}),e=>{this.data[this.configuration.code]=e});i&&(e(this.data),e(this.formData),t())},init(){let e=this;e.handleControl(),e.handleRules()},handleRules(){let e=this,t=Object(f["c"])(e.configuration);t&&(e.rules=t[e.configuration.code])},handleTrigger(e){var t;null===(t=this.checkTarget)||void 0===t||t.handleTrigger(e)},handleControl(){let e=this,t=e.configuration.controlType;if("textbox"===t){let i=e.configuration.extension.subtype;"cardnumber"===i&&(t="cardnumber")}e.type="iform-control-"+t||!1}},mounted(){this.init(),this.initFormula()},components:{...F["a"]}},ie=te,ne=Object(K["a"])(ie,Q,Z,!1,null,"335a6ee0",null),ae=ne.exports,se=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("van-popup",{staticStyle:{height:"100vh"},attrs:{overlay:!1,position:"bottom"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[null!==e.configuration?i("van-form",{ref:e.configuration.code+"-form",style:e.style,attrs:{model:e.formData,rules:e.rules,"label-position":e.labelPosition,"label-width":e.width,size:e.size}},e._l(e.configuration.items,(function(t){return i("dialog-form-item",{key:t.code,attrs:{editIndex:e.editIndex,parentCode:e.configuration.code,data:e.formData,configuration:t,colspan:e.colspan,formConfig:e.formConfig}})})),1):e._e(),i("div",{staticClass:"btu-wrapping"},[i("van-button",{attrs:{type:"info",size:"small"},on:{click:e.handleEvent}},[e._v("保 存")]),i("van-button",{attrs:{type:"default",size:"small"},on:{click:e.saveContinueAdd}},[e._v("保存后继续添加")]),i("van-button",{attrs:{type:"default",size:"small"},on:{click:e.handleCancel}},[e._v("取 消")])],1)],1)},oe=[],re=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.mobileHide?e._e():i("van-row",{directives:[{name:"show",rawName:"v-show",value:e.show&&e.showItem&&e.itemVisible,expression:"show && showItem && itemVisible"}],class:"iform-item "+e.parentClass,style:e.style},[e.labelling||e.isView?[i("iform-control-formatter",{attrs:{data:e.data,configuration:e.configuration}})]:e._e(),i("van-field",{class:[e.required(e.configuration),e.labelHidden,e.labelTop],attrs:{label:e.configuration.name},scopedSlots:e._u([{key:"input",fn:function(){return[i(e.type,{tag:"component",attrs:{data:e.data,editIndex:e.editIndex,configuration:e.configuration,formConfig:e.formConfig},on:{blur:function(t){return e.handleTrigger("blur")},change:function(t){return e.handleTrigger("change")}}}),e.configuration?i("form-check",{ref:"form-check-"+e.configuration.code,attrs:{code:e.configuration.code,rules:e.rules,value:e.value}}):e._e(),e.configuration.extension.tipsText?i("tips-text",{attrs:{content:e.configuration.extension.tipsText}}):e._e()]},proxy:!0}],null,!1,304846360)})],2)},le=[],ce=i("4a60"),de={name:"iform-datagird-dialog-item",data(){return{showItem:!0,itemVisible:!0,type:"input",rules:[],events:{"iduo.form.relation":this.handleRelation,"iduo.form.visible":this.handleVisible}}},props:{formConfig:Object,data:{default(){return null}},configuration:{type:Object,default(){return null}},colspan:{type:Number,default(){return 4}},editIndex:{type:Number,default(){}},parentCode:{type:String,default(){return null}}},watch:{configuration:{deep:!0,immediate:!0,handler(e){e&&this.handleRelation()}}},computed:{labelHidden(){const e=this.configuration.extension.labelPosition;return"hidden"===e?"label-hidden":""},labelTop(){const e=this.configuration.extension.labelPosition;return"block"===e?"label-top":""},value(){return this.configuration?this.data[this.configuration.code]:null},parentClass(){return"iform-datagrid-dialog-item-"+this.configuration.code},style(){let e=[];return e.push("display:inline-block"),e.push("padding:5px"),e.push("width:"+parseInt(this.configuration.extension.colspan/this.colspan*100)+"%"),e.join(";")},show(){return null!==this.configuration&&!this.configuration.extension.isLogicHide},store(){return this.$store},labelling(){let e=this.$store.getters.taskInfo;return(!e||!e.isBeginStep)&&(null!==this.configuration&&this.configuration.isReadable&&this.configuration.extension.isHideControl)},mobileHide(){return null!==this.configuration&&this.configuration.extension.mobileHide},isView(){let e=this.$route.query.Action||this.$route.query.action||"";return"view"===e.toLowerCase()&&e.length>0},visible(){return null!==this.configuration},checkTarget(){return this.$refs["form-check-"+this.configuration.code]}},methods:{init(){let e=this;Object(ce["b"])(this.events),e.handleControl(),e.handleRelation(),e.handleDefault(),e.handleRules()},handleControl(){let e=this,t=e.configuration.controlType;if("textbox"===t){let i=e.configuration.extension.subtype;"cardnumber"===i&&(t="cardnumber")}e.type="iform-control-"+t||!1},required(){let e="",t=this.rules;if(t[this.configuration.code])for(let i=0;i<t[this.configuration.code].length;i++){let n=t[this.configuration.code][i];if(n.required){e="van-cell--required";break}}return e},handleDefault(){let e=this;if(!e.bizId){let t=e.data[e.configuration.code];if("boolean"!==typeof t&&(""===t||void 0===t)&&e.configuration.defaultExpression){let t=e.configuration.defaultExpression;if(e.configuration.defaultExpression.indexOf("{")>-1){let i=Object(h["d"])(e.configuration.defaultExpression);t=e.store.getters.getSystem(i)}e.data[e.configuration.code]=void 0!==t&&null!==t?t:e.configuration.defaultExpression}}},handleRules(){let e=this,t=Object(f["c"])(e.configuration);t&&(e.rules=t[e.configuration.code])},handleTrigger(e){var t;null===(t=this.checkTarget)||void 0===t||t.handleTrigger(e)},handleRelation(){this.$nextTick(()=>{this.showItem=Object(m["m"])(this.configuration,this.data)})},handleVisible(e,t){e=e instanceof Array?e:[e];const i=this.configuration.code||"";e.indexOf(i.replace("-","."))>-1&&(this.itemVisible=t)},setupClearOnHideControl(){const{relationConfig:e,isEmpty:t,code:i}=Object(m["u"])(this.configuration);if(t)return;const{clearOnHide:n}=e;n&&this.$watch(()=>this.showItem,e=>{i&&!e&&(this.data[i]=void 0)})}},mounted(){this.init(),this.setupClearOnHideControl()},destroyed(){Object(ce["a"])(this.events)},components:{...F["a"]}},ue=de,fe=(i("5149"),i("19e4"),Object(K["a"])(ue,re,le,!1,null,"9f004986",null)),he=fe.exports,me={name:"ifom-grid-dialog",data(){return{formData:null,isAppend:!0,rules:{},width:"120px",size:"mini",diglogVisible:!1}},props:{formConfig:Object,edit:{type:Boolean,default(){return!1}},data:{type:Array,default(){return null}},editIndex:{type:Number,default(){return null}},visible:{type:Boolean,default(){return!1}},configuration:{type:Object,default(){return null}}},watch:{visible:{deep:!0,immediate:!0,handler(e){let t=this;t.diglogVisible=e,e&&(t.init(),null!==t.editIndex?t.formData=t.data[t.editIndex]:t.formData=j(t.configuration))}}},computed:{title(){return this.configuration.name},labelPosition(){return null!==this.configuration?this.configuration.extension.fieldOrderBy:"right"},colspan(){return null!==this.configuration?this.configuration.extension.totalColspan:4},style(){let e=[];return e.join(";")},target(){return this.$refs[this.configuration.code+"-form"]},store(){return this.$store}},methods:{getIndex(){return null==this.editIndex?this.data.length:this.editIndex},saveContinueAdd(){this.validFiedForm(()=>{this.data[this.getIndex()]=this.formData,$["a"].$emit("iform.list.save",()=>{this.handleClose(),setTimeout(()=>{this.$emit("continue-add")},500)})})},validFiedForm(e){const t=this.configuration.items||[],i=t.map(e=>e.name);this.$store.getters.validFieds(i,t=>{t.length||e()})},init(){let e=this;null!==e.configuration&&(e.handleRules(),Object(h["b"])("iform-edit-data",e))},handleRules(){let e=this,t=Object(m["j"])(e.configuration.items);e.rules=t},handleEvent(){this.validFiedForm(()=>{this.data[this.getIndex()]=this.formData,$["a"].$emit("iform.list.save",this.handleClose),this.$emit("update:visible",!1)})},handleCancel(){this.handleClose(),this.edit||this.$emit("remove",this.editIndex)},handleClose(){this.diglogVisible=!1,this.visible=!1,this.$emit("update:visible",this.diglogVisible)},is(e,t){return Object(m["r"])(e,t)}},mounted(){this.init()},components:{"dialog-form-item":he}},pe=me,ge=(i("eeda"),Object(K["a"])(pe,se,oe,!1,null,"4f86e20a",null)),ve=ge.exports,_e=i("2d22"),be=i("163b"),ye={name:"iform-control-datagrid",data(){return{empty:!1,data:this.formData[this.configuration.code],edit:!1,buttons:[],rules:{},gridWidth:"100%",grid:null,editData:null,editIndex:void 0,selections:[],visible:!1,isInit:!0,sums:[],list:{total:0,index:1,size:10},events:{"iform.list.init":this.init,"iform.list.change":this.handleCurrentChange,"iform.list.search":this.handleSearch}}},props:{formConfig:Object,formData:{default(){return null}},parentCode:{type:String,default(){return null}},configuration:{type:Object,default(){return null}},isList:{type:Boolean,default(){return!1}},extension:{type:Object,default(){return{}}}},watch:{visible:{deep:!0,immediate:!0,handler(e){e||this.isInit||this.save()}},formData:{deep:!0,immediate:!0,handler(e){this.handleSummary()}}},computed:{roleSave(){let e=this.configuration.extension;return e.roleAdd||e.roleCopy||e.roleEdit||e.roleRemove||e.roleRemoveAll},formId(){return this.$route.params.id||this.$route.params.ID||""},draftId(){return this.$route.params.draftId||""},target(){return this.$refs["grid-"+this.configuration.code]},parent(){return null!==this.parentCode?this.parentCode+".":""},operationMode(){return null!==this.grid?this.grid.operationMode:"in_grid"},opterModel(){return null!==this.grid?this.grid.opterModel:""},store(){return this.$store},newIndex(){return 1*this.data.length},isView(){let e=this.$route.query.Action||this.$route.query.action||"";return"view"===e.toLowerCase()&&e.length>0},importTarget(){return this.$refs["import-file"]},disabled(){return this.$store.getters.disabled},defaultAddRow(){return!!this.configuration&&this.configuration.extension.defaultAddRow},isPager(){return!this.configuration||this.configuration.extension.isPager},isTableList(){return!!this.configuration&&this.configuration.extension.tableList},pageSize(){return this.isList?this.configuration?1*this.configuration.extension.pageSize:15:1e3},bizId(){return this.$route.query.bizid||this.$route.query.bizId||""},isTemp(){try{const e=this.configuration.extension.listTempHtml;if(!e)return!1;const t=JSON.parse(e);return Boolean(t.context)}catch(e){return!1}},tempOptions(){let e=this.configuration?this.configuration.extension.listTempHtml:"";return e?JSON.parse(e):{}},editable(){return!0===this.configuration.extension.roleEdit},isDingTalk(){return Object(be["i"])()}},methods:{getSummaries(e){const{columns:t,data:i}=e;return 0===i.length?[]:t.map(e=>{if(["index","selection","expand"].includes(e.type))return"";const t=this.grid.columns.find(t=>t.code===e.property),n=i.map(e=>Number(e[t.code])).filter(e=>!isNaN(e));return t.extension.isSum?n.reduce((e,t)=>e+t,0):t.extension.isAvg?n.reduce((e,t)=>e+t,0)/n.length:t.extension.isMax?Math.max(...n):t.extension.isMin?Math.min(...n):"N/A"})},async removePuls(e){const t=this.data[e];if(this.grid.removeBeforeEvent){const i=new Function("data","index",this.grid.removeBeforeEvent),n=await i([t],e);if(!1===n)return}this.remove(e),this.grid.removeAfterEvent&&v(this.grid.removeAfterEvent,{index:e},t)},continueAdd(){this.handleEvent(this.grid.toolbar[0])},handleRemove(e,t){this.isList?this.$dialog.confirm({title:"提醒",message:"确定要删除？"}).then(()=>{$["a"].$emit("iform.list.save",()=>{this.data.splice(t,1)})}):this.remove(t)},labelHidden(e){const t=e.extension.labelPosition;return"hidden"===t?"label-hidden":""},labelTop(e){const t=e.extension.labelPosition;return"block"===t?"label-top":""},init(e){let t=this;Object(h["b"])("grid-"+t.parent+t.configuration.code,t),e&&(t.data=e[t.configuration.code]),t.grid=new g(t.configuration,t.data,t),t.store.dispatch("addGrid",t.grid),this.initRules(),t.grid.roleLoadData&&t.isList&&t.handleLoad(),t.handleDefaultAppend(),Object(ce["b"])(t.events),t.isInit=!1},initRules(){if("in_grid"===this.operationMode){let e=Object(m["j"])(this.configuration.items);this.rules=e}},handleDefaultAppend(){let e=this,t=e.store.getters["taskInfo"];e.draftId||(t&&Object.keys(t).length>0?!e.defaultAddRow||e.isView||e.isList||e.bizId||!e.grid.roleEdit||1!==t.status||null!==t.instanceId||"in_grid"!==e.operationMode||e.append():!e.defaultAddRow||e.isView||e.isList||e.bizId||!e.grid.roleEdit||"in_grid"!==e.operationMode||e.append())},handleSaveForm(e,t){this.store.dispatch("setGridFormData",{code:e,data:t})},handleEvent(e){e.click&&e.click.call()},handleSelection(e){this.selections=e},handleMobileClick(e,t){this.handleDbClick(e,t)},handleClick(e,t,i,n){let a=this;!a.disabled&&a.grid.roleEdit&&(a.grid.handleCellClick.call(a,e,t,i,n),a.grid.handleRowClick.call(a,e,t,i,n))},handleDbClick(e,t,i,n){let a=this;if(!(a.disabled||!a.grid.roleEdit&&"in_grid"===a.operationMode||a.isView)){if(a.grid.handleCellClick.call(a,e,t,i,n),a.grid.handleRowClick.call(a,e,t,i,n),!a.save())return!1;if(a.editIndex=e["__ROWINDEX"],$["a"].$emit("iform.attachments.init",e),"in_grid"!==a.operationMode){if(a.opterModel){const t=a.grid.roleEdit,i={id:a.opterModel},n={bizId:e.GUID,action:!t&&"view"};return void this.$router.push({name:"iform",params:i,query:n})}a.grid.roleEdit&&(a.visible=!0,a.edit=!0)}return!0}},handleSummary(){this.sums=R.summary.call(this,this.data)},handleCurrentChange(e,t){let i=this;i.list.index=e,i.handleLoad(void 0,void 0,t)},currentChange(){var e;this.handleLoad(void 0,void 0),null===(e=this.$refs["multipleTable"])||void 0===e||e.doLayout()},handleSearch(e){this.list.index=1,this.handleLoad(e,void 0)},async handleLoad(e,t,i){let n=this;n.isPager||(n.list.index=1),!e&&n.$refs["iform-datagrid-top"]&&(e=n.$refs["iform-datagrid-top"].keyword),!t&&n.$refs["iform-datagrid-top"]&&(t=n.$refs["iform-datagrid-top"].structFilterData),await R.load.call(n,e,t,n.list.index,this.isTableList).then(e=>{i instanceof Function&&i.call(n,e)}).finally(()=>{this.empty=!0}),setTimeout(()=>{var e;null===(e=this.$refs["multipleTable"])||void 0===e||e.doLayout()},500)},required(e){let t="";if(!this.isList){let i=Object(f["c"])(e);if(i)for(let n=0;n<i[e.code].length;n++){let a=i[e.code][n];if(a.required){t="van-cell--required";break}}}return t},append(e){return R.append.call(this,e)},remove(e){return R.remove.call(this,e)},removeAll(){return this.data=[],this.save()},copy(){return R.copy.call(this)},import(){$["a"].$emit("iform.import.click")},importSuccess(e){R.imported.call(this,e)},export(){R.export.call(this)},handleSave(){$["a"].$emit("iform.list.save")},save(){return this.isList||this.handleSummary(),R.save.call(this)},orderby(){R.orderby.call(this)},position(e){return R.position.call(this,e)},getExtension(e){return R.getExtension.call(this)},createData(){return this.grid.handleCreateData(this.configuration)},formatGridValue(e,t){let i=t.row[e.code];return void 0===i||null===i||""===i?"":Object(m["e"])(e,i)},newBizId(){return Object(h["e"])().replace("-","")},width(e){let t=this;if(t.grid.columns.length<=6){let e=!0;if(t.grid.columns.forEach(t=>{1*t.extension.width!==100&&(e=!1)}),e)return"-"}let i=1*e.extension.width||"-";return i<150&&(i=150),i},formatData(e){let t={};return this.grid.columns&&this.grid.columns.forEach(i=>{if(!i.code)return;let n=i.code.split("-"),a=n.length>1?n[1]:n[0];if(Object(m["r"])(i,["filebox"]))try{t[a+"_obj"]=JSON.parse(e[i.code])}catch(s){}else t[a]=Object(m["e"])(i,e[i.code])}),t["attachmentUrl"]=u["d"].getUploadPath(),Object.assign(e,t)}},mounted(){this.list.size=this.pageSize,this.init(),this.$watch(()=>this.configuration.items.map(e=>e.isRequired),()=>{this.initRules()},{deep:!0})},destroyed(){Object(ce["a"])(this.events)},components:{"iform-datagrid-dialog":ve,"iform-datagrid-edit":ae,"iform-datagrid-top":X,"iform-control-formatter":_e["default"],[d.a.name]:d.a,[l.a.name]:l.a,[o.a.name]:o.a}},ke=ye,Ie=(i("b764"),i("1996"),Object(K["a"])(ke,n,a,!1,null,"73764722",null));t["a"]=Ie.exports},5014:function(e,t,i){},5149:function(e,t,i){"use strict";i("e354")},5246:function(e,t,i){},5780:function(e,t,i){},"57b5":function(e,t,i){"use strict";i("93bb")},"5ae0":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("7c8d"),a=i.n(n);const s=(e,t=.6,i={})=>new Promise((n,s)=>{new a.a(e,{quality:t,...i,success(e){n(e)},error(e){s(e.message)}})})},"5d0f":function(e,t,i){},"5e72":function(e,t,i){},"61c2":function(e,t,i){},"63a3":function(e,t,i){},"64e4":function(e,t,i){"use strict";i("9746")},"68c0":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.id&&e.loaded?i("div",{staticClass:"itask-render"},[i("iduo-sdk-dialog"),i("remote-resource",{attrs:{json:e.resource}}),e.formHeadConfig.enableFormHead?i("FormHead",{attrs:{name:e.configuration.name,formHeadConfig:e.formHeadConfig}}):e._e(),i("iform-top",{ref:"iform-top",attrs:{data:e.data,configuration:e.configuration,formAutoNumber:e.formAutoNumber,isBeginStep:e.begin}}),i("iform-body",{key:e.iFormBodyKey,ref:"iform-body",attrs:{data:e.data,configuration:e.configuration}}),e.configuration?i("iform-approval",{directives:[{name:"show",rawName:"v-show",value:e.loadSuccess&&e.iformApprovalVisible,expression:"loadSuccess && iformApprovalVisible"}],ref:"iform-approval",attrs:{begin:e.begin,task:e.task,isProcess:!0,isPlusTask:e.isPlusTask,config:e.configuration,data:e.data,formSnapshotData:e.formSnapshotData,loadSnapshot:e.loadSnapshot}}):e._e(),i("iplus-pannel",{attrs:{visable:e.plusVisable,id:e.id},on:{"update:visable":function(t){e.plusVisable=t}}}),i("van-dialog",{attrs:{title:"存稿","show-cancel-button":""},on:{confirm:e.handleSaveDraft},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[i("van-field",{attrs:{label:"标题",placeholder:"请输入草稿标题"},model:{value:e.inputDraftName,callback:function(t){e.inputDraftName=t},expression:"inputDraftName"}})],1)],1):i("div",[e.enableHttpLoading?i("Loading",{attrs:{height:"100vh"}}):e._e()],1)},a=[],s=i("3ce3"),o=s["a"],r=i("2877"),l=Object(r["a"])(o,n,a,!1,null,null,null);t["default"]=l.exports},"6ad6":function(e,t,i){"use strict";i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return f})),i.d(t,"b",(function(){return m})),i.d(t,"a",(function(){return p}));const n={icon:"user-o",typeKey:"USER",tagType:"primary",name:"用户"},a={icon:"idcard",typeKey:"JOB",tagType:"success",name:"岗位"},s={icon:"credit-pay",typeKey:"BJOB",tagType:"success",name:"相对岗位"},o={icon:"wap-home-o",typeKey:"DEPARTMENT",tagType:"danger",name:"部门"},r={icon:"hotel-o",typeKey:"ORGANIZATION",tagType:"warning",name:"公司"},l={icon:"friends-o",typeKey:"ROLE",tagType:"success",name:"角色"},c={icon:"sign",typeKey:"GROUPTYPE",tagType:"success",name:"角色类型"},d={icon:"cluster-o",tagType:"",name:""},u={USER:n,JOB:a,BJOB:s,DEPARTMENT:o,ORGANIZATION:r,ROLE:l,OC:d,GROUPTYPE:c,user:n,job:a,bjob:s,dept:o,com:r,group:l,oc:d},f=["user","job","bjob","dept","com","group"],h=["ORGANIZATION","DEPARTMENT","GROUPTYPE","GROUP"],m=(e=[],t={})=>{const{ocType:i}=t;return e.map(e=>{const{basicDataType:t,existChildren:n,basicData:a,children:s,hasChildren:o}=e,r=u[t],l=null===r||void 0===r?void 0:r.icon,c=h.includes(t)&&n;let d;try{d=JSON.parse(a)||{}}catch(p){d={},console.error("oc-selector-list format error: ",e,p)}const f=!!d.Avatar,m=t!==i&&!!i;return{$isAvatar:f,$basicData:d,$icon:l,$isLink:c,$disabledCheck:m,...e}})},p="请选择"},"6b0b":function(e,t,i){"use strict";i("e42a")},7806:function(e,t,i){"use strict";i("5246")},8188:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"iform-control-label"},[e.isSpan?i("div",{staticClass:"ql-editor",domProps:{innerHTML:e._s(e.spanValue)}}):i("label",[e._v(e._s(e.data[e.configuration.code]))])])},a=[],s=i("9837"),o=(i("a753"),{name:"iform-control-label",data(){return{}},props:{data:{default(){return null}},parentCode:{type:String,default(){return null}},configuration:{type:Object,default(){return null}}},computed:{spanValue(){const{extension:e}=this.configuration;return e.value},isSpan(){return"span"===this.configuration.controlType},value(){return this.data[this.configuration.code]},store(){return this.$store}},methods:{init(){let e=this;Object(s["b"])(e.configuration.code,e)},setValue(e){this.data[this.configuration.code]=e}},mounted(){this.init()}}),r=o,l=(i("fbaa"),i("2877")),c=Object(l["a"])(r,n,a,!1,null,"31992e0a",null);t["default"]=c.exports},8412:function(e,t,i){},"88c1":function(e,t,i){},"8a1e":function(e,t,i){"use strict";i("61c2")},"8e3d":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"signature-pad"},[i("div",{staticClass:"signature-pad-box"},[i("canvas",{staticClass:"signature-pad-canvas",staticStyle:{"touch-action":"none","user-select":"none"},attrs:{id:e.canvasId,width:e.padWidth,height:e.padHeight}})]),i("div",{staticClass:"button-box"},[i("van-button",{attrs:{size:"small",round:"",plain:"",type:"primary"},on:{click:e.confirm}},[e._v(" 确认 ")]),i("van-button",{attrs:{size:"small",round:"",plain:"",type:"default"},on:{click:e.undo}},[e._v(" 撤销 ")]),i("van-button",{attrs:{size:"small",round:"",plain:"",type:"danger"},on:{click:e.clear}},[e._v(" 重写 ")]),i("van-button",{attrs:{size:"small",round:"",plain:"",type:"default"},on:{click:e.save}},[e._v(" 保存 ")]),i("van-button",{attrs:{size:"small",round:"",plain:"",type:"default"},on:{click:e.openPopup}},[e._v(" 列表 ")])],1),i("van-popup",{style:{height:"100%",width:"100%"},attrs:{position:"left"},model:{value:e.showPopup,callback:function(t){e.showPopup=t},expression:"showPopup"}},[i("div",{staticClass:"signatures"},[i("div",{staticClass:"signatures-box"},[e._l(e.signaturesData,(function(t){return i("div",{key:t.id,staticClass:"signatures-item",on:{click:function(i){return e.checkSignature(t)}}},[i("img",{attrs:{src:e.fileUrlWithToken(t.path),alt:""}})])})),i("div",{staticClass:"signatures-item",staticStyle:{height:"0",border:"none"}})],2),i("div",{staticClass:"signatures-button"},[i("van-button",{attrs:{size:"small",round:""},on:{click:function(t){e.showPopup=!1}}},[e._v(" 取消 ")])],1)])])],1)},a=[],s=(i("e7e5"),i("d399")),o=(i("9a83"),i("f564")),r=(i("d9e2"),i("e443")),l=i("361e"),c=i.n(l),d=i("90e2"),u=i("8af2");function f(e,t){return new File([e],t,{lastModified:Date.now(),type:e.type})}function h(e,t){const i=document.createElement("canvas"),{degree:n,rad:a}=t,s=a||n*Math.PI/180||0,{width:o,height:r}=m({width:e.width,height:e.height},s);i.width=o,i.height=o;const l=Math.atan(e.width/e.height),c=i.getContext("2d");c.save();const d=e.height*Math.abs(Math.sin(s)),u=e.height*Math.abs(Math.cos(s)),f=e.width*Math.abs(Math.cos(s)),h=e.width*Math.abs(Math.sin(s));let p,g;return s<l?(p=Math.min(d,f),g=0):s<Math.PI/2?(p=Math.max(d,f),g=0):s<Math.PI/2+l?(p=o,g=Math.min(u,h)):s<Math.PI?(p=o,g=Math.max(u,h)):s<Math.PI+l?(p=Math.max(d,f),g=r):s<Math.PI/2*3?(p=Math.min(d,f),g=r):s<Math.PI/2*3+l?(p=0,g=Math.max(u,h)):s<2*Math.PI&&(p=0,g=Math.min(u,h)),c.translate(p,g),c.rotate(s),c.drawImage(e,0,0),c.restore(),i}function m(e,t){const{width:i,height:n}=e,a=Math.abs(i*Math.cos(t))+Math.abs(n*Math.sin(t)),s=Math.abs(i*Math.sin(t))+Math.abs(n*Math.cos(t));return{width:a,height:s}}var p=i("365c"),g=i("f253"),v=i("d3be"),_=i("0173"),b={name:"signature-pad",props:{id:{type:String,default:()=>Object(u["a"])(12)}},data(){return{signaturePadInstance:null,showPopup:!1,signaturesData:[]}},computed:{padWidth(){return window.innerWidth-16},padHeight(){return window.innerHeight-120},canvasId(){return"signature-pad-canvas-"+this.id},userId(){const e=this.$store.getters.userInfo;return e.Id}},mounted(){this.getSignaturesData(),this.initSignaturePad()},methods:{fileUrlWithToken:_["c"],initSignaturePad(){const e=document.querySelector("#"+this.canvasId);this.signaturePadInstance||(this.signaturePadInstance=new d["a"](e))},clear(){this.signaturePadInstance&&this.signaturePadInstance.clear()},undo(){const e=this.signaturePadInstance.toData();e&&(e.pop(),this.signaturePadInstance.fromData(e))},signaturePadIsEmpty(){return!!this.signaturePadInstance.isEmpty()&&(Object(o["a"])({type:"warning",message:this.$t("没有签名")}),!0)},confirm(){if(this.signaturePadIsEmpty())return;const e=h(this.signaturePadInstance.canvas,{degree:270});c()(e),e.toBlob(async e=>{const t=await this.blobToRemoteUrl(e,this.id);this.$emit("confirm",t)})},blobToRemoteUrl(e,t=Object(u["a"])(12)){const i=t+".png",n=f(e,i),a=new FormData;return a.append("File",n),a.append("IsReName","false"),a.append("DirName","signature"),a.append("FileName",n.name),r["b"].post(p["d"].getUploadFileUrl(),a,{NotAuth:!0}).then(e=>e.data).then(({data:e,code:t,message:i})=>{if(1!==t)throw s["a"].fail("上传失败："+i),Error(i);const n=`${g["d"]}/${e.fileAccessPath}?t=${Date.now()}`;return n}).catch(e=>s["a"].fail("上传失败："+e))},async getSignaturesData(){const{data:e}=await Object(v["m"])();1===e.code&&(this.signaturesData=e.data)},checkSignature(e){this.showPopup=!1,this.clear(),this.$emit("confirm",e.path)},save(){if(this.signaturePadIsEmpty())return;const e=h(this.signaturePadInstance.canvas,{degree:270});c()(e),e.toBlob(async e=>{const t=await this.blobToRemoteUrl(e),i=await Object(v["b"])(this.userId,t);i.data.data?(Object(o["a"])({type:"success",message:"保存成功"}),this.$emit("confirm",t),this.clear(),this.getSignaturesData()):Object(o["a"])({type:"error",message:i.data.message})})},openPopup(){this.getSignaturesData(),this.showPopup=!0}}},y=b,k=(i("0905"),i("2877")),I=Object(k["a"])(y,n,a,!1,null,"6cdccf63",null);t["a"]=I.exports},9038:function(e,t,i){},"90fc":function(e,t,i){"use strict";i("5780")},9251:function(e,t,i){},"93bb":function(e,t,i){},9746:function(e,t,i){},"9cb5":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"iform-control-signature-pad"},[i("div",{staticClass:"signature-pad-preview",on:{click:e.openPad}},[e.viewable?i("img",{staticClass:"signature-image",attrs:{src:e.fileUrlWithToken(e.value),alt:"signature"}}):i("span",[e._v(e._s(e.$t("点我签名")))])]),e.readonly?e._e():i("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[i("van-nav-bar",{attrs:{title:e.$t("手写签名")},scopedSlots:e._u([{key:"right",fn:function(){return[i("van-icon",{attrs:{name:"cross",size:"18"},on:{click:function(t){e.show=!1}}})]},proxy:!0}],null,!1,1592604307)}),i("FullScreenSignaturePad",{on:{confirm:e.confirm}})],1)],1)},a=[],s=(i("9a83"),i("f564")),o=i("9837"),r=i("8e3d"),l=i("0173"),c={components:{FullScreenSignaturePad:r["a"]},name:"iform-control-signature-pad",props:{data:Object,configuration:Object,preview:Boolean},data(){return{signaturePadInstance:null,show:!1}},computed:{readonly(){return this.preview||this.configuration.isReadable},viewable(){return Boolean(this.value)},value:{get(){return this.data[this.configuration.code]},set(e){this.data[this.configuration.code]=e}}},mounted(){Object(o["b"])(this.configuration.code,this)},methods:{fileUrlWithToken:l["c"],confirm(e){this.value=e,Object(s["a"])({type:"success",message:this.$t("签名成功")}),this.show=!1},openPad(){this.readonly?Object(s["a"])({type:"warning",message:this.$t("不可编辑")}):this.show=!0}}},d=c,u=(i("3142"),i("2877")),f=Object(u["a"])(d,n,a,!1,null,"ba4648de",null);t["default"]=f.exports},"9ef9":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));const n={"iform-control-span":()=>Promise.resolve().then(i.bind(null,"8188")),"iform-control-label":()=>Promise.resolve().then(i.bind(null,"8188")),"iform-control-textbox":()=>i.e("chunk-80b66218").then(i.bind(null,"2869")),"iform-control-signature":()=>Promise.resolve().then(i.bind(null,"9cb5")),"iform-control-textarea":()=>i.e("chunk-71a04a08").then(i.bind(null,"4773")),"iform-control-numberspinner":()=>i.e("chunk-1bb4d940").then(i.bind(null,"f4c6")),"iform-control-datebox":()=>i.e("chunk-1ffd1e2c").then(i.bind(null,"c64f")),"iform-control-numberbox":()=>i.e("chunk-607ca8fa").then(i.bind(null,"654a")),"iform-control-combobox":()=>i.e("chunk-9f015aee").then(i.bind(null,"1a19")),"iform-control-radiobox":()=>i.e("chunk-789e4c2f").then(i.bind(null,"ec6d")),"iform-control-checkbox":()=>i.e("chunk-660b0a8e").then(i.bind(null,"7ab0")),"iform-control-ocbox":()=>Promise.all([i.e("npm.lodash-es~b92ffc84"),i.e("chunk-7d9a27b3")]).then(i.bind(null,"062c")),"iform-control-htmledit":()=>i.e("chunk-2d0be16b").then(i.bind(null,"2f89")),"iform-control-filebox":()=>Promise.all([i.e("npm.compressorjs~c63eb7ec"),i.e("chunk-272b7b14")]).then(i.bind(null,"3693")),"iform-control-combotree":()=>Promise.all([i.e("npm.element-ui~59f3426a"),i.e("npm.element-ui~d63aa588"),i.e("npm.element-ui~fb66671e"),i.e("npm.element-ui~fe785c75"),i.e("chunk-5d2bdc8c")]).then(i.bind(null,"2903")),"iform-control-combogrid":()=>Promise.all([i.e("npm.lodash-es~b92ffc84"),i.e("chunk-f512905e")]).then(i.bind(null,"8799")),"iform-control-formatter":()=>Promise.resolve().then(i.bind(null,"2d22")),"iform-control-autonumber":()=>i.e("chunk-28771cdc").then(i.bind(null,"b959")),"iform-control-rate":()=>i.e("chunk-7d4a4f6a").then(i.bind(null,"f7af")),"iform-control-switch":()=>i.e("chunk-48333428").then(i.bind(null,"7cb7")),"iform-control-cascader":()=>Promise.all([i.e("npm.element-ui~59f3426a"),i.e("npm.element-ui~d63aa588"),i.e("npm.element-ui~fb66671e"),i.e("npm.element-ui~fe785c75"),i.e("chunk-071ec5a3")]).then(i.bind(null,"cf20")),"iform-control-citypicker":()=>Promise.all([i.e("npm.vant~253ae210"),i.e("npm.vant~d3c695a7"),i.e("chunk-2d0e6c4b")]).then(i.bind(null,"99c8")),"iform-control-cardnumber":()=>i.e("chunk-5aa2e346").then(i.bind(null,"e4de")),"iform-control-_link":()=>Promise.resolve().then(i.bind(null,"ebce")),"iform-control-_verificationCode":()=>i.e("chunk-23928f94").then(i.bind(null,"beef")),"iform-control-taoHong":()=>i.e("chunk-2d209b79").then(i.bind(null,"a9f1")),TipsText:()=>i.e("chunk-3f54718a").then(i.bind(null,"9464"))},a={...n,"iform-control-datebox":()=>i.e("chunk-1221a140").then(i.bind(null,"a4c8"))}},a2c2:function(e,t,i){"use strict";i("f02f")},a7d6:function(e,t,i){},aa04:function(e,t,i){"use strict";i("5014")},ac6a:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("van-action-sheet",{attrs:{actions:e.actions},on:{select:e.onSelect},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}}),i("van-popup",{staticStyle:{width:"100vw",height:"100vh"},attrs:{closeable:""},model:{value:e.iframeState.show,callback:function(t){e.$set(e.iframeState,"show",t)},expression:"iframeState.show"}},[e.iframeState.show?i("iframe",{staticStyle:{width:"100%",height:"100%",border:"none"},attrs:{src:e.iframeState.url}}):e._e()])],1)},a=[],s=(i("14d9"),i("0173")),o={model:{prop:"visible",event:"setVisible"},props:{url:{type:String},uri:{type:String},name:{type:String},visible:{type:Boolean}},data(){return{iframeState:{show:!1,url:""},actions:[{key:"Download",name:"下载"},{key:"NewTab",name:"内置预览"},{key:"ImagePreview",name:"图片预览"},{key:"FileViewer",name:"外部预览(多种格式)"}]}},computed:{show:{get(){return this.visible},set(e){this.$emit("setVisible",e)}}},mounted(){var e;const t=window.projectConfig.filePreviewMenu;t&&t.length&&(this.actions=t),null!==(e=window.projectConfig.officeSettings)&&void 0!==e&&e.wps.enable&&this.actions.push({key:"WPSOnline",name:"WPS在线预览"}),isWeiXinEnv()&&this.actions.push({key:"FileViewer-iframe",name:"预览服务(iframe)"})},methods:{onSelect(e){const t=Object(s["b"])({url:this.url,uri:this.uri});"FileViewer-iframe"===e.key?(this.iframeState.show=!0,this.iframeState.url=t):Object(s["d"])(e.key,t,this.name),this.show=!1}}},r=o,l=i("2877"),c=Object(l["a"])(r,n,a,!1,null,null,null);t["a"]=c.exports},ae4e:function(e,t,i){"use strict";i("2fc5")},b408:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"timeline",attrs:{id:"tb_approval_history_list"}},[i("ul",[e._l(e.signs,(function(t){return i("li",{key:t.id,class:"data-item icon-"+e.getSignStatus(t)},[i("iform-sign",{attrs:{signs:e.signs,data:t,approverFuzzy:e.approverFuzzy}})],1)})),e.activeTask.length>1?i("li",{class:"data-item approve-hq "+(e.isWaiting?"icon-wait":"icon-pass")},[i("img",{staticClass:"approve-status",attrs:{src:e.isWaiting?"/static/images/icon-wait.png":"/static/images/icon-pass.png"}}),i("ul",{staticStyle:{"margin-left":"10px"}},e._l(e.activeTask,(function(t,n){return i("li",{key:n,class:"data-item icon-"+e.getSignStatus(t)},[i("iform-sign",{attrs:{signs:e.signs,data:t,approverFuzzy:e.approverFuzzy,hideStep:!1}})],1)})),0)]):e.activeTask.length?i("li",[i("iform-sign",{class:"data-item icon-"+e.getSignStatus(e.activeTask[0]),attrs:{data:e.activeTask[0],signs:e.signs,approverFuzzy:e.approverFuzzy}})],1):e._e()],2)])},a=[],s=(i("14d9"),i("13d5"),i("365c")),o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return Array.isArray(e.data)?i("div",{staticClass:"copy-read"},[i("div",{staticClass:"step-name"},[e._v(" "+e._s(e.data[0].activeStepName)+" "),i("span",{staticStyle:{color:"#000","font-size":"15px","margin-left":"20px"}},[e._v("已抄送"+e._s(e.data.length)+"人 "),i("span",{staticStyle:{color:"#2e73e8","font-size":"12px"}},[e._v(e._s(e.count)+"人已读")])])]),i("img",{staticClass:"approve-status",staticStyle:{background:"#fff"},attrs:{src:"/static/icons/通知.png"}}),i("div",{staticClass:"content"},e._l(e.data,(function(t){return i("div",{key:t.id,staticClass:"content-item"},[i("van-image",{attrs:{src:e.getSrc(t),radius:"5px"}}),i("div",{staticClass:"name"},[e._v(e._s(t.taskUserName))]),i("div",{class:t.activeSubStatus.includes("UNREAD")?"unread":"read"},[e._v(" "+e._s(t.activeSubStatus.includes("UNREAD")?"未读":"已读")+" ")]),i("div",{staticClass:"approve-department"},[e._v(e._s(t.orgName))])],1)})),0)]):i("div",{staticClass:"iform-sign",class:"icon-"+e.getSignStatus(e.data)},[e.hideStep?e._e():i("div",{staticClass:"approve-stepname"},[e._v(e._s(e.signInfo.stepName))]),i("img",{staticClass:"approve-status",attrs:{src:"/static/images/icon-"+e.getSignStatus(e.signInfo)+".png"}}),i("div",{staticClass:"approve-info"},[i("van-image",{staticClass:"approve-photo",attrs:{src:e.avatar,radius:"5px"}}),i("div",{staticClass:"approve-user"},[e._v(" "+e._s(e.approverFuzzy?e.signInfo.orgName:e.signInfo.userName)+" ")]),i("div",{staticClass:"approve-sign"},[e._v(e._s(e.signInfo.signText))]),i("div",{staticClass:"approve-department"},[e._v(e._s(e.signInfo.orgName))]),[e.checkPermissions()?i("van-button",{staticClass:"approve-date",attrs:{color:"#7232dd",size:"mini",plain:"",round:""},on:{click:e.handleUrging}},[e._v("催办")]):i("div",{staticClass:"approve-date"},[e._v(" "+e._s(e.convertDate(e.signInfo.handleTime))+" ")])]],2),i("div",{staticClass:"approve-content",staticStyle:{"word-break":"break-all"}},[e._v(" "+e._s(e.signInfo.remark)+" ")]),e.enableApproveSign?i("div",{staticClass:"approve-signature"},[e.signInfo.signature?i("ApproveSign",{staticStyle:{height:"40px",margin:"30px 0 0 20px"},attrs:{onlyPreview:""},model:{value:e.signInfo.signature,callback:function(t){e.$set(e.signInfo,"signature",t)},expression:"signInfo.signature"}}):e._e()],1):e._e(),i("div",{staticClass:"approve-operate",staticStyle:{"text-align":"right",padding:"2px 20px"}})])},r=[],l=i("2f62"),c=i("3bce"),d=i("dee4");function u(e,t,i,n){n.UserRoles=Array.isArray(n.UserRoles)?n.UserRoles:[n.UserRoles];const a=[],s=[],o=[],r=[];e.forEach(e=>{"U"===e.type&&a.push(e),"J"===e.type&&s.push(e),"D"===e.type&&o.push(e),"R"===e.type&&r.push(e)});const l={and:"every",or:"some"},c=l[t],d=a.length>0&&a[c](e=>e.id===n.Id),u=s.length>0&&s[c](e=>n.role.includes(e.name)),f=o.length>0&&o[c](e=>n.Jobs.map(e=>e.DepartmentId).includes(e.id)),h=r.length>0&&r[c](e=>n.UserRoles.map(e=>e.Id).includes(e.id)),m="and"===i?d&&u&&f&&h:d||u||f||h;return m}var f=i("b199"),h=i("2a7f"),m={name:"iform-sign",data(){return{sign:{stepName:"",userId:"",userName:"",signText:"",avatar:"",status:"",signature:""},urging:!0,count:0,userInfo:null,enableApproveSign:window.projectConfig.enableApproveSign}},inject:["parent"],watch:{data:{immediate:!0,deep:!0,handler(e){Array.isArray(e)&&(this.count=e.reduce((e,t)=>t.activeSubStatus.includes("UNREAD")?e:e+1,0))}}},props:{data:{type:Object|Array,default(){return null}},hideStep:{type:Boolean,default(){return!1}},signs:{type:Array,default(){return[]}},approverFuzzy:{type:Boolean,default(){return!1}}},created(){if(Array.isArray(this.data)){const e=this.data.map(e=>e.taskUser);s["h"].getUserInfo(e.join(",")).then(({data:e})=>{this.userInfo=e})}},computed:{...Object(l["c"])({user:"userInfo",platform:"platform",processName:"processName",taskInfo:"taskInfo"}),signInfo(){return Object.assign(this.sign,this.data?this.data:{})},showRealAvatarInProcess(){var e;return!1!==(null===(e=window.projectConfig.featureFlag)||void 0===e?void 0:e.showRealAvatarInProcess)},avatar(){const e="/static/images/user.png";return this.showRealAvatarInProcess&&this.signInfo.avatar||e}},methods:{handleUrging(){Object(f["e"])(this.taskInfo.instanceId,this.signInfo.userId).then(({data:e})=>{1===e.code?this.$dialog.alert({message:"催办成功！"}):this.$dialog.alert({message:"催办失败，请重试！"})})},getSignStatus(e){return Object(c["n"])(e)},convertDate(e){return d["a"].formatMiniDate(e)},checkPermissions(){var e,t;if(!Object(c["s"])(this.data))return!1;if(!this.parent)return!1;const i=this.user.UserAccount,n=this.signs.map(e=>e.userId);if(!n.includes(i))return!1;if(this.data.userId===i)return!1;const a=null===(e=this.parent)||void 0===e?void 0:e.configuration.attributes,s=null===(t=this.parent)||void 0===t||null===(t=t.configuration.activeTasks)||void 0===t?void 0:t.find(e=>this.sign.stepId===e.stepId).attributes;let o=null;try{o=JSON.parse(s.urgeConfig||a.urgeConfig.value)}catch(f){o=null}if(!o)return!0;if(!o.enableTaskUrge)return!1;const{selectedPermissions:r,permissionsObjectLimited:l,permissionsLimited:d}=o;return!r||0===r.length||u(r,l,d,this.user)},getSrc(e){let t="";return this.userInfo&&this.userInfo.filter(i=>{i.userId==e.taskUser&&(t=i.avatar)}),t}},components:{ApproveSign:h["a"]}},p=m,g=(i("aa04"),i("2877")),v=Object(g["a"])(p,o,r,!1,null,"69e8691d",null),_=v.exports,b=i("4a9d"),y=i("5a0c"),k=i.n(y),I={name:"iform-sign-list",data(){return{isWaiting:!1,signs:[],activeTask:[],ccList:[],signsList:[]}},props:{instanceId:{type:String,default(){return""}},instanceStatus:{type:Number},config:{type:Object,default(){return{}}}},watch:{instanceId:{deep:!0,immdiate:!0,handler(e){e&&this.handleRender()}}},computed:{approverFuzzy(){const e=this.config.attributes||{};if(e.ApproverFuzzy){var t;const i=null===(t=e.ApproverFuzzy)||void 0===t?void 0:t.value;return"True"===i}return!1}},methods:{init(){this.handleRender()},handleRender(){let e=this;if(e.instanceId){let e=this;s["d"].getSiginList(e.instanceId).then(t=>{1===t.code&&(e.signs=t.data,b["a"].$emit("setSignList",t.data),s["h"].getInstanceActiveTasks(e.instanceId).then(t=>{let i=t.data;if(i.forEach(t=>{var i;let n=e.getStatus(t);"inbox"===n&&(e.isWaiting=!0);const a=null===(i=t.variables.Sys_OrgPath)||void 0===i?void 0:i.split("/").pop();e.activeTask.push({stepName:t.displayName,userId:t.assignee,userName:t.assigneeName,signText:Object(c["p"])(t),avatar:t.avatar,status:n,stepId:t.stepId,orgName:a})}),this.handleDataType(),2===this.instanceStatus){const e=this.signs[this.signs.length-1].handleTime;this.signs.push({stepName:"完成",userName:"完成",signText:"完成",handleTime:e})}}))}).catch(e=>{console.log("getSignList.err",e)})}},getSignStatus(e){return Object(c["n"])(e)},getStatus(e){return Object(c["o"])(e)},handleDataType(){if(!Array.isArray(this.signs))return;let e=[],t=[];this.signs.filter(i=>{"copyread"!==i.status&&(e.length>0&&t.push(e),t.push(i),e=[]),"copyread"==i.status&&e.push(i)}),e.length>0&&t.push(e),this.signs=t,this.signs=this.signs.map(e=>{if(Array.isArray(e)){const t=this.ccList.filter(t=>t.stepId===e[0].stepId);return t.map(t=>({...t,orgName:e[0].orgName}))}return e});const i=this.ccList.filter(e=>e.stepId.startsWith("NotifyTask")),n=i.reduce((e,t)=>{const i=e.find(e=>e[0].stepId===t.stepId),n=this.getAllStepId();return n.includes(t.stepId)||(i?i.push(t):e.push([t])),e},[]);n.forEach(e=>{const t=this.getAllStepId();t.includes(e[0].stepId)||this.signs.push(...n)}),this.signs.sort((e,t)=>{const i=k()(e.handleTime||e[0]&&e[0].handleTime),n=k()(t.handleTime||t[0]&&t[0].handleTime);return i-n})},getAllStepId(){return this.signs.map(e=>Array.isArray(e)?e[0].stepId:e.stepId)},getCCList(){s["h"].getProcessMap("",this.instanceId).then(({data:{data:e}})=>{this.ccList=e.processTaskVariables})}},mounted(){this.getCCList(),this.init()},components:{"iform-sign":_}},w=I,C=(i("90fc"),Object(g["a"])(w,n,a,!1,null,"418c08e2",null));t["a"]=C.exports},b764:function(e,t,i){"use strict";i("8412")},beca:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("van-row",{staticClass:"iform-form-body"},[e.formConfiguration&&e.formData?i("van-form",{ref:"iform-form",attrs:{model:e.formData}},e._l(e.formConfiguration.formItems,(function(t){return i("iform-item",{key:e.key(t),ref:e.key(t),refInFor:!0,attrs:{data:e.formData,configuration:t,formConfig:e.formConfig,colspan:e.colspan}})})),1):e._e()],1)},a=[],s=i("4a9d"),o=i("4a60"),r=i("f485"),l=i("3bce"),c=i("9837"),d={name:"iform-form-body",data(){return{formData:{},formConfig:null,size:"mini",events:{"iform.form.validate":this.handleValidate,"iduo.form.relation":e=>e,"iduo.form.visible":e=>e}}},props:{data:{type:Object,default(){return null}},configuration:{type:Object,default(){return null}}},watch:{data:{deep:!0,immediate:!0,handler(e){this.formData=e}},configuration:{immediate:!0,handler(e){this.formConfig=e,e&&(this.formData=this.structData())}},formData:{deep:!0,immediate:!0,handler(e){s["a"].$emit("iform.save",e)}}},computed:{colspan(){var e;return null!==this.formConfig?null===(e=this.formConfig.formConfiguration.extension)||void 0===e?void 0:e.totalColspan:4},formConfiguration(){return null!==this.formConfig?this.formConfig.formConfiguration:null},store(){return this.$store},target(){return this.$refs["iform-form"]}},methods:{init(){Object(o["b"])(this.events),Object(c["b"])("iform-form",this)},handleSave(e){let t=this;iduo.form.valid(i=>{const n=i.map(e=>{const t=iduo.refs[e.code].configuration.name;if(t)return{code:e.code,message:e.message,name:t}});e instanceof Function&&e.call(t,0===i.length,n)})},structData(){const e={},t=this.formConfiguration.formItems;return t.forEach(t=>{this.struct(e,t)}),e},struct(e,t){const{code:i,items:n}=t,a=this.data?this.data[i]:"";if(this.is(t,["detail"]))e[i]=a||[];else if(this.is(t,["component","group"]))n&&Array.isArray(n)&&n.forEach(t=>{this.struct(e,t)});else{if(!i)return;e[i.replace(/\./g,"-")]=a}},defaultValue(e){let t;switch(e.controlType){case"numberbox":case"numberspinner":t="";break;default:t="";break}return t},key(e){return e.code?"iform-item-"+e.code:"iform-item-"+parseInt(1e4*Math.random())},handleValidate(e){let t=this;if(e){const i=t.$refs["iform-form"].clearValidate;i&&i(e)}},is(e,t){return Object(l["r"])(e,t)}},mounted(){this.init()},destroyed(){Object(o["a"])(this.events)},components:{IformItem:r["a"]}},u=d,f=i("2877"),h=Object(f["a"])(u,n,a,!1,null,null,null);t["a"]=h.exports},bfd3:function(e,t,i){"use strict";i("88c1")},c128:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.isSelected?i("div",{staticClass:"selected-item"},e._l(e.selected,(function(t,n){return i("van-tag",{key:t.id,attrs:{closeable:!e.readonly,plain:"",size:"medium",type:e.itemType(t)},on:{close:function(i){return e.handleRemove(t,n)}}},[e._v(e._s(t.title))])})),1):e._e()},a=[],s=i("6ad6"),o={name:"selected-item",props:{selected:{type:Array,default:()=>[]},readonly:{type:Boolean,default:!1}},data(){return{}},computed:{isSelected(){return this.selected&&this.selected.length>0}},methods:{itemType(e){var t;return(null===(t=s["c"][e.basicDataType])||void 0===t?void 0:t.tagType)||"primary"},handleRemove(e,t){this.$emit("close-item",e,t)}}},r=o,l=(i("c9b4"),i("2877")),c=Object(l["a"])(r,n,a,!1,null,null,null);t["a"]=c.exports},c38b:function(e,t,i){},c449:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"remote-resource"},[e._l(e.scriptList,(function(e,t){return i("remote-script",{key:"scirpts-"+t,attrs:{src:e}})})),e._l(e.cssList,(function(e,t){return i("remote-css",{key:"css-"+t,attrs:{src:e}})}))],2)},a=[],s=(i("14d9"),{name:"remote-resource",data(){return{scriptList:[],cssList:[]}},props:{scripts:{type:Array,default(){return[]}},css:{type:Array,default(){return[]}},json:{type:String,default(){return null}}},watch:{scripts:{deep:!0,immediate:!0,handler(e){this.handleScript(e)}},css:{deep:!0,immediate:!0,handler(e){this.handleScript(e)}},json:{deep:!0,immediate:!0,handler(e){this.handleJson(e)}}},methods:{handleScript(e){this.scriptList=e},handleCss(e){this.cssList=e},handleJson(e){let t=this;if(e){var i=e.split(/[(\r\n)\r\n]+/);i.length&&i.forEach(e=>{let i=e.split(":")[0],n=e.split(i+":")[1];"css"===i?t.cssList.push(n):t.scriptList.push(n)})}}}}),o=s,r=i("2877"),l=Object(r["a"])(o,n,a,!1,null,null,null);t["a"]=l.exports},c9b4:function(e,t,i){"use strict";i("63a3")},cc04:function(e,t,i){"use strict";i("4a6f")},cea9:function(e,t,i){"use strict";i("ea9f")},d0c6:function(e,t,i){"use strict";i("5d0f")},da33:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"selector-wrapping"},[i("van-sticky",[i("van-nav-bar",{attrs:{"safe-area-inset-top":""},scopedSlots:e._u([{key:"left",fn:function(){return[i("van-button",{attrs:{color:"#fff",size:"small"},on:{click:function(t){return e.$emit("close")}}},[i("van-icon",{attrs:{name:"arrow-down",size:"20"}})],1)]},proxy:!0},{key:"title",fn:function(){return[e._v(" "+e._s(e.options.placeholder)+" ")]},proxy:!0},{key:"right",fn:function(){return[i("van-button",{attrs:{color:"#fff",size:"small"},on:{click:e.handleConfirm}},[i("div",{staticClass:"nav-bar_right"},[e._v("确认")])])]},proxy:!0}])}),i("van-search",{staticClass:"van-hairline--bottom",attrs:{placeholder:"请输入搜索关键词"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e.isSelected&&!e.isRadioMode?i("van-cell",{staticClass:"van-hairline--bottom"},[i("SelectedItem",{attrs:{selected:e.selectedList},on:{"close-item":e.handleCloseItem}})],1):e._e()],1),i("van-tabs",{staticClass:"selector-tabs"},e._l(e.options.metadata,(function(t){return i("van-tab",{key:t.typeKey,attrs:{title:t.name}},[i("SelectorList",{attrs:{options:Object.assign({},e.options,{metadata:t,ocType:t.typeKey}),keyword:e.keyword,selected:e.selectedList},on:{select:e.handleSelect}})],1)})),1)],1)},a=[],s=(i("14d9"),i("c128")),o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"oc-selector-list"},[i("transition-group",{staticStyle:{height:"100%"},attrs:{name:"van-slide-right",tag:"div"}},[e._l(e.cards,(function(t,n){return[i("div",{key:n,staticClass:"list-card",style:{zIndex:n}},[!e.isFirstFloor&&n>0?i("van-cell",{attrs:{"title-class":"list-title",icon:"revoke",clickable:"",center:"","is-link":"",title:"上一页"},on:{click:e.handleBack},scopedSlots:e._u([{key:"icon",fn:function(){return[i("div",{staticClass:"item-checkbox-wrapping",on:{click:function(e){e.stopPropagation()}}},[i("van-checkbox",{attrs:{disabled:e.isDisabledAll(),value:e.isCheckedAll(n),"icon-size":"18px"},on:{click:function(t){return e.handleClickAll(n)}}})],1)]},proxy:!0},{key:"title",fn:function(){return[i("van-icon",{attrs:{name:"revoke",size:"20"}}),i("span",{staticClass:"list-title_text van-ellipsis"},[e._v(" 上一页 ")])]},proxy:!0}],null,!0)}):e._e(),e._l(t,(function(t){return i("van-cell",{key:t.id,attrs:{"is-link":t.$isLink,clickable:"",center:"","title-class":"list-title"},on:{click:function(i){return e.loadNextData(t)}},scopedSlots:e._u([{key:"icon",fn:function(){return[i("div",{staticClass:"item-checkbox-wrapping",on:{click:function(e){e.stopPropagation()}}},[i("van-checkbox",{attrs:{disabled:t.$disabledCheck,value:e.isChecked(t),"icon-size":"18px"},on:{click:function(i){return e.handleClick(t)}}})],1)]},proxy:!0},{key:"title",fn:function(){return[t.$isAvatar?i("van-image",{attrs:{width:"20",height:"20",src:t.$basicData.Avatar,round:""}}):i("van-icon",{attrs:{name:t.$icon,size:"20"}}),i("span",{staticClass:"list-title_text van-ellipsis"},[e._v(" "+e._s(t.title)+" ")])]},proxy:!0}],null,!0)})}))],2)]}))],2),i("transition",{attrs:{name:"van-slide-up"}},[e.isFirstFloor?e._e():i("van-button",{staticClass:"btn-back_fixed",attrs:{round:""},on:{click:e.handleBack}},[i("van-icon",{attrs:{name:"arrow-left",size:"20",color:"#1989fa"}})],1)],1),i("van-overlay",{attrs:{show:e.loading,"custom-style":{backgroundColor:"#ffffff00"}},on:{click:function(t){e.loading=!1}}},[i("div",{staticClass:"wrapper",on:{click:function(e){e.stopPropagation()}}},[i("van-loading",{attrs:{size:"40",color:"#1989fa"}})],1)])],1)},r=[],l=i("cd12"),c=i("6ad6"),d=i("85b1"),u={name:"oc-selector-list",props:{keyword:{type:String,default:""},options:{type:Object,default:()=>({})},selected:{type:Array,default:()=>[]}},data(){return{cards:[],loading:!1,checkedList:[],optional:[],formData:{Scopes:this.options.scopes,TreeType:this.options.ocType}}},computed:{isFirstFloor(){return this.cards.length<=1},isRadioMode(){return!0!==this.options.allowMulti}},watch:{keyword(e){this.searchData(e)}},mounted(){this.loadData(this.formData)},methods:{handleClick(e){e.$disabledCheck||this.$emit("select",e)},searchData:Object(d["a"])((function(e){this.cards=[],this.loadData({keyword:e.trim(),...this.formData})}),500,{trailing:!0}),loadData(e){this.loading=!0,Object(l["a"])(e).then(({data:e})=>{const{code:t,data:i}=e;if(1===t){const e=Object(c["b"])(i,this.options);this.optional=e.filter(e=>!e.$disabledCheck),this.cards.push(e)}}).finally(()=>{this.loading=!1})},loadNextData(e){if(e.$isLink)if(e.children&&e.children.length>0){const t=Object(c["b"])(e.children,this.options);this.optional=t.filter(e=>!e.$disabledCheck),this.cards.push(t)}else this.loadData({NodeId:e.id,...this.formData});else this.handleClick(e)},handleBack(){this.isFirstFloor||this.cards.pop()},isChecked(e){return!!this.selected.find(t=>t.id===e.id)},handleClickAll(){if(!this.isDisabledAll())if(this.isCheckedAll())this.optional.forEach(e=>this.$emit("select",e));else{const e=this.optional.filter(e=>!this.isChecked(e));e.forEach(e=>this.$emit("select",e))}},isCheckedAll(){var e;return(null===(e=this.optional)||void 0===e?void 0:e.length)>0&&this.optional.every(this.isChecked)},isDisabledAll(){return this.isRadioMode||this.optional.every(e=>e.$disabledCheck)}}},f=u,h=(i("6b0b"),i("2877")),m=Object(h["a"])(f,o,r,!1,null,"67107e15",null),p=m.exports,g={name:"oc-selector",components:{SelectedItem:s["a"],SelectorList:p},props:{selected:{type:Array,default:()=>[]},options:{type:Object,default:()=>({})}},data(){return{keyword:"",selectedList:[]}},computed:{isSelected(){var e;return(null===(e=this.selectedList)||void 0===e?void 0:e.length)>0},isRadioMode(){return!0!==this.options.allowMulti}},mounted(){this.selectedList=this.selected.map(e=>e)},methods:{handleCloseItem(e,t){this.selectedList.splice(t,1)},handleSelect(e){this.isRadioMode&&(this.selectedList=[e],this.handleConfirm());const t=this.selectedList.findIndex(t=>t.id===e.id);-1===t?this.selectedList.push(e):this.selectedList.splice(t,1)},handleConfirm(){this.$emit("confirm",this.selectedList),this.$emit("close")}}},v=g,_=(i("57b5"),Object(h["a"])(v,n,a,!1,null,"58c08962",null));t["a"]=_.exports},ddaf:function(e,t,i){"use strict";i("18cc")},e354:function(e,t,i){},e35b:function(e,t,i){},e42a:function(e,t,i){},ea7d:function(e,t,i){},ea9f:function(e,t,i){},ebce:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"iform-control-link"},[i("a",{staticClass:"el-link el-link--primary is-underline",attrs:{href:e.href||"#",target:e.linkData.target},on:{click:function(t){return t.stopPropagation(),e.handleClick.apply(null,arguments)}}},[i("span",{staticClass:"el-link--inner"},[e._v(" "+e._s(e.linkData.name||e.linkData.path||"这是一个链接")+" ")])])])},a=[],s=(i("14d9"),i("163b")),o={name:"iform-control-link",props:{data:{type:Object,default:()=>({})},configuration:{type:Object,default:()=>({})}},computed:{linkData(){const e=this.configuration;return{path:e.extension.value||"",name:e.extension.text||"",target:e.extension.openType}}},data(){return{href:""}},watch:{data:{deep:!0,immediate:!0,handler(e){this.href=this.getFullHref(this.linkData.path)}}},methods:{async handleClick(){const{path:e,target:t}=this.linkData;if(!e)return;const i="_blank"===t;if(e.includes("script:")){const t=e.split(":")[1]||"",n=window[t.trim()];if(n instanceof Function){const e=n();if(!e)return;if("string"===typeof e)this.geToByPath(e,i);else if(e instanceof Promise){const t=await e;this.geToByPath(t,i)}}}else{const t=this.getFullHref(e);this.geToByPath(t,i)}},getFullHref(e){const t=/\{(.+?)\}/g;return e.replace(t,(e="")=>{const t=e.replace(/\{|\}/g,"").replace(".","-"),i=this.data[t];return i||t})},geToByPath(e,t){if(Object(s["j"])(e))t?window.open(e):window.location.assign(e);else{const i=window.location.origin,n=e.includes(i);t?window.open(n?e:i+e):this.$router.push(e.replace(i,""))}}}},r=o,l=(i("d0c6"),i("2877")),c=Object(l["a"])(r,n,a,!1,null,"fb8c7604",null);t["default"]=c.exports},eeda:function(e,t,i){"use strict";i("9251")},f02f:function(e,t,i){},f485:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.showItem?i("van-row",{directives:[{name:"show",rawName:"v-show",value:e.itemVisible,expression:"itemVisible"}],class:["iform-item",e.type,e.parentClass,e.is(e.configuration,["group","component"])?"group-item":"sign-item"],style:{marginBottom:e.formItemBigIntervalsValue}},[e.taskInfo&&e.isTop&&e.isLightFormTheme?i("iform-temp-top",{attrs:{taskInfo:e.taskInfo,formConfig:e.formConfig}}):e._e(),i("van-collapse",{attrs:{border:!1},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[e.is(e.configuration,["group","component"])?[i("div",{staticClass:"iform-item-collapse",style:{margin:e.groupVerticalMargin}},[i("van-collapse-item",{attrs:{title:e.$t(e.configuration.name),name:e.configuration.name,border:!1}},[e.isTop?e._e():i("div",{staticClass:"collapse-title",attrs:{slot:"title"},slot:"title"},[i("IconPreview",{staticStyle:{"margin-left":"-6px","margin-right":"5px"},attrs:{name:e.groupIcon,size:"35"}}),e._v(" "+e._s(e.$t(e.configuration.name))+" ")],1),e.isTop&&!e.isLightFormTheme?i("div",{attrs:{slot:"title"},slot:"title"},[e.taskInfo?i("iform-temp-top",{attrs:{taskInfo:e.taskInfo,formConfig:e.formConfig}}):e._e()],1):e._e(),e._l(e.configuration.items,(function(t,n){return i("iform-item",{key:n,staticClass:"sub-item",attrs:{data:e.data,configuration:t,colspan:e.colspan,formConfig:e.formConfig}})}))],2)],1)]:e.is(e.configuration,["detail"])?[i("iform-control-datagrid",{attrs:{formData:e.data,configuration:e.configuration,extension:e.extension,formConfig:e.formConfig,invisible:e.invisible}})]:[i("div",{staticClass:"iform-item-box"},[i("van-field",{class:[e.required(e.configuration),e.labelHidden,e.labelTop],attrs:{label:e.$t(e.configuration.name)},scopedSlots:e._u([{key:"input",fn:function(){return[i("iform-control",{attrs:{invisible:e.invisible,data:e.data,configuration:e.configuration,formConfig:e.formConfig}})]},proxy:!0}],null,!1,2757109201)})],1)]],2)],1):e._e()},a=[],s=(i("14d9"),i("3bce")),o=i("bf26"),r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.visible?i("div",{staticClass:"iform-control",staticStyle:{width:"100%"}},[(e.labelling||e.isView||e.isFormatter)&&!e.is(e.configuration,["htmledit"])?[i("iform-control-formatter",{attrs:{data:e.data,configuration:e.newConfiguration,formConfig:e.formConfig}})]:[e.disabled&&e.disabledEditor?i("iform-control-formatter",{attrs:{data:e.data,configuration:e.newConfiguration,formConfig:e.formConfig}}):[i(e.type,{tag:"component",attrs:{data:e.data,configuration:e.newConfiguration,formConfig:e.formConfig,disabled:e.disabled},on:{blur:function(t){return e.handleTrigger("blur")},change:function(t){return e.handleTrigger("change")}}}),e.configuration&&e.rules.length&&!1===e.invisible?i("form-check",{ref:"form-check-"+e.newConfiguration.code,attrs:{code:e.newConfiguration.code,rules:e.rules,value:e.value}}):e._e(),e.configuration.extension.tipsText?i("tips-text",{attrs:{content:e.configuration.extension.tipsText}}):e._e()]]],2):e._e()},l=[],c=i("9837"),d=i("9ef9"),u=i("c987"),f={name:"iform-control",data(){return{type:"input",rules:[],event:{}}},props:{formConfig:Object,invisible:Boolean,data:{default(){return null}},configuration:{type:Object,default(){return null}}},inject:{isTop:{default:!1}},computed:{formula(){return this.configuration.extension.formula},newConfiguration(){const e=this.configuration;return e.code&&(e.code=e.code.replace(/\./g,"-")),e},value(){return this.configuration?this.data[this.configuration.code]:null},visible(){return null!==this.configuration},labelling(){let e=this.$store.getters.taskInfo;return(!e||!e.isBeginStep||1!==e.status)&&(null!==this.configuration&&this.configuration.isReadable&&this.configuration.extension.isHideControl)},bizId(){return this.$route.query.bizid||this.$route.query.bizId||""},store(){return this.$store},isView(){let e=this.$route.query.Action||this.$route.query.action||"";return"view"===e.toLowerCase()&&e.length>0},isFormatter(){return this.configuration.extension.formatter},disabled(){return this.$store.getters.disabled},disabledEditor(){return!Object(s["r"])(this.configuration,["htmledit"])||(this.labelling||this.isView)},checkTarget(){return this.$refs["form-check-"+this.configuration.code]}},methods:{initFormula(){const{initWatcher:e,initGlobalStateWatcher:t,hasFormula:i}=Object(u["b"])(this.formula,this,()=>({...this.data}),e=>{this.data[this.configuration.code]=e});i&&(e(this.data),t())},init(){this.handleControl(),this.handleDefault(),this.handleRules()},handleControl(){let e=this,t=e.configuration.controlType;if("textbox"===t){let i=e.configuration.extension.subtype;"cardnumber"===i&&(t="cardnumber")}const i="iform-control-"+t||!1;d["a"][i]?e.type=i:e.type="iform-control-span"},handleDefault(){let e=this;if(!e.bizId){let t=e.data[e.configuration.code];const i=e.configuration.defaultExpression;if("boolean"!==typeof t&&(""===t||void 0===t||null===t)&&i){let t=i;if(i.indexOf("{")>-1){let n=Object(c["d"])(i);if(t=e.store.getters.getSystem(n),"ocbox"===this.configuration.controlType){const n=e.store.state.system.data;"{Sys_UserId}"===i&&(t=JSON.stringify([{id:t,type:"U",name:n.Sys_UserName}])),"{Sys_UserAccount}"===i&&(t=JSON.stringify([{id:n.Sys_UserId,type:"U",name:n.Sys_UserName}])),"{Sys_CompanyId}"===i&&(t=JSON.stringify([{id:t,type:"O",name:n.Sys_CompanyName}])),"{Sys_DepartmentId}"===i&&(t=JSON.stringify([{id:t,type:"D",name:n.Sys_DepartmentName}])),"{Sys_JobId}"===i&&(t=JSON.stringify([{id:t,type:"J",name:n.Sys_JobName}]))}}e.data[e.configuration.code]=void 0!==t&&null!==t?t:i}}},handleTrigger(e){var t;null===(t=this.checkTarget)||void 0===t||t.handleTrigger(e)},handleRules(){let e=this,t=Object(o["c"])(e.configuration);t&&(e.rules=t[e.configuration.code])},is(e,t){return Object(s["r"])(e,t)}},mounted(){this.init(),this.initFormula()},components:{...d["a"]}},h=f,m=(i("16ad"),i("2877")),p=Object(m["a"])(h,r,l,!1,null,"9cc903d2",null),g=p.exports,v=i("4ac1"),_=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"timeline",staticStyle:{padding:"14px"}},[i("van-row",{class:"icon-"+e.getTaskSignStatus(e.taskInfo),attrs:{type:"flex",align:"center"}},[i("van-image",{staticClass:"pro-avatar",attrs:{round:"",src:e.topUserAvatar}}),i("van-row",{staticClass:"approve-info",staticStyle:{margin:"0px",padding:"0px"}},[i("div",{staticClass:"profile"},[i("span",{staticClass:"profile_name"},[e._v(" "+e._s(e.topUser.UserName)+" ")]),!0!==e.hideUserAccount?i("span",[e._v(" "+e._s(e.topUser.UserAccount)+" ")]):e._e()]),i("div",{staticClass:"process-info"},[i("div",{staticClass:"pro-name"},[i("span",{staticClass:"pro-name_icon"},[e._v("+")]),e._v(" "+e._s(e.taskInfo.processName)+" ")]),i("van-tag",{staticStyle:{margin:"5px 15px"},attrs:{plain:"",hairline:"",type:e.getInstanceColor()}},[e._v(" "+e._s(e.getInstanceStatusText())+" ")])],1)])],1)],1)},b=[],y=i("365c");const k="/static/images/user.png";var I={name:"temp-top",data(){return{topUser:{}}},props:{taskInfo:Object},computed:{instanceStatus(){return this.taskInfo.instanceStatus+""},user(){return this.$store.getters.userInfo},hideUserAccount(){return window.projectConfig.hideUserAccount},showRealAvatarInProcess(){var e;return!1!==(null===(e=window.projectConfig.featureFlag)||void 0===e?void 0:e.showRealAvatarInProcess)},topUserAvatar(){return this.showRealAvatarInProcess&&this.topUser.Avatar||k}},mounted(){Object(c["b"])("itask-template-top",this),this.initData()},methods:{async initData(){if(this.topUser=this.user,this.taskInfo.instanceId){const{data:e,code:t}=await y["d"].getSiginList(this.taskInfo.instanceId);if(1===t&&e&&e.length>0){const t=e[0];this.topUser={Avatar:t.avatar,UserName:t.userName,UserAccount:t.userId}}}},getInstanceStatusText(){var e;(null===(e=this.taskInfo.taskId)||void 0===e?void 0:e.indexOf("TMP"))>-1||Object(s["l"])(this.instanceStatus)},getInstanceColor(){return Object(s["k"])(this.instanceStatus)},getTaskSignStatus(e){return Object(s["q"])(e)}}},w=I,C=(i("7806"),i("3e5d"),Object(m["a"])(w,_,b,!1,null,"c2360710",null)),S=C.exports,O=i("4a60"),E=i("4a9d"),x={name:"iform-item",components:{"iform-control":g,"iform-control-datagrid":v["a"],"iform-temp-top":S},props:{data:Object,configuration:Object,formConfig:Object,colspan:{type:Number,default(){return 4}},isTop:{type:Boolean,default(){return!1}},active:{type:Boolean,default(){return!0}}},data(){return{showItem:!0,itemVisible:!0,activeNames:[this.configuration.name],events:{"iduo.form.relation":this.handleRelation,"iduo.form.visible":this.handleVisible}}},computed:{formTheme(){return this.$store.state.formTheme},isLightFormTheme(){return"light"===this.formTheme},invisible(){return!0!==this.showItem||!0!==this.itemVisible},formItemBigIntervalsValue(){if("group"===this.configuration.controlType)return;const e=this.formExtension.formItemBigIntervals;return"boolean"===typeof e?"10px":"string"===typeof e?e:"unset"},formExtension(){var e;return(null===(e=this.formConfig)||void 0===e||null===(e=e.formConfiguration)||void 0===e?void 0:e.extension)||{}},extension(){return this.configuration.extension||{}},labelHidden(){const e=this.configuration.extension.labelPosition;return"hidden"===e?"label-hidden":""},labelTop(){const e=this.formExtension.fieldOrderBy,t=this.configuration.extension.labelPosition;return"block"===t||"top"===e?"label-top":""},parentClass(){return"iform-item-"+this.configuration.code},style(){let e=[];return e.push("width:"+parseInt(this.configuration.extension.colspan/this.colspan*100)+"%"),e.join(";")},isLogicHide(){return null!==this.configuration&&this.configuration.extension.isLogicHide},type(){return"iform-"+this.configuration.controlType},formAutoNumber(){return null!==this.configuration&&this.configuration.extension.formAutoNumber},mobileHide(){return null!==this.configuration&&this.configuration.extension.mobileHide},labelWidth(){return null!==this.configuration?(this.configuration.extension.labelWidth||"100")+"px":"100px"},taskInfo(){return this.$store.getters.taskInfo},groupVerticalMargin(){const e=this.extension.groupVerticalMargin;if(e){const t=e.split(",");return`${t[0]}px 0px ${t[1]||0}px 0px`}return this.isLightFormTheme?this.isTop?"0 14px 14px 14px":"14px":"10px 0px 0px 0px"},groupIcon(){return this.extension.icon}},watch:{configuration:{deep:!0,immediate:!0,handler(e){e&&(this.handleRelation(),this.is(this.configuration,["group","detail"])&&-1===this.activeNames.indexOf(e.name)&&this.active&&this.activeNames.push(e.name))}}},created(){this.$watch(()=>this.isLogicHide,()=>{!0===this.isLogicHide?this.itemVisible=!1:this.itemVisible=!0},{immediate:!0}),this.$watch(()=>this.mobileHide,()=>{!0===this.mobileHide?this.showItem=!1:this.showItem=!0},{immediate:!0})},mounted(){this.init(),this.setupClearOnHideControl(),setTimeout(()=>{this.isTop&&!0!==this.formExtension.formHeadExpand&&(this.activeNames=[])},100)},destroyed(){},methods:{init(){Object(O["b"])(this.events),this.handleRelation()},getCodebyChild(e){const t=[];return e.forEach(e=>{t.push(e.code,...this.getCodebyChild(e.items))}),t},handleRelation(){this.$nextTick(()=>{this.showItem=Object(s["m"])(this.configuration,this.data);const e=this.getCodebyChild(this.configuration.items);this.$store.dispatch("disableFormItemCheck",{codes:[this.configuration.code,...e],bool:this.showItem})})},handleVisible(e,t){e=e instanceof Array?e:[e],e.indexOf(this.configuration.code)>-1&&(this.itemVisible=t)},is(e,t){return Object(s["r"])(e,t)},required(){let e="",t=Object(o["c"])(this.configuration);if(t)for(let i=0;i<t[this.configuration.code].length;i++){let n=t[this.configuration.code][i];if(n.required){e="van-cell--required";break}}return e},setupClearOnHideControl(){const{relationConfig:e,isEmpty:t,code:i}=Object(s["u"])(this.configuration);if(this.$set(this.configuration,"__oldValue",this.data[i]),!i)return;if(t)return;const{clearOnHide:n,restOnVisible:a}=e;(n||a)&&(a&&this.$watch(()=>this.data[i],e=>{null!=e&&(this.oldValue=e,this.$set(this.configuration,"__oldValue",e))}),n&&this.$watch(()=>this.showItem,e=>{E["a"].$emit("iduo.form.relation"),e||("detail"===this.configuration.controlType?this.data[i]=[]:this.data[i]=void 0),a&&(this.data[i]=this.oldValue)}))}}},D=x,A=(i("f58a"),i("cc04"),Object(m["a"])(D,n,a,!1,null,"4f08eec1",null));t["a"]=A.exports},f50e:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return r}));var n=i("3e90"),a=i("163b");const s=Object(n["a"])(""),o=()=>{s.value=Object(a["c"])()},r=()=>{s.value=""}},f58a:function(e,t,i){"use strict";i("e35b")},fbaa:function(e,t,i){"use strict";i("36b8")}}]);